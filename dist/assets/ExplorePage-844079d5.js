import{d as z,r as g,u as O,o as j,s as T,q as G,a as J,c as p,f,F as K,x as W,k as B,w as v,y as X,g as i,t as N,i as Y,_ as Z}from"./index-f1eab0dd.js";import{u as ee,a as te}from"./useAuth.vue_vue_type_script_lang-298818ca.js";import{g as D,r as I,a as M}from"./index.esm2017-9ddf60ae.js";import{P as oe,R as L,k as R,x as $,_ as q,d as ne,g as se,c as ae,F as re}from"./index.esm2017-96b642a7.js";import{u as le}from"./useUserDetails.vue_vue_type_script_lang-3dc9a373.js";import{a as ie}from"./axios-4a70c6fc.js";import{c as ce}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as ue}from"./useDetailButtons-7e4732f0.js";import"./useLikeButton-b22feb4d.js";const de={class:"exploreSection"},me={key:0,class:X({resultsContainer:!0})},ge=["src","alt","onClick"],pe={class:"result-item-other"},fe={class:"result-item-header"},he=["onClick"],ve=["innerHTML","onClick"],ye=["onClick"],_e=z({__name:"ExplorePage",setup(we){le();const c=g([]),u=g(""),w=new DOMParser,y=O(),{app:x}=ee(),F=D(x),_=oe(x),C=te();C.sidebar=!1;const d=g(null),h=g(),S=g(!0);j(()=>{T(()=>{const e=document.getElementById("warningShow");e&&(e.style.display="flex",e.textContent="Loading ...")}),d.value=L(q(_,"posts"),$("postTime","desc"),R(15)),P(d.value)});async function U(e){u.value="";try{const o=I(F,e.postContain),s=await M(o).catch(a=>{console.log(a)});await ie.post("/postContent",{contentUrl:s}).then(a=>{const t=w.parseFromString(a.data,"text/html");u.value=t.body.innerHTML}).catch(a=>{console.log(a)})}catch{const s=document.getElementById("ErrorShow");s.style.display="flex",s.textContent="Something went wrong, check your internet connection and reload page"}}async function H(e){h.value=null;try{const o=se(_,"users",e),s=await ae(o);if(s.data()!==void 0){const{fullName:a,profilePicture:t,username:r,blogName:l}=s.data(),n={profilePicture:t,posterID:e,fullName:a,username:r,blogName:l},m=D(),Q=I(m,n.profilePicture);try{await M(Q).then(b=>{n.profilePicture&&(n.profilePicture=b),n.blogName===""&&(n.blogName=`${n.username}Blog`),h.value={id:e,img:n.profilePicture,fullName:n.fullName,username:n.username,blogname:n.blogName}})}catch{const E=document.getElementById("ErrorShow");E.style.display="flex",E.textContent="Something went wrong, check your internet connection and reload page"}}}catch{}}async function P(e){const s=(await ne(e)).docs.map(async t=>{var n;const r=t.data();await U(r);const l=w.parseFromString(u.value,"text/html");return l.body.querySelectorAll("img").forEach(m=>{m.remove()}),l.body.querySelectorAll("video").forEach(m=>{m.remove()}),(n=l.body.querySelector("h1"))==null||n.remove(),u.value=l.body.innerHTML,r.postContain=u.value,await H(r.posterId),r.posterDetails=h.value,r}),a=await Promise.all(s);c.value=a,h.value=null,S.value=!1}function A(){const e=d.value.docs[d.value.docs.length-1],o=L(q(_,"cities"),$("postTime","desc"),re(e),R(15));P(o).then(()=>{d.value=o})}function V(e){y.push(`/post/${e}`)}function k(e){if(e===C.signedUser.id)return y.push("/userProfile");y.push(`/chatterUser/${e}`)}return G(()=>{var e;((e=c.value)==null?void 0:e.length)>0&&T(()=>{const o=document.getElementById("warningShow");o&&(o.style.display="none")})}),J(()=>{const e=document.getElementById("warningShow");e.style.display="none"}),(e,o)=>{var s,a;return p(),f("main",de,[((s=c.value)==null?void 0:s.length)>0&&S.value===!1?(p(),f("div",me,[(p(!0),f(K,null,W(c.value,(t,r)=>(p(),f("div",{key:r,class:"result-item"},[i("img",{src:t==null?void 0:t.posterDetails.img,alt:(t==null?void 0:t.posterDetails.username)+"profile picture",class:"result-item-image",onClick:v(l=>k(t.posterId),["prevent"])},null,8,ge),i("div",pe,[i("div",fe,[i("span",{onClick:v(l=>k(t.posterId),["prevent"])},N(t==null?void 0:t.posterDetails.blogname),9,he),i("span",null,N(ce(t.postTime.seconds)),1)]),i("div",{innerHTML:t.postContain,id:"divContent",onClick:v(l=>V(t.postId),["prevent"])},null,8,ve),Y(ue,{post:t},null,8,["post"])])]))),128))])):B("",!0),((a=c.value)==null?void 0:a.length)===15?(p(),f("button",{key:1,onClick:v(A,["prevent"])},"See More ....",8,ye)):B("",!0)])}}});const Ne=Z(_e,[["__scopeId","data-v-c31aa61e"]]);export{Ne as default};
