import{u as $,a as b}from"./useAuth.vue_vue_type_script_lang-0f4a9525.js";import{G as N}from"./index-36d15da9.js";import{P as q,_ as v,R as c,b as d,d as w,g as U,a as h}from"./index.esm2017-8a8714eb.js";function G(t){const{app:l}=$(),n=q(l),o=b(),s=v(n,"users");async function a(){o.signedUser.id===void 0||o.signedUser.id===""?confirm("You need to be signed in to follow someone. Do you want to sign in?")===!0&&N.push("/login"):i()}async function i(){try{const e=c(s,d("id","==",`${o.signedUser.id}`)),r=(await w(e)).docs[0].data(),f=c(s,d("id","==",`${t}`)),y=(await w(f)).docs[0].data(),g=[...r.following.theFollowings,t],F=g.length,u=[...y.followers.theFollowers,o.signedUser.id],A=u.length,P=U(n,"users",t),m=U(n,"users",o.signedUser.id);await h(P,{["followers.theFollowers"]:u,["followers.total"]:A,notifications:[...y.notifications,{type:`${o.signedUser.fullName} started following you`,details:{followerId:o.signedUser.id,time:new Date}}]}),await h(m,{["following.theFollowings"]:g,["following.total"]:F,activityLog:[...r.activityLog,{type:"New following",details:{followingId:t,time:new Date}}]})}catch{alert("An occured while trying to follow this user. Please try again later")}}a()}function S(t,l){const{app:n}=$(),o=q(n),s=b(),a=v(o,"users");i();async function i(){try{const e=c(a,d("id","==",`${s.signedUser.id}`)),r=(await w(e)).docs[0].data(),f=c(a,d("id","==",`${t}`)),y=(await w(f)).docs[0].data(),g=r.following.theFollowings.filter(R=>R!==t),F=g.length,u=y.followers.theFollowers.filter(R=>R!==s.signedUser.id),A=u.length,P=U(o,"users",t),m=U(o,"users",s.signedUser.id);await h(P,{["followers.theFollowers"]:u,["followers.total"]:A}),await h(m,{["following.theFollowings"]:g,["following.total"]:F,activityLog:[...r.activityLog,{type:`You unfollowed ${l}`,details:{followingId:t,time:new Date}}]})}catch{alert("An error occured, Check your network connection and try again")}}}const D=b();async function j(t,l){const{app:n}=$(),o=q(n),s=v(o,"users");if(D.signedUser.id===void 0||D.signedUser.id==="")return!1;return await a();async function a(){try{const i=c(s,d("id","==",`${l}`)),e=c(s,d("id","==",`${t}`)),p=await w(i),r=await w(e),f=p.docs[0].data();return r.docs[0].data().followers.theFollowers.includes(l)&&f.following.theFollowings.includes(t)}catch{return!1}}}export{S as a,G as b,j as u};
