import{d as J,u as K,r as v,a as re,q as ie,c as m,f as h,g as l,m as R,A as le,B as ce,w as P,F as V,x as q,t as T,i as X,k as H,p as ue,n as de,_ as Y}from"./index-f1eab0dd.js";import{u as me,a as Z}from"./useAuth.vue_vue_type_script_lang-298818ca.js";import{S as he}from"./useSignOut.vue_vue_type_script_lang-190ae6a2.js";import{g as F,r as O,a as Q}from"./index.esm2017-9ddf60ae.js";import{P as pe,R as W,b as j,_ as z,d as G,g as ve,c as ge}from"./index.esm2017-96b642a7.js";import{u as fe}from"./useDetailButtons-7e4732f0.js";import{a as ye}from"./axios-4a70c6fc.js";import{c as _e}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import"./useLikeButton-b22feb4d.js";const k=b=>(ue("data-v-9a49907d"),b=b(),de(),b),be={id:"mainSearchContainer"},Ce={class:"search-container"},Se=["placeholder"],we={class:"firstSection"},Be=k(()=>l("option",{value:"",disabled:""},"Select category you want to search in",-1)),xe=k(()=>l("option",{value:"Posts"},"Posts",-1)),Ee=k(()=>l("option",{value:"Users"},"Users",-1)),Ie=[Be,xe,Ee],Pe={key:0,class:"results-container"},Te=["src","alt","onClick"],Ue={class:"result-item-other"},Ae={class:"result-item-header"},ke=["onClick"],Ne=["innerHTML","onClick"],$e={key:1,class:"results-container"},Le=J({__name:"useSearch",setup(b){const{app:g}=me(),c=pe(g),B=K(),N=F(g),ee=Z(),C=v(""),S=v("Posts"),U=v("");let d;const x=v(""),$=new DOMParser,A=v();re(()=>{clearTimeout(d)});const f=v([]),y=v([]);ie(()=>{S.value==="Posts"?(C.value="",U.value="Search for posts by post tag",y.value=[],f.value=[]):S.value==="Users"&&(C.value="",U.value="Search for Users by username",f.value=[],y.value=[])});async function te(a){try{const s=O(N,a.postContain),o=await Q(s).catch(e=>{console.log(e)});await ye.post("/postContent",{contentUrl:o}).then(e=>{const u=$.parseFromString(e.data,"text/html");x.value=u.body.innerHTML}).catch(e=>{console.log(e)})}catch(s){console.log(s)}}async function se(a){A.value=null;try{const s=ve(c,"users",a),o=await ge(s);if(o.data()!==void 0){const{fullName:e,profilePicture:u,username:p,blogName:E}=o.data(),t={profilePicture:u,posterID:a,fullName:e,username:p,blogName:E},w=F(),r=O(w,t.profilePicture);try{await Q(r).then(n=>{t.profilePicture&&(t.profilePicture=n),t.blogName===""&&(t.blogName=`${t.username}Blog`),A.value={id:a,img:t.profilePicture,fullName:t.fullName,username:t.username,blogname:t.blogName}})}catch{}}}catch{}}async function oe(a,s){var e,u,p,E;const o=document.getElementById("ErrorShow");if(y.value=[],f.value=[],console.log(a,s),s==="")o.style.display="flex",o.textContent="Search input is empty",d=setTimeout(()=>{o.style.display="none"},3e3);else if(a==="Posts"){const t=document.createElement("div");t.setAttribute("id","loading"),t.textContent="Loading...",(e=document.getElementById("mainSearchContainer"))==null||e.appendChild(t),(u=document.getElementById("searchBtn"))==null||u.setAttribute("disabled","true");const w=W(z(c,"posts"),j("postTag","==",`${s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}`));try{await G(w).then(r=>{r.docs.length===0?(t.remove(),o.style.display="flex",o.textContent="No post with this tag found",d=setTimeout(()=>{var n;o.style.display="none",(n=document.getElementById("searchBtn"))==null||n.removeAttribute("disabled")},3e3)):r.docs.forEach(n=>{const i=n.data();te(i).then(()=>{var D,M;t.remove(),(D=document.getElementById("searchBtn"))==null||D.removeAttribute("disabled");const I=$.parseFromString(x.value,"text/html");I.body.querySelectorAll("img").forEach(_=>{_.remove()}),I.body.querySelectorAll("video").forEach(_=>{_.remove()}),(M=I.body.querySelector("h1"))==null||M.remove(),x.value=I.body.innerHTML,i.postContain=x.value,se(i.posterId).then(()=>{var _;i.posterDetails=A.value,(_=f.value)==null||_.push(i)})})})}).catch(r=>{t.remove(),r.style.display="flex",r.textContent="Something went wrong",d=setTimeout(()=>{var n;r.style.display="none",(n=document.getElementById("searchBtn"))==null||n.removeAttribute("disabled")},3e3)})}catch{t.remove();const n=document.getElementById("ErrorShow");n.style.display="flex",n.textContent="Something went wrong",d=setTimeout(()=>{var i;n.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)}}else if(a==="Users"){const t=document.createElement("div");t.setAttribute("id","loading"),t.textContent="Loading...",(p=document.getElementById("mainSearchContainer"))==null||p.appendChild(t),(E=document.getElementById("searchBtn"))==null||E.setAttribute("disabled","true");const w=W(z(c,"users"),j("username","==",`${s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}`));try{await G(w).then(r=>{var n;t.remove(),r.docs.length===0?(o.style.display="flex",o.textContent="No user with this username found",d=setTimeout(()=>{var i;o.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)):((n=document.getElementById("searchBtn"))==null||n.removeAttribute("disabled"),r.docs.forEach(i=>{y.value.push(i.data())}))}).catch(()=>{t.remove(),o.style.display="flex",o.textContent="Something went wrong",d=setTimeout(()=>{var r;o.style.display="none",(r=document.getElementById("searchBtn"))==null||r.removeAttribute("disabled")},3e3)})}catch{t.remove();const n=document.getElementById("ErrorShow");n.style.display="flex",n.textContent="Something went wrong",d=setTimeout(()=>{var i;n.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)}}}function ne(a){const s=a.target,o=s.value;o.includes(" ")&&(s.value=o.replace(/\s/g,""))}function ae(a){B.push(`/post/${a}`)}function L(a){if(a===ee.signedUser.id)return B.push("/userProfile");B.push(`/chatterUser/${a}`)}return(a,s)=>{var o;return m(),h("div",be,[l("div",Ce,[R(l("input",{type:"text",name:"searchValue","onUpdate:modelValue":s[0]||(s[0]=e=>C.value=e),placeholder:U.value,onInput:ne},null,40,Se),[[le,C.value]]),l("div",we,[R(l("select",{id:"tags","onUpdate:modelValue":s[1]||(s[1]=e=>S.value=e),required:""},Ie,512),[[ce,S.value]]),l("button",{onClick:s[2]||(s[2]=P(e=>oe(S.value,C.value),["prevent"])),id:"searchBtn"},"Search")])]),((o=f.value)==null?void 0:o.length)>0?(m(),h("div",Pe,[(m(!0),h(V,null,q(f.value,(e,u)=>(m(),h("div",{key:u,class:"result-item-post"},[l("img",{src:e==null?void 0:e.posterDetails.img,alt:(e==null?void 0:e.posterDetails.username)+"profile picture",class:"result-item-image",onClick:P(p=>L(e.posterId),["prevent"])},null,8,Te),l("div",Ue,[l("div",Ae,[l("span",{onClick:P(p=>L(e.posterId),["prevent"])},T(e==null?void 0:e.posterDetails.blogname),9,ke),l("span",null,T(_e(e.postTime.seconds)),1)]),l("div",{innerHTML:e.postContain,id:"divContent",onClick:P(p=>ae(e.postId),["prevent"])},null,8,Ne),X(fe,{post:e},null,8,["post"])])]))),128))])):H("",!0),y.value.length>0?(m(),h("div",$e,[(m(!0),h(V,null,q(y.value,(e,u)=>(m(),h("button",{key:u,class:"result-item"},[l("h3",null,T(e.fullName),1),l("p",null,"@"+T(e.username),1)]))),128))])):H("",!0)])}}});const De=Y(Le,[["__scopeId","data-v-9a49907d"]]),Me={id:"searchContainer"},Re=J({__name:"SearchPage",setup(b){const g=K(),c=Z();return c.sidebar=!1,c.authenticated===!0&&(c.signedUser.id===void 0&&c.signedUser.username===void 0?g.push({name:"NetworkError",query:{redirect:`${g.currentRoute.value.path}`}}):c.signedUser.id!==void 0&&c.signedUser.username===""&&(console.log("User registration not finished... Logging out user....."),he(),c.authenticated=!1,g.push("/login"))),(B,N)=>(m(),h("div",Me,[X(De)]))}});const Ge=Y(Re,[["__scopeId","data-v-0997efe8"]]);export{Ge as default};
