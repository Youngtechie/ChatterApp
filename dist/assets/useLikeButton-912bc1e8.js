import{d as C,s as q,b as D,e as A,w as E,g as U,D as M,p as R,m as Y,f as h,_ as N}from"./index-39bb5b9b.js";import{u as z,a as Q}from"./useAuth.vue_vue_type_script_lang-154466f4.js";import{P as V,R as k,b as f,_ as m,d as L,a as r,g as l,c as j}from"./index.esm2017-1c1d52a4.js";const w=d=>(R("data-v-eebe18ff"),d=d(),Y(),d),F=["id"],G=w(()=>h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 25",width:"15",height:"15"},[h("path",{d:"M12.5,4.17C7.71,0,0,3.92,0,8.75c0,4.61,3.9,8.35,12.5,16.25C20.1,17.1,24,13.36,24,8.75C24,3.92,16.29,0,12.5,4.17z"})],-1)),H=w(()=>h("span",null,"0",-1)),J=[G,H],K=C({__name:"useLikeButton",props:{viewPostId:String,viewPostPosterId:String},setup(d){const n=d,{app:g}=z(),o=V(g),p=Q(),_=k(m(o,"posts"),f("postId","==",`${n.viewPostId}`));q(()=>{try{L(_).then(e=>{const t=e.docs[0].data();t.postLikes.ids.includes(p.signedUser.id)?(document.querySelector(`#btnLike${n.viewPostId} svg path`).style.fill="red",document.querySelector(`#btnLike${n.viewPostId} span`).textContent=`${t.postLikes.total}`):t.postLikes.ids.includes(p.signedUser.id)||(document.querySelector(`#btnLike${n.viewPostId} svg path`).style.fill="none",document.querySelector(`#btnLike${n.viewPostId} span`).textContent=`${t.postLikes.total}`)})}catch{}});async function b(){const e=l(o,"posts",n.viewPostId);await j(e).then(t=>{var a;document.querySelector(`#btnLike${n.viewPostId} span`).textContent=`${(a=t.data())==null?void 0:a.postLikes.total}`,p.viwedPost=t.data()}).catch(t=>{console.log(t)})}async function y(e,t,a){if(e===""||e===void 0)return M.push("/login");{document.getElementById(`btnLike${t}`).setAttribute("disabled","true");const $=k(m(o,"users"),f("id","==",`${e}`)),P=k(m(o,"posts"),f("postId","==",`${t}`)),S=k(m(o,"users"),f("id","==",`${a}`));try{L($).then(v=>{const i=v.docs[0].data();L(P).then(B=>{const u=B.docs[0].data();L(S).then(x=>{const c=x.docs[0].data();i.likes.out.some(s=>s.postid===t)?r(l(o,"users",`${e}`),{["likes.out"]:i.likes.out.filter(s=>s.postid!==t),["likes.total.out"]:i.likes.total.out-1,activityLog:[...i.activityLog,{type:"You unliked this post",details:{postId:t,time:new Date}}],interactions:i.interactions.filter(s=>s.type==="Liked a post"&&s.details.postid===t)}):r(l(o,"users",`${e}`),{["likes.out"]:[...i.likes.out,{postid:t,time:new Date}],["likes.total.out"]:i.likes.total.out+1,activityLog:[...i.activityLog,{type:"You liked this post",details:{postId:t,time:new Date}}],interactions:[...i.interactions,{type:"Liked this post",details:{postid:t,time:new Date}}]}),u.postLikes.ids.some(s=>s===e)?r(l(o,"posts",`${t}`),{["postLikes.ids"]:u.postLikes.ids.filter(s=>s!==e),["postLikes.total"]:u.postLikes.total-1}):r(l(o,"posts",`${t}`),{["postLikes.ids"]:[...u.postLikes.ids,e],["postLikes.total"]:u.postLikes.total+1}),c.likes.in.some(s=>s.postid===t)?r(l(o,"users",`${a}`),{["likes.in"]:c.likes.in.filter(s=>s.postid!==t),["likes.total.in"]:c.likes.total.in-1}):r(l(o,"users",`${a}`),{["likes.in"]:[...c.likes.in,{postid:t,time:new Date}],["likes.total.in"]:c.likes.total.in+1,notifications:[...c.notifications,{type:`You got a like from <b>${i.fullName}</b> on a post`,details:{postId:t,time:new Date}}]}),b(),document.getElementById(`btnLike${t}`).removeAttribute("disabled")})})})}catch(v){console.log(v),document.getElementById(`btnLike${t}`).removeAttribute("disabled")}}}return(e,t)=>(D(),A("button",{onClick:t[0]||(t[0]=E(a=>y(U(p).signedUser.id,n.viewPostId,n.viewPostPosterId),["prevent"])),id:`btnLike${d.viewPostId}`,class:"like-button"},J,8,F))}});const X=N(K,[["__scopeId","data-v-eebe18ff"]]);export{X as u};
