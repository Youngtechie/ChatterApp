import{d as se,u as oe,r as U,o as ie,y as D,a as ae,b as le,c as d,e as re,f as p,g as e,w as I,j as i,k as ce,t as r,l as w,h as x,i as T,n as P,m as h,F as de,z as ue,q as pe,s as me}from"./index-d9c4c67e.js";import{a as he,u as ge}from"./useAuth.vue_vue_type_script_lang-77171506.js";import{_ as ye}from"./useLoadingPage.vue_vue_type_style_index_0_lang-1cc37a5c.js";import{g as fe,r as _e,l as we,d as ve}from"./index.esm2017-34a1c5ec.js";import{P as Ce,R as O,_ as V,b as j,k as Se,d as z,g as N,c as ke,y as G}from"./index.esm2017-7370a789.js";import{u as Ue}from"./useUserDetails.vue_vue_type_script_lang-4fb6f021.js";import{S as Q}from"./useSignOut.vue_vue_type_script_lang-64088068.js";import{c as Ie}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as be}from"./useDetailButtons-0e25b9a8.js";import{a as xe}from"./index-72692797.js";import{_ as Pe}from"./_plugin-vue_export-helper-c27b6911.js";const c=b=>(pe("data-v-f8ad16d7"),b=b(),me(),b),Be={key:1},Ee=["onClick"],De=["title"],Te={id:"themeImgContainer"},Ne=["src"],Ae={key:0,class:"body"},Le={class:"imageCon"},Re={class:"sectionFoImage"},Fe={key:0},$e={class:"follow"},Me=c(()=>e("p",null,"||",-1)),qe={class:"btns"},He=c(()=>e("button",null,"Edit Profile",-1)),Oe=["onClick"],Ve={class:"readerSec"},je={class:"btnSection"},ze={class:"personalDetails"},Ge=c(()=>e("span",null,"Full Name:",-1)),Qe=c(()=>e("span",null,"User Name:",-1)),Je=c(()=>e("span",null,"Blog Name:",-1)),Ke={key:0},We=c(()=>e("span",null,"Email:",-1)),Xe=c(()=>e("span",null,"Location:",-1)),Ye=c(()=>e("span",null,"Birthday:",-1)),Ze=c(()=>e("span",null,"Gender:",-1)),et={key:1},tt=c(()=>e("span",null,"Interests:",-1)),nt=c(()=>e("div",{id:"warningShowint"},null,-1)),st={key:0},ot={class:"type"},it={class:"result-item"},at=["src","alt","onClick"],lt={class:"result-item-other"},rt={class:"result-item-header"},ct=["onClick"],dt=["innerHTML","onClick"],ut={id:"navigators"},pt=c(()=>e("button",null,"Home",-1)),mt=c(()=>e("button",null,"Search",-1)),ht=c(()=>e("div",{id:"warningShow"},null,-1)),gt=se({__name:"UserProfile",setup(b){const g=oe(),A=U(!0),t=he();ie(()=>{Ue(),D(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="none")}),t.section="personal"});const B=U(),{app:L,auth:J}=ge(),v=Ce(L),K=fe(L),R=new DOMParser,C=U(""),f=U([]);let y;const F=U("false");async function W(n){C.value="";const s=n.postContain;await xe.post("/.netlify/functions/postContent",{contentUrl:s}).then(a=>{const o=R.parseFromString(a.data.content,"text/html");C.value=o.body.innerHTML}).catch(a=>{console.log(a)})}async function X(n){B.value=null;const s=N(v,"users",n),a=await ke(s);if(a.data()!==void 0){const{fullName:o,profilePicture:u,username:m,blogName:S}=a.data(),l={profilePicture:u,posterID:n,fullName:o,username:m,blogName:S};B.value={id:n,img:l.profilePicture,fullName:l.fullName,username:l.username,blogname:l.blogName}}}async function Y(n){if(n.length>0)try{const s=n.map(async o=>{const u=O(V(v,"posts"),j("postId","==",o.details.postid),Se(10)),m=await z(u);return Promise.all(m.docs.map(async S=>{var k;const l=S.data();if(l!=null&&l.length!==0){await W(l);const _=R.parseFromString(C.value,"text/html");return _.body.querySelectorAll("img").forEach(E=>{E.remove()}),_.body.querySelectorAll("video").forEach(E=>{E.remove()}),(k=_.body.querySelector("h1"))==null||k.remove(),C.value=_.body.innerHTML,l.postContain=C.value,await X(l.posterId).then(()=>{l.posterDetails=B.value}),{type:o.type,postDetails:l}}}))}),a=await Promise.all(s);if(f.value=a.flat(),f.value.length===0){const o=document.getElementById("warningShowint");o.style.display="flex",o.textContent="No interactions yet"}else if(f.value.length>0){const o=document.getElementById("warningShowint");o.style.display="none"}}catch(s){console.log(s);const a=document.getElementById("warningShowint");a.style.display="flex",a.textContent="An error occured, Check your network connection and try again"}else{const s=document.getElementById("warningShowint");s.style.display="flex",s.textContent="No interactions yet"}}function Z(){g.go(-1)}function $(n){t.section=n,f.value=[],n==="interaction"&&D(()=>{const s=document.getElementById("warningShowint");s.style.display="flex",s.textContent="Loading ...",Y(t.signedUser.interactions)})}function ee(n){g.push(`/post/${n}`)}function M(n){if(n===t.signedUser.id)return g.push("/userProfile");g.push(`/chatterUser/${n}`)}async function te(n){const s=document.getElementById("warningShow");s.style.display="flex",s.textContent="Deleting account ...";const a=J.currentUser,o=N(v,"users",n);a==null||a.delete().then(()=>{G(o);const u=O(V(v,"posts"),j("posterId","==",n));z(u).then(m=>{m.docs.forEach(l=>{const k=l.data(),_=N(v,"posts",k.postId),H=`ChatterAppFiles/posts/${k.postId}`;q(H),G(_)});const S=`ChatterAppFiles/avatar/${n}`;q(S),Q(),s.style.display="Account deleted successfully",t.authenticated=!1,F.value="true",y=setTimeout(()=>{s.style.display="none",t.signedUser={},g.push("/home")},2e3)})}).catch(()=>{s.textContent="An error occured, Check your network connection and try again",y=setTimeout(()=>{s.style.display="none"},2e3)})}async function q(n){const s=_e(K,n),a=await we(s);if(a.items.length===0)return;const o=a.items.map(u=>ve(u));await Promise.all(o)}async function ne(){if(confirm("Are you sure you want to delete your account?")!==!1)try{await te(t.signedUser.id).catch(()=>{const s=document.getElementById("warningShow");s.style.display="flex",s.textContent="An error occured, Check your network connection and try again",y=setTimeout(()=>{s.style.display="none"},2e3)})}catch{const a=document.getElementById("warningShow");a.style.display="flex",a.textContent="An error occurred, Check your network connection and try again",y=setTimeout(()=>{a.style.display="none"},2e3)}}return y=setTimeout(()=>{if(t.signedUser.id===void 0&&t.authenticated===!1)g.push("/home");else if(t.authenticated===!0)if(t.signedUser.id!==void 0&&t.signedUser.username===""){const n=document.getElementById("warningShow");n.style.display="flex",n.textContent="Registration not complete... Logging you out",Q(),y=setTimeout(()=>{n.style.display="none",t.authenticated=!1,g.push("/login")},2e3)}else t.signedUser.username===void 0&&t.signedUser.id===void 0?D(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="flex",n.textContent="Check your network connection and try again")}):A.value=!1},5e3),ae(()=>{clearTimeout(y);const n=document.getElementById("warningShow");n&&(n.style.display="none");const s=document.getElementById("warningShowint");s&&(s.style.display="none")}),(n,s)=>{const a=le("RouterLink");return A.value?(d(),re(ye,{key:0,"action-name":"Loading profile..."})):(d(),p("main",Be,[e("header",null,[e("button",{onClick:I(Z,["prevent"])},"Back",8,Ee),e("button",{title:i(t).themeDetails.title,id:"themeBtn",onClick:s[0]||(s[0]=(...o)=>i(t).changeTheme&&i(t).changeTheme(...o))},[e("div",Te,[e("img",{src:i(t).themeDetails.img},null,8,Ne)])],8,De)]),F.value==="false"?(d(),p("div",Ae,[e("div",Le,[e("div",{class:"imgCon",style:ce({backgroundImage:`url(${i(t).signedUser.profilePicture})`})},null,4)]),e("section",Re,[e("h3",null,r(i(t).signedUser.fullName),1),i(t).signedUser.bio?(d(),p("p",Fe,r(i(t).signedUser.bio),1)):w("",!0),e("div",$e,[e("p",null,r(i(t).signedUser.followers.total)+" Followers",1),Me,e("p",null,r(i(t).signedUser.following.total)+" Following",1)])]),e("div",qe,[x(a,{to:{name:"EditProfile"}},{default:T(()=>[He]),_:1}),e("button",{onClick:I(ne,["prevent"])},"Delete Account",8,Oe)]),e("div",Ve,[e("div",je,[e("button",{onClick:s[1]||(s[1]=o=>$("personal")),class:P({active:i(t).section==="personal"})},"Personal",2),e("button",{onClick:s[2]||(s[2]=o=>$("interaction")),class:P({active:i(t).section==="interaction"})},"Interactions",2)]),e("div",{class:P({show:i(t).section==="personal",none:i(t).section!=="personal",personal:!0})},[e("div",ze,[e("p",null,[Ge,h(" "+r(i(t).signedUser.fullName),1)]),e("p",null,[Qe,h(" "+r(i(t).signedUser.username),1)]),e("p",null,[Je,h(" "+r(i(t).signedUser.blogName),1)]),i(t).signedUser.settings.privacySettings.showEmail?(d(),p("p",Ke,[We,h(" "+r(i(t).signedUser.email),1)])):w("",!0),e("p",null,[Xe,h(" "+r(i(t).signedUser.location),1)]),e("p",null,[Ye,h(" "+r(i(t).signedUser.dateOfBirth),1)]),e("p",null,[Ze,h(" "+r(i(t).signedUser.gender),1)]),i(t).signedUser.interests.length>0?(d(),p("p",et,[tt,h(" "+r(i(t).signedUser.interests.join(",")),1)])):w("",!0)])],2),i(t).section==="interaction"?(d(),p("div",{key:0,class:P({show:i(t).section==="interaction",none:i(t).section!=="interaction",interaction:!0})},[nt,f.value.length>0?(d(),p("div",st,[(d(!0),p(de,null,ue(f.value,(o,u)=>(d(),p("div",{key:u,class:"resultContainer"},[e("div",ot,r(o.type),1),e("div",it,[e("img",{src:o.postDetails.posterDetails.img,alt:o.postDetails.posterDetails.username+"profile picture",class:"result-item-image",onClick:I(m=>M(o.postDetails.posterId),["prevent"])},null,8,at),e("div",lt,[e("div",rt,[e("span",{onClick:I(m=>M(o.postDetails.posterId),["prevent"])},r(i(t).signedUser.blogName),9,ct),e("span",null,r(Ie(o.postDetails.postTime.seconds)),1)]),e("div",{innerHTML:o.postDetails.postContain,id:"divContent",onClick:I(m=>ee(o.postDetails.postId),["prevent"])},null,8,dt),x(be,{post:o.postDetails},null,8,["post"])])])]))),128))])):w("",!0)],2)):w("",!0)]),e("section",ut,[x(a,{to:"/home"},{default:T(()=>[pt]),_:1}),x(a,{to:"/search"},{default:T(()=>[mt]),_:1})])])):w("",!0),ht]))}}});const xt=Pe(gt,[["__scopeId","data-v-f8ad16d7"]]);export{xt as default};
