import{d as W,u as j,r as p,a as oe,s as se,c as m,f as h,g as a,m as M,B as ne,C as re,w as I,F as R,y as V,n as ae,t as U,h as G,k as H,p as ie,q as le,_ as J}from"./index-6f23e352.js";import{u as ce,a as K}from"./useAuth.vue_vue_type_script_lang-d76c59a2.js";import{S as ue}from"./useSignOut.vue_vue_type_script_lang-602b7c91.js";import{g as de,r as me,a as he}from"./index.esm2017-70995d75.js";import{P as pe,R as F,b as O,_ as Q,d as z,g as ve,c as ge}from"./index.esm2017-a297fada.js";import{u as ye}from"./useDetailButtons-3d6ae16e.js";import{a as fe}from"./axios-4a70c6fc.js";import{c as _e}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";const A=_=>(ie("data-v-9f2d7756"),_=_(),le(),_),Se={id:"mainSearchContainer"},be={class:"search-container"},Ce=["placeholder"],we={class:"firstSection"},Ee=A(()=>a("option",{value:"",disabled:""},"Select category you want to search in",-1)),xe=A(()=>a("option",{value:"Posts"},"Posts",-1)),Be=A(()=>a("option",{value:"Users"},"Users",-1)),Pe=[Ee,xe,Be],Ie={key:0,class:"results-container"},Ue=["onClick"],ke={class:"result-item-other"},Te={class:"result-item-header"},qe=["onClick"],Ae=["innerHTML","onClick"],$e={key:1,class:"results-container"},Ne=["onClick"],Le=W({__name:"useSearch",setup(_){const{app:S}=ce(),l=pe(S),E=j(),$=K(),b=p(""),C=p("Posts"),k=p("");let v;const x=p(""),N=new DOMParser,T=p();oe(()=>{clearTimeout(v)});const g=p([]),y=p([]);se(()=>{C.value==="Posts"?(b.value="",k.value="Search for posts by post tag",y.value=[],g.value=[]):C.value==="Users"&&(b.value="",k.value="Search for Users by username",g.value=[],y.value=[])});async function X(n){try{const o=n.postContain;await fe.post("/postContent",{contentUrl:o}).then(s=>{const e=N.parseFromString(s.data,"text/html");x.value=e.body.innerHTML}).catch(s=>{console.log(s)})}catch(o){console.log(o)}}async function Y(n){T.value=null;try{const o=ve(l,"users",n),s=await ge(o);if(s.data()!==void 0){const{fullName:e,profilePicture:u,username:d,blogName:B}=s.data(),t={profilePicture:u,posterID:n,fullName:e,username:d,blogName:B},w=de(),i=me(w,t.profilePicture);try{await he(i).then(r=>{t.profilePicture&&(t.profilePicture=r),t.blogName===""&&(t.blogName=`${t.username}Blog`),T.value={id:n,img:t.profilePicture,fullName:t.fullName,username:t.username,blogname:t.blogName}})}catch{}}}catch{}}async function Z(n,o){var e,u,d,B;const s=document.querySelector("#ErrorShow span");if(y.value=[],g.value=[],console.log(n,o),o==="")document.querySelector("#ErrorShow").style.display="flex",s.textContent="Search input is empty",v=setTimeout(()=>{s.style.display="none"},3e3);else if(n==="Posts"){const t=document.createElement("div");t.setAttribute("id","loading"),t.textContent="Loading...",(e=document.getElementById("mainSearchContainer"))==null||e.appendChild(t),(u=document.getElementById("searchBtn"))==null||u.setAttribute("disabled","true");const w=F(Q(l,"posts"),O("postTag","==",`${o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}`));try{await z(w).then(i=>{i.docs.length===0?(t.remove(),document.querySelector("#ErrorShow").style.display="flex",s.textContent="No post with this tag found",v=setTimeout(()=>{var r;s.style.display="none",(r=document.getElementById("searchBtn"))==null||r.removeAttribute("disabled")},3e3)):i.docs.forEach(r=>{const c=r.data();X(c).then(()=>{var L,D;t.remove(),(L=document.getElementById("searchBtn"))==null||L.removeAttribute("disabled");const P=N.parseFromString(x.value,"text/html");P.body.querySelectorAll("img").forEach(f=>{f.remove()}),P.body.querySelectorAll("video").forEach(f=>{f.remove()}),(D=P.body.querySelector("h1"))==null||D.remove(),x.value=P.body.innerHTML,c.postContain=x.value,Y(c.posterId).then(()=>{var f;c.posterDetails=T.value,(f=g.value)==null||f.push(c)})})})}).catch(i=>{t.remove(),document.querySelector("#ErrorShow").style.display="flex",i.textContent="Something went wrong",v=setTimeout(()=>{var r;i.style.display="none",(r=document.getElementById("searchBtn"))==null||r.removeAttribute("disabled")},3e3)})}catch{t.remove();const r=document.querySelector("#ErrorShow span");document.querySelector("#ErrorShow").style.display="flex",r.textContent="Something went wrong"}}else if(n==="Users"){const t=document.createElement("div");t.setAttribute("id","loading"),t.textContent="Loading...",(d=document.getElementById("mainSearchContainer"))==null||d.appendChild(t),(B=document.getElementById("searchBtn"))==null||B.setAttribute("disabled","true");const w=F(Q(l,"users"),O("username","==",`${o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}`));try{await z(w).then(i=>{var r;t.remove(),i.docs.length===0?(document.querySelector("#ErrorShow").style.display="flex",s.textContent="No user with this username found",v=setTimeout(()=>{var c;s.style.display="none",(c=document.getElementById("searchBtn"))==null||c.removeAttribute("disabled")},3e3)):((r=document.getElementById("searchBtn"))==null||r.removeAttribute("disabled"),i.docs.forEach(c=>{y.value.push(c.data())}))}).catch(()=>{t.remove(),document.querySelector("#ErrorShow").style.display="flex",s.textContent="Something went wrong",v=setTimeout(()=>{var i;s.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)})}catch{t.remove();const r=document.querySelector("#ErrorShow span");document.querySelector("#ErrorShow").style.display="flex",r.textContent="Something went wrong"}}}function ee(n){const o=n.target,s=o.value;s.includes(" ")&&(o.value=s.replace(/\s/g,""))}function te(n){E.push(`/post/${n}`)}function q(n){if(n===$.signedUser.id)return E.push("/userProfile");E.push(`/chatterUser/${n}`)}return(n,o)=>{var s;return m(),h("div",Se,[a("div",be,[M(a("input",{type:"text",name:"searchValue","onUpdate:modelValue":o[0]||(o[0]=e=>b.value=e),placeholder:k.value,onInput:ee},null,40,Ce),[[ne,b.value]]),a("div",we,[M(a("select",{id:"tags","onUpdate:modelValue":o[1]||(o[1]=e=>C.value=e),required:""},Pe,512),[[re,C.value]]),a("button",{onClick:o[2]||(o[2]=I(e=>Z(C.value,b.value),["prevent"])),id:"searchBtn"},"Search")])]),((s=g.value)==null?void 0:s.length)>0?(m(),h("div",Ie,[(m(!0),h(R,null,V(g.value,(e,u)=>(m(),h("div",{key:u,class:"result-item-post"},[a("div",{class:"imgCon",onClick:I(d=>q(e.posterId),["prevent"]),style:ae({backgroundImage:`url(${e==null?void 0:e.posterDetails.img})`})},null,12,Ue),a("div",ke,[a("div",Te,[a("span",{onClick:I(d=>q(e.posterId),["prevent"])},U(e==null?void 0:e.posterDetails.blogname),9,qe),a("span",null,U(_e(e.postTime.seconds)),1)]),a("div",{innerHTML:e.postContain,id:"divContent",onClick:I(d=>te(e.postId),["prevent"])},null,8,Ae),G(ye,{post:e},null,8,["post"])])]))),128))])):H("",!0),y.value.length>0?(m(),h("div",$e,[(m(!0),h(R,null,V(y.value,(e,u)=>(m(),h("button",{key:u,class:"result-item",onClick:d=>q(e.id)},[a("h3",null,U(e.fullName),1),a("p",null,"@"+U(e.username),1)],8,Ne))),128))])):H("",!0)])}}});const De=J(Le,[["__scopeId","data-v-9f2d7756"]]),Me={id:"searchContainer"},Re=W({__name:"SearchPage",setup(_){const S=j(),l=K();return l.sidebar=!1,l.authenticated===!0&&(l.signedUser.id===void 0&&l.signedUser.username===void 0?S.push({name:"NetworkError",query:{redirect:`${S.currentRoute.value.path}`}}):l.signedUser.id!==void 0&&l.signedUser.username===""&&(console.log("User registration not finished... Logging out user....."),ue(),l.authenticated=!1,S.push("/login"))),(E,$)=>(m(),h("div",Me,[G(De)]))}});const Ge=J(Re,[["__scopeId","data-v-7d5dddad"]]);export{Ge as default};
