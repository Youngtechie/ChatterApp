import{d as G,r as b,c as C,f as g,p as ot,B as st,g as o,w as S,G as nt,u as it,o as rt,a as at,b as dt,e as mt,j as r,t as N,k as ct,l as X,h as H,F as lt,z as ut,i as Z,q as pt,s as vt}from"./index-9022b2ad.js";import{u as J,a as tt}from"./useAuth.vue_vue_type_script_lang-505c08bf.js";import{P as K,R,b as q,_ as D,d as F,a as x,g as y,c as j,I as _t}from"./index.esm2017-27f00cac.js";import{_ as ft}from"./useLoadingPage.vue_vue_type_style_index_0_lang-cb016175.js";import{a as wt}from"./axios-4a70c6fc.js";import{c as et}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as Ct,a as ht,b as gt}from"./useCheckFollow.vue_vue_type_script_lang-82d86bb0.js";import{u as Pt}from"./useUserDetails.vue_vue_type_script_lang-f78af288.js";import{u as yt}from"./useDetailButtons-70788aa0.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";const It={class:"commentAdd"},bt=G({__name:"useAddComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String},setup(A){const v=A,{app:M}=J(),I=K(M),l=b("");async function U(t,s,a,B){if(t===""||t===void 0)confirm("You must be logged in to comment, will you love to sign up?")&&nt.push("/join");else if(B.trim()==="")alert("You cannot post an empty comment");else{document.getElementById("btnAddcomment").setAttribute("disabled","true");const h=R(D(I,"users"),q("id","==",`${t}`)),_=R(D(I,"posts"),q("postId","==",`${s}`)),i=R(D(I,"users"),q("id","==",`${a}`));try{F(h).then(k=>{const f=k.docs[0].data();F(_).then(E=>{const u=E.docs[0].data();F(i).then(O=>{const P=O.docs[0].data(),c={commentId:u.postComments.count,details:B,time:new Date};function n(m){return f.comments.out.map(w=>{if(w.postId===s)return{...w,commentArr:[...w.commentArr,m]}})}function d(m){return P.comments.in.map(w=>{if(w.postId===s)return{...w,commentArr:[...w.commentArr,m]}})}f.comments.out.some(m=>m.postId===s)?x(y(I,"users",`${t}`),{["comments.out"]:n(c),["comments.total.out"]:f.comments.total.out+1,activityLog:[...f.activityLog,{type:"You added another comment on this post",details:{commentId:u.postComments.count,postId:s,text:c.details,time:c.time}}]}):x(y(I,"users",`${t}`),{["comments.out"]:[...f.comments.out,{postId:s,commentArr:[c]}],["comments.total.out"]:f.comments.total.out+1,activityLog:[...f.activityLog,{type:"You commented on this post",details:{commentId:u.postComments.count,postId:s,text:c.details,time:c.time}}],interactions:[...f.interactions,{type:"Commented on this post",details:{commentId:u.postComments.count,postid:s,text:c.details,time:c.time}}]}),u.postComments&&x(y(I,"posts",`${s}`),{["postComments.details"]:[...u.postComments.details,{commentId:u.postComments.count,id:t,text:c.details,time:c.time}],["postComments.total"]:u.postComments.total+1,["postComments.count"]:u.postComments.count+1}),P.comments.in.some(m=>m.postId===s)?x(y(I,"users",`${a}`),{["comments.in"]:d(c),["comments.total.in"]:P.comments.total.in+1,notifications:[...P.notifications,{type:`Your got a comment from <b>${f.fullName}</b> on a post`,details:{commentId:u.postComments.count,postid:s,text:c.details,time:c.time}}]}):x(y(I,"users",`${a}`),{["comments.in"]:[...P.comments.in,{postId:s,commentArr:[c]}],["comments.total.in"]:P.comments.total.in+1,notifications:[...P.notifications,{type:`Your got a comment from <b>${f.fullName}</b> on a post`,details:{commentId:u.postComments.count,postid:s,text:c.details,time:c.time}}]}),l.value="",document.getElementById("btnAddcomment").removeAttribute("disabled")})})})}catch{alert("Something went wrong"),document.getElementById("btnAddcomment").removeAttribute("disabled")}}}return(t,s)=>(C(),g("div",It,[ot(o("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>l.value=a),minlength:"1",maxlength:"1000"},null,512),[[st,l.value]]),o("button",{onClick:s[1]||(s[1]=S(a=>U(v.currentUserId,v.viewPostId,v.viewPostPosterId,l.value),["prevent"])),id:"btnAddcomment"},"Add Comment")]))}});const At=Q(bt,[["__scopeId","data-v-47105c14"]]),Ut=G({__name:"useDeleteComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String},setup(A){const v=A,{app:M}=J(),I=tt(),l=K(M);async function U(){const s=y(l,"posts",v.viewPostId);await j(s).then(a=>{I.viwedPost=a.data()}).catch(a=>{console.log(a)})}async function t(s,a,B,h,_){if(!(s===""||s===void 0)){const i=R(D(l,"users"),q("id","==",`${s}`)),k=R(D(l,"posts"),q("postId","==",`${a}`)),f=R(D(l,"users"),q("id","==",`${B}`));try{F(i).then(E=>{const u=E.docs[0].data();F(k).then(O=>{const P=O.docs[0].data();F(f).then(c=>{const n=c.docs[0].data();function d(e){return e.comments.out.map(p=>{if(p.postId===a)if(p.commentArr.length>1){const L=p.commentArr.filter(T=>T.commentId!==h);return{...p,commentArr:L}}else return null;return p}).filter(p=>p!==null)}function m(e){return e.comments.in.map(p=>{if(p.postId===a)if(p.commentArr.length>1){const L=p.commentArr.filter(T=>T.commentId!==h);return{...p,commentArr:L}}else return null;return p}).filter(p=>p!==null)}u.comments.out.some(e=>e.postId===a)&&x(y(l,"users",`${s}`),{["comments.out"]:d(u),["comments.total.out"]:u.comments.total.out-1,activityLog:[...u.activityLog,{type:"You deleted a comment on this post",details:{commentId:h,postId:a,text:_,time:new Date}}],interactions:u.interactions.filter(e=>e.details.commentId!==h)}),P.postComments&&x(y(l,"posts",`${a}`),{["postComments.details"]:P.postComments.details.filter(e=>e.commentId!==h),["postComments.total"]:P.postComments.total-1}),n.comments.in.some(e=>e.postId===a)&&x(y(l,"users",`${B}`),{["comments.in"]:m(n),["comments.total.in"]:n.comments.total.in-1,notifications:n.notifications.filter(e=>e.details.commentId!==h)}),U()})})})}catch(E){console.log(E)}}}return(s,a)=>(C(),g("button",{class:"delBtn",onClick:a[0]||(a[0]=S(B=>t(v.currentUserId,v.viewPostId,v.viewPostPosterId,A.commentId,A.commentText),["prevent"]))},"Delete"))}});const kt=Q(Ut,[["__scopeId","data-v-c1602308"]]),$t={key:1,id:"editContainer"},xt={id:"centerContainer"},Et=["onClick"],St=G({__name:"useEditComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String,divEditId:String},setup(A){const v=A,{app:M}=J(),I=tt(),l=K(M),U=b(""),t=b(!1);async function s(){const _=y(l,"posts",v.viewPostId);await j(_).then(i=>{I.viwedPost=i.data()}).catch(i=>{console.log(i)})}async function a(_,i,k,f,E){if(!(_===""||_===void 0))if(f.trim()==="")alert("Comment cannot be empty");else{document.getElementById("btnEditComment").setAttribute("disabled","true");const u=R(D(l,"users"),q("id","==",`${_}`)),O=R(D(l,"posts"),q("postId","==",`${i}`)),P=R(D(l,"users"),q("id","==",`${k}`));try{F(u).then(c=>{const n=c.docs[0].data();F(O).then(d=>{const m=d.docs[0].data();F(P).then(e=>{const w=e.docs[0].data();function V(){return n.comments.out.map($=>{if($.postId===i){const W=$.commentArr.map(Y=>Y.commentId===E?{...Y,details:f}:Y);return{...$,commentArr:W}}return $})}function p(){return w.comments.in.map($=>{if($.postId===i){const W=$.commentArr.map(Y=>Y.commentId===E?{...Y,details:f}:Y);return{...$,commentArr:W}}return $})}function L(){return m.postComments.details.map($=>$.commentId===E?{...$,text:f}:$)}n.comments.out.some(T=>T.postId===i)&&x(y(l,"users",`${_}`),{["comments.out"]:V(),activityLog:[...n.activityLog,{type:"You edited your comment on this post",details:{commentId:m.postComments.count,postId:i,text:f,time:new Date}}]}),m.postComments&&x(y(l,"posts",`${i}`),{["postComments.details"]:L()}),w.comments.in.some(T=>T.postId===i)&&x(y(l,"users",`${k}`),{["comments.in"]:p()}),document.getElementById("btnEditComment").removeAttribute("disabled"),s(),t.value=!1})})})}catch{alert("An error occurred, try again"),document.getElementById("btnEditComment").removeAttribute("disabled")}}}function B(_){const i=document.getElementById(`${_}`);U.value=i.innerText,t.value=!0}function h(){document.getElementById("btnEditComment").setAttribute("disabled","true"),U.value="",t.value=!1}return(_,i)=>t.value?(C(),g("div",$t,[o("div",xt,[ot(o("textarea",{"onUpdate:modelValue":i[1]||(i[1]=k=>U.value=k)},null,512),[[st,U.value]]),o("button",{id:"btnEditComment",onClick:i[2]||(i[2]=S(k=>a(v.currentUserId,v.viewPostId,v.viewPostPosterId,U.value,A.commentId),["prevent"]))},"Update"),o("button",{onClick:S(h,["prevent"])},"Cancel",8,Et)])])):(C(),g("button",{key:0,onClick:i[0]||(i[0]=S(k=>B(v.divEditId),["prevent"])),class:"editBTn"},"Edit"))}});const Bt=Q(St,[["__scopeId","data-v-41bb88f5"]]),z=A=>(pt("data-v-b81ada5a"),A=A(),vt(),A),Tt={key:1,class:"postFullDetails"},Lt=["onClick"],Nt=["title"],Rt={id:"themeImgContainer"},qt=["src"],Dt={key:0,class:"postBody"},Ft={key:0},Mt={key:1,class:"coverImage"},Vt=["src"],Ot={class:"section1"},Yt={class:"details"},Ht={key:0},jt=["onClick"],zt=["onClick"],Gt={class:"timePosted"},Jt=["innerHTML"],Kt={class:"btnsMore"},Qt={class:"commentingSection"},Wt={key:0},Xt={key:1,class:"commentAction"},Zt={class:"commenter"},te=["onClick"],ee=["id"],oe={key:0,class:"commenterBtn"},se={key:2},ne={key:1},ie=z(()=>o("h1",null,"Post not found or Deleted",-1)),re=z(()=>o("button",null,"Expore Chatter",-1)),ae=z(()=>o("button",null,"Home",-1)),de={id:"navigators"},me=z(()=>o("button",null,"Home",-1)),ce=z(()=>o("button",null,"Search",-1)),le=G({__name:"PostPage",props:["postId"],setup(A){const v=A;Pt();const M=b(!0),I=b(""),{app:l}=J(),U=K(l),t=tt(),s=it(),a=y(U,"posts",v.postId),B=new DOMParser,h=b([]),_=b(!1);b(""),b(""),b(""),b(""),b(""),b(""),b(""),b("");async function i(){try{await Promise.all(t.viwedPost.postComments.details.map(async(n,d)=>{const m=y(U,"users",n.id),e=await j(m);if(e.data()!==void 0){const{fullName:w,id:V,username:p}=e.data(),L={fullName:w,id:V,username:p};t.viwedPost.postComments.details[d].posterDetails=L}}))}catch(n){console.log(n)}}async function k(){try{const n=await j(a);n.data()!==void 0&&(t.viwedPost=n.data(),f(),E(),i(),x(a,{postViews:t.viwedPost.postViews+1}).finally(()=>{M.value=!1}))}catch(n){console.error(n)}}rt(()=>{const n=y(U,"posts",v.postId);try{_t(n,d=>{t.viwedPost=d.data(),i()})}catch{}k()});async function f(){const n=t.viwedPost.postContain;await wt.post("/postContent",{contentUrl:n}).then(d=>{var e;const m=B.parseFromString(d.data,"text/html");(e=m.body.querySelector("h1"))==null||e.remove(),I.value=m.body.innerHTML}).catch(d=>{console.log(d)})}async function E(){h.value=[];const n=y(U,"users",t.viwedPost.posterId),d=await j(n);if(d.data()!==void 0){const{blogName:m,profilePicture:e,id:w,username:V}=d.data(),p={blogName:m,profilePicture:e,id:w,username:V};h.value.push(p),await Ct(t.viwedPost.posterId,t.signedUser.id).then(L=>{_.value=L})}}async function u(){ht(t.viwedPost.posterId,h.value[0].blogName),t.signedUser.username!==void 0&&t.signedUser.username!==""&&(_.value=!_.value)}async function O(){gt(t.viwedPost.posterId),t.signedUser.username!==void 0&&t.signedUser.username!==""&&(_.value=!_.value)}at(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="none")});function P(n){if(n===t.signedUser.id)return s.push("/userProfile");s.push(`/chatterUser/${n}`)}function c(){s.go(-1)}return(n,d)=>{const m=dt("RouterLink");return M.value?(C(),mt(ft,{key:0,"action-name":"Loading Post..."})):(C(),g("main",Tt,[o("header",null,[o("button",{onClick:S(c,["prevent"])},"Back",8,Lt),o("button",{title:r(t).themeDetails.title,id:"themeBtn",onClick:d[0]||(d[0]=(...e)=>r(t).changeTheme&&r(t).changeTheme(...e))},[o("div",Rt,[o("img",{src:r(t).themeDetails.img},null,8,qt)])],8,Nt)]),r(t).viwedPost.posterId!==void 0?(C(),g("div",Dt,[r(t).viwedPost.postCoverImage===""?(C(),g("h1",Ft,N(r(t).viwedPost.postTitle.join(" ")),1)):(C(),g("section",Mt,[o("img",{id:"img",src:r(t).viwedPost.postCoverImage},null,8,Vt),o("h1",null,N(r(t).viwedPost.postTitle.join(" ")),1)])),o("div",Ot,[o("div",Yt,[o("div",{class:"imgCon",onClick:d[1]||(d[1]=S(e=>P(r(t).viwedPost.posterId),["prevent"])),style:ct({backgroundImage:`url(${h.value[0].profilePicture})`})},null,4),o("div",null,[o("h3",{onClick:d[2]||(d[2]=S(e=>P(r(t).viwedPost.posterId),["prevent"]))},N(h.value[0].blogName),1),o("h5",null,"@"+N(h.value[0].username),1)])]),r(t).signedUser.id!==r(t).viwedPost.posterId?(C(),g("div",Ht,[_.value?(C(),g("button",{key:0,onClick:S(u,["prevent"])},"UnFollow",8,jt)):(C(),g("button",{key:1,onClick:S(O,["prevent"])},"Follow",8,zt))])):X("",!0)]),o("div",Gt,N(et(r(t).viwedPost.postTime.seconds)),1),o("div",{innerHTML:I.value,class:"showPost"},null,8,Jt),o("div",Kt,[H(yt,{post:r(t).viwedPost},null,8,["post"])]),o("div",Qt,[r(t).viwedPost.postComments.total===0&&r(t).viwedPost.postSettings.disableComments===!1?(C(),g("h4",Wt," No comments yet. ")):X("",!0),r(t).viwedPost.postSettings.disableComments===!1?(C(),g("div",Xt,[(C(!0),g(lt,null,ut(r(t).viwedPost.postComments.details,(e,w)=>(C(),g("div",{key:w,class:"Eachcomment"},[o("div",Zt,[o("div",null,[o("h4",{onClick:S(V=>P(e.commenterId),["prevent"])},N(e.posterDetails.fullName),9,te),o("h5",null,"@"+N(e.posterDetails.username),1)]),o("p",null,N(et(e.time.seconds)),1)]),o("div",{id:w.toString()+"commentDiv",class:"commentShow"},N(e.text),9,ee),r(t).signedUser.id===r(t).viwedPost.posterId?(C(),g("div",oe,[H(Bt,{currentUserId:r(t).signedUser.id,viewPostId:v.postId,viewPostPosterId:r(t).viwedPost.posterId,commentId:e.commentId,commentText:e.text,divEditId:w.toString()+"commentDiv"},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText","divEditId"]),H(kt,{currentUserId:r(t).signedUser.id,viewPostId:v.postId,viewPostPosterId:r(t).viwedPost.posterId,commentId:e.commentId,commentText:e.text},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText"])])):X("",!0)]))),128)),H(At,{currentUserId:r(t).signedUser.id,viewPostId:v.postId,viewPostPosterId:r(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])])):(C(),g("h4",se,"Commenting on this post is disabled."))])])):(C(),g("div",ne,[ie,o("div",null,[re,H(m,{to:"/"},{default:Z(()=>[ae]),_:1})])])),o("section",de,[H(m,{to:"/home"},{default:Z(()=>[me]),_:1}),H(m,{to:"/search"},{default:Z(()=>[ce]),_:1})])]))}}});const ye=Q(le,[["__scopeId","data-v-b81ada5a"]]);export{ye as default};
