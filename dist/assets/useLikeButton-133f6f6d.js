import{d as q,o as x,c as C,f as D,w as E,h as A,E as U,p as M,q as Y,g as v,_ as N}from"./index-a41cb3dd.js";import{u as R,a as z}from"./useAuth.vue_vue_type_script_lang-a9283b65.js";import{P as Q,R as k,b as p,_ as f,I as V,d as h,a as l,g as d}from"./index.esm2017-62f401cd.js";const _=c=>(M("data-v-d803fb0f"),c=c(),Y(),c),j=["id"],F=_(()=>v("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 25",width:"15",height:"15"},[v("path",{d:"M12.5,4.17C7.71,0,0,3.92,0,8.75c0,4.61,3.9,8.35,12.5,16.25C20.1,17.1,24,13.36,24,8.75C24,3.92,16.29,0,12.5,4.17z"})],-1)),G=_(()=>v("span",null,"0",-1)),H=[F,G],J=q({__name:"useLikeButton",props:{viewPostId:String,viewPostPosterId:String},setup(c){const a=c,{app:g}=R(),i=Q(g),m=z(),w=k(f(i,"posts"),p("postId","==",`${a.viewPostId}`));x(()=>{try{V(w,s=>{const t=s.docs[0].data();t.postLikes.ids.includes(m.signedUser.id)?(document.querySelector(`#btnLike${a.viewPostId} svg path`).style.fill="red",document.querySelector(`#btnLike${a.viewPostId} span`).textContent=`${t.postLikes.total}`):t.postLikes.ids.includes(m.signedUser.id)||(document.querySelector(`#btnLike${a.viewPostId} svg path`).style.fill="none",document.querySelector(`#btnLike${a.viewPostId} span`).textContent=`${t.postLikes.total}`)})}catch{}});async function b(s,t,r){if(s===""||s===void 0)return U.push("/login");{document.getElementById(`btnLike${t}`).setAttribute("disabled","true");const y=k(f(i,"users"),p("id","==",`${s}`)),$=k(f(i,"posts"),p("postId","==",`${t}`)),P=k(f(i,"users"),p("id","==",`${r}`));try{h(y).then(L=>{const o=L.docs[0].data();h($).then(B=>{const u=B.docs[0].data();h(P).then(S=>{const n=S.docs[0].data();o.likes.out.some(e=>e.postid===t)?l(d(i,"users",`${s}`),{["likes.out"]:o.likes.out.filter(e=>e.postid!==t),["likes.total.out"]:o.likes.total.out-1,activityLog:[...o.activityLog,{type:"You unliked this post",details:{postId:t,time:new Date}}],interactions:o.interactions.filter(e=>e.type==="Liked a post"&&e.details.postid===t)}):l(d(i,"users",`${s}`),{["likes.out"]:[...o.likes.out,{postid:t,time:new Date}],["likes.total.out"]:o.likes.total.out+1,activityLog:[...o.activityLog,{type:"You liked this post",details:{postId:t,time:new Date}}],interactions:[...o.interactions,{type:"Liked this post",details:{postid:t,time:new Date}}]}),u.postLikes.ids.some(e=>e===s)?l(d(i,"posts",`${t}`),{["postLikes.ids"]:u.postLikes.ids.filter(e=>e!==s),["postLikes.total"]:u.postLikes.total-1}):l(d(i,"posts",`${t}`),{["postLikes.ids"]:[...u.postLikes.ids,s],["postLikes.total"]:u.postLikes.total+1}),n.likes.in.some(e=>e.postid===t)?l(d(i,"users",`${r}`),{["likes.in"]:n.likes.in.filter(e=>e.postid!==t),["likes.total.in"]:n.likes.total.in-1}):r===s?l(d(i,"users",`${r}`),{["likes.in"]:[...n.likes.in,{postid:t,time:new Date}],["likes.total.in"]:n.likes.total.in+1}):l(d(i,"users",`${r}`),{["likes.in"]:[...n.likes.in,{postid:t,time:new Date}],["likes.total.in"]:n.likes.total.in+1,notifications:[...n.notifications,{type:`You got a like from <b>${o.fullName}</b> on a post`,details:{postId:t,time:new Date}}]}),document.getElementById(`btnLike${t}`).removeAttribute("disabled")})})})}catch(L){console.log(L),document.getElementById(`btnLike${t}`).removeAttribute("disabled")}}}return(s,t)=>(C(),D("button",{onClick:t[0]||(t[0]=E(r=>b(A(m).signedUser.id,a.viewPostId,a.viewPostPosterId),["prevent"])),id:`btnLike${c.viewPostId}`,class:"like-button"},H,8,j))}});const W=N(J,[["__scopeId","data-v-d803fb0f"]]);export{W as u};
