import{d as J,u as K,r as v,a as re,s as ie,c as m,f as h,g as l,m as R,B as le,C as ce,w as P,F as V,y as q,n as ue,t as T,i as X,k as H,p as de,q as me,_ as Y}from"./index-a41cb3dd.js";import{u as he,a as Z}from"./useAuth.vue_vue_type_script_lang-a9283b65.js";import{S as pe}from"./useSignOut.vue_vue_type_script_lang-1e71dc39.js";import{g as F,r as O,a as Q}from"./index.esm2017-a3842238.js";import{P as ve,R as z,b as W,_ as j,d as G,g as ge,c as ye}from"./index.esm2017-62f401cd.js";import{u as fe}from"./useDetailButtons-0eb84136.js";import{a as _e}from"./axios-4a70c6fc.js";import{c as be}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import"./useLikeButton-133f6f6d.js";const k=b=>(de("data-v-ef365822"),b=b(),me(),b),Ce={id:"mainSearchContainer"},Se={class:"search-container"},we=["placeholder"],Be={class:"firstSection"},xe=k(()=>l("option",{value:"",disabled:""},"Select category you want to search in",-1)),Ee=k(()=>l("option",{value:"Posts"},"Posts",-1)),Ie=k(()=>l("option",{value:"Users"},"Users",-1)),Pe=[xe,Ee,Ie],Te={key:0,class:"results-container"},Ue=["onClick"],Ae={class:"result-item-other"},ke={class:"result-item-header"},Ne=["onClick"],$e=["innerHTML","onClick"],Le={key:1,class:"results-container"},De=J({__name:"useSearch",setup(b){const{app:g}=he(),c=ve(g),B=K(),N=F(g),ee=Z(),C=v(""),S=v("Posts"),U=v("");let d;const x=v(""),$=new DOMParser,A=v();re(()=>{clearTimeout(d)});const y=v([]),f=v([]);ie(()=>{S.value==="Posts"?(C.value="",U.value="Search for posts by post tag",f.value=[],y.value=[]):S.value==="Users"&&(C.value="",U.value="Search for Users by username",y.value=[],f.value=[])});async function te(a){try{const o=O(N,a.postContain),s=await Q(o).catch(e=>{console.log(e)});await _e.post("/postContent",{contentUrl:s}).then(e=>{const u=$.parseFromString(e.data,"text/html");x.value=u.body.innerHTML}).catch(e=>{console.log(e)})}catch(o){console.log(o)}}async function oe(a){A.value=null;try{const o=ge(c,"users",a),s=await ye(o);if(s.data()!==void 0){const{fullName:e,profilePicture:u,username:p,blogName:E}=s.data(),t={profilePicture:u,posterID:a,fullName:e,username:p,blogName:E},w=F(),r=O(w,t.profilePicture);try{await Q(r).then(n=>{t.profilePicture&&(t.profilePicture=n),t.blogName===""&&(t.blogName=`${t.username}Blog`),A.value={id:a,img:t.profilePicture,fullName:t.fullName,username:t.username,blogname:t.blogName}})}catch{}}}catch{}}async function se(a,o){var e,u,p,E;const s=document.getElementById("ErrorShow");if(f.value=[],y.value=[],console.log(a,o),o==="")s.style.display="flex",s.textContent="Search input is empty",d=setTimeout(()=>{s.style.display="none"},3e3);else if(a==="Posts"){const t=document.createElement("div");t.setAttribute("id","loading"),t.textContent="Loading...",(e=document.getElementById("mainSearchContainer"))==null||e.appendChild(t),(u=document.getElementById("searchBtn"))==null||u.setAttribute("disabled","true");const w=z(j(c,"posts"),W("postTag","==",`${o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}`));try{await G(w).then(r=>{r.docs.length===0?(t.remove(),s.style.display="flex",s.textContent="No post with this tag found",d=setTimeout(()=>{var n;s.style.display="none",(n=document.getElementById("searchBtn"))==null||n.removeAttribute("disabled")},3e3)):r.docs.forEach(n=>{const i=n.data();te(i).then(()=>{var D,M;t.remove(),(D=document.getElementById("searchBtn"))==null||D.removeAttribute("disabled");const I=$.parseFromString(x.value,"text/html");I.body.querySelectorAll("img").forEach(_=>{_.remove()}),I.body.querySelectorAll("video").forEach(_=>{_.remove()}),(M=I.body.querySelector("h1"))==null||M.remove(),x.value=I.body.innerHTML,i.postContain=x.value,oe(i.posterId).then(()=>{var _;i.posterDetails=A.value,(_=y.value)==null||_.push(i)})})})}).catch(r=>{t.remove(),r.style.display="flex",r.textContent="Something went wrong",d=setTimeout(()=>{var n;r.style.display="none",(n=document.getElementById("searchBtn"))==null||n.removeAttribute("disabled")},3e3)})}catch{t.remove();const n=document.getElementById("ErrorShow");n.style.display="flex",n.textContent="Something went wrong",d=setTimeout(()=>{var i;n.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)}}else if(a==="Users"){const t=document.createElement("div");t.setAttribute("id","loading"),t.textContent="Loading...",(p=document.getElementById("mainSearchContainer"))==null||p.appendChild(t),(E=document.getElementById("searchBtn"))==null||E.setAttribute("disabled","true");const w=z(j(c,"users"),W("username","==",`${o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}`));try{await G(w).then(r=>{var n;t.remove(),r.docs.length===0?(s.style.display="flex",s.textContent="No user with this username found",d=setTimeout(()=>{var i;s.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)):((n=document.getElementById("searchBtn"))==null||n.removeAttribute("disabled"),r.docs.forEach(i=>{f.value.push(i.data())}))}).catch(()=>{t.remove(),s.style.display="flex",s.textContent="Something went wrong",d=setTimeout(()=>{var r;s.style.display="none",(r=document.getElementById("searchBtn"))==null||r.removeAttribute("disabled")},3e3)})}catch{t.remove();const n=document.getElementById("ErrorShow");n.style.display="flex",n.textContent="Something went wrong",d=setTimeout(()=>{var i;n.style.display="none",(i=document.getElementById("searchBtn"))==null||i.removeAttribute("disabled")},3e3)}}}function ne(a){const o=a.target,s=o.value;s.includes(" ")&&(o.value=s.replace(/\s/g,""))}function ae(a){B.push(`/post/${a}`)}function L(a){if(a===ee.signedUser.id)return B.push("/userProfile");B.push(`/chatterUser/${a}`)}return(a,o)=>{var s;return m(),h("div",Ce,[l("div",Se,[R(l("input",{type:"text",name:"searchValue","onUpdate:modelValue":o[0]||(o[0]=e=>C.value=e),placeholder:U.value,onInput:ne},null,40,we),[[le,C.value]]),l("div",Be,[R(l("select",{id:"tags","onUpdate:modelValue":o[1]||(o[1]=e=>S.value=e),required:""},Pe,512),[[ce,S.value]]),l("button",{onClick:o[2]||(o[2]=P(e=>se(S.value,C.value),["prevent"])),id:"searchBtn"},"Search")])]),((s=y.value)==null?void 0:s.length)>0?(m(),h("div",Te,[(m(!0),h(V,null,q(y.value,(e,u)=>(m(),h("div",{key:u,class:"result-item-post"},[l("div",{class:"imgCon",onClick:P(p=>L(e.posterId),["prevent"]),style:ue({backgroundImage:`url(${e==null?void 0:e.posterDetails.img})`})},null,12,Ue),l("div",Ae,[l("div",ke,[l("span",{onClick:P(p=>L(e.posterId),["prevent"])},T(e==null?void 0:e.posterDetails.blogname),9,Ne),l("span",null,T(be(e.postTime.seconds)),1)]),l("div",{innerHTML:e.postContain,id:"divContent",onClick:P(p=>ae(e.postId),["prevent"])},null,8,$e),X(fe,{post:e},null,8,["post"])])]))),128))])):H("",!0),f.value.length>0?(m(),h("div",Le,[(m(!0),h(V,null,q(f.value,(e,u)=>(m(),h("button",{key:u,class:"result-item"},[l("h3",null,T(e.fullName),1),l("p",null,"@"+T(e.username),1)]))),128))])):H("",!0)])}}});const Me=Y(De,[["__scopeId","data-v-ef365822"]]),Re={id:"searchContainer"},Ve=J({__name:"SearchPage",setup(b){const g=K(),c=Z();return c.sidebar=!1,c.authenticated===!0&&(c.signedUser.id===void 0&&c.signedUser.username===void 0?g.push({name:"NetworkError",query:{redirect:`${g.currentRoute.value.path}`}}):c.signedUser.id!==void 0&&c.signedUser.username===""&&(console.log("User registration not finished... Logging out user....."),pe(),c.authenticated=!1,g.push("/login"))),(B,N)=>(m(),h("div",Re,[X(Me)]))}});const Je=Y(Ve,[["__scopeId","data-v-0997efe8"]]);export{Je as default};
