import{d as G,u as J,r as v,a as K,x as ie,c as m,f as h,g as o,p as H,B as le,C as ce,w as E,F as L,z as F,l as O,k as de,t as P,h as X,q as Y,s as Z,_ as ee}from"./index-36d15da9.js";import{u as ue,a as te}from"./useAuth.vue_vue_type_script_lang-0f4a9525.js";import{S as me}from"./useSignOut.vue_vue_type_script_lang-72a5ef5c.js";import{P as he,R as z,b as Q,_ as W,d as j,g as pe,c as ve}from"./index.esm2017-8a8714eb.js";import{u as _e}from"./useDetailButtons-29f69ecb.js";import{a as ge}from"./axios-4a70c6fc.js";import{c as fe}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";const k=r=>(Y("data-v-67c6d7d6"),r=r(),Z(),r),ye={id:"mainSearchContainer"},be={class:"search-container"},Se=["placeholder"],Ce={class:"firstSection"},we=k(()=>o("option",{value:"",disabled:""},"Select category you want to search in",-1)),Be=k(()=>o("option",{value:"Posts"},"Posts",-1)),Ie=k(()=>o("option",{value:"Users"},"Users",-1)),xe=[we,Be,Ie],Ee={key:0,class:"results-container"},Pe=["onClick"],ke={class:"result-item-other"},Te={class:"result-item-header"},Ue=["onClick"],Ae=["innerHTML","onClick"],$e={key:1,class:"results-container"},Ne=["onClick"],Le=k(()=>o("div",{id:"warningShow"},null,-1)),Me=G({__name:"useSearch",setup(r){const{app:T}=ue(),i=he(T),_=J(),l=te(),g=v(""),S=v("Posts"),U=v("");let M;const B=v(""),D=new DOMParser,A=v();K(()=>{clearTimeout(M)});const f=v([]),y=v([]);ie(()=>{S.value==="Posts"?(g.value="",U.value="Search for posts by post tag",y.value=[],f.value=[]):S.value==="Users"&&(g.value="",U.value="Search for Users by username",f.value=[],y.value=[])});async function ne(s){const n=s.postContain;await ge.post("/postContent",{contentUrl:n}).then(t=>{const e=D.parseFromString(t.data,"text/html");B.value=e.body.innerHTML})}async function oe(s){A.value=null;const n=pe(i,"users",s),t=await ve(n);if(t.data()!==void 0){const{fullName:e,profilePicture:c,username:d,blogName:I}=t.data(),p={profilePicture:c,posterID:s,fullName:e,username:d,blogName:I};A.value={id:s,img:p.profilePicture,fullName:p.fullName,username:p.username,blogname:p.blogName}}}async function se(s,n){var e,c,d,I,p,V;document.querySelector("#mainSearchContainer #loading")&&document.querySelector("#mainSearchContainer #loading").remove();const t=document.createElement("div");if(t.setAttribute("id","loading"),t.textContent="Loading...",y.value=[],f.value=[],n===""){const u=document.getElementById("warningShow");u&&(u.style.display="flex",u.textContent="No Input",M=setTimeout(()=>{var a;u.style.display="none",(a=document.getElementById("searchBtn"))==null||a.removeAttribute("disabled")},1e3))}else if(s==="Posts"){(e=document.getElementById("mainSearchContainer"))==null||e.appendChild(t),(c=document.getElementById("searchBtn"))==null||c.setAttribute("disabled","true");const u=z(W(i,"posts"),Q("postTag","==",`${n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}`));try{await j(u).then(a=>{var C;a.docs.length===0?t.textContent="No Post found with this tag":a.docs.forEach(N=>{const w=N.data();ne(w).then(()=>{var q,R;(q=document.getElementById("searchBtn"))==null||q.removeAttribute("disabled");const x=D.parseFromString(B.value,"text/html");x.body.querySelectorAll("img").forEach(b=>{b.remove()}),x.body.querySelectorAll("video").forEach(b=>{b.remove()}),(R=x.body.querySelector("h1"))==null||R.remove(),B.value=x.body.innerHTML,w.postContain=B.value,oe(w.posterId).then(()=>{var b;w.posterDetails=A.value,t.remove(),(b=f.value)==null||b.push(w)})})}),(C=document.getElementById("searchBtn"))==null||C.removeAttribute("disabled")})}catch{t.textContent="Something went wrong",(d=document.getElementById("searchBtn"))==null||d.removeAttribute("disabled")}}else if(s==="Users"){(I=document.getElementById("mainSearchContainer"))==null||I.appendChild(t),(p=document.getElementById("searchBtn"))==null||p.setAttribute("disabled","true");const u=z(W(i,"users"),Q("username","==",`${n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}`));try{await j(u).then(a=>{var C;a.docs.length===0?t.textContent="No user with this username found":(t.remove(),(C=document.getElementById("searchBtn"))==null||C.removeAttribute("disabled"),a.docs.forEach(N=>{y.value.push(N.data())}))})}catch{t.textContent="Something went wrong",(V=document.getElementById("searchBtn"))==null||V.removeAttribute("disabled")}}}function ae(s){const n=s.target,t=n.value;t.includes(" ")&&(n.value=t.replace(/\s/g,""))}function re(s){_.push(`/post/${s}`)}function $(s){if(s===l.signedUser.id)return _.push("/userProfile");_.push(`/chatterUser/${s}`)}return(s,n)=>{var t;return m(),h(L,null,[o("div",ye,[o("div",be,[H(o("input",{type:"text",name:"searchValue","onUpdate:modelValue":n[0]||(n[0]=e=>g.value=e),placeholder:U.value,onInput:ae},null,40,Se),[[le,g.value]]),o("div",Ce,[H(o("select",{id:"tags","onUpdate:modelValue":n[1]||(n[1]=e=>S.value=e),required:""},xe,512),[[ce,S.value]]),o("button",{onClick:n[2]||(n[2]=E(e=>se(S.value,g.value),["prevent"])),id:"searchBtn"},"Search")])]),((t=f.value)==null?void 0:t.length)>0?(m(),h("div",Ee,[(m(!0),h(L,null,F(f.value,(e,c)=>(m(),h("div",{key:c,class:"result-item-post"},[o("div",{class:"imgCon",onClick:E(d=>$(e.posterId),["prevent"]),style:de({backgroundImage:`url(${e==null?void 0:e.posterDetails.img})`})},null,12,Pe),o("div",ke,[o("div",Te,[o("span",{onClick:E(d=>$(e.posterId),["prevent"])},P(e==null?void 0:e.posterDetails.blogname),9,Ue),o("span",null,P(fe(e.postTime.seconds)),1)]),o("div",{innerHTML:e.postContain,id:"divContent",onClick:E(d=>re(e.postId),["prevent"])},null,8,Ae),X(_e,{post:e},null,8,["post"])])]))),128))])):O("",!0),y.value.length>0?(m(),h("div",$e,[(m(!0),h(L,null,F(y.value,(e,c)=>(m(),h("button",{key:c,class:"result-item",onClick:d=>$(e.id)},[o("h3",null,P(e.fullName),1),o("p",null,"@"+P(e.username),1)],8,Ne))),128))])):O("",!0)]),Le],64)}}});const De=ee(Me,[["__scopeId","data-v-67c6d7d6"]]),Ve=r=>(Y("data-v-bc44b2da"),r=r(),Z(),r),qe={id:"searchContainer"},Re=Ve(()=>o("div",{id:"warningShow"},null,-1)),He=G({__name:"SearchPage",setup(r){const T=J(),i=te();i.sidebar=!1;let _;if(i.authenticated===!0&&i.signedUser.id!==void 0&&i.signedUser.username===""){const l=document.getElementById("warningShow");l.style.display="flex",l.textContent="Registration not complete... Logging you out",me(),_=setTimeout(()=>{l.style.display="none",i.authenticated=!1,T.push("/login")},2e3)}return K(()=>{clearTimeout(_);const l=document.getElementById("warningShow");l&&(l.style.display="none")}),(l,g)=>(m(),h("div",qe,[X(De),Re]))}});const Je=ee(He,[["__scopeId","data-v-bc44b2da"]]);export{Je as default};
