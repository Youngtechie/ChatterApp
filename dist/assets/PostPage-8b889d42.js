import{D as K,d as Q,r as M,c as k,f as L,g as c,m as nt,A as it,w as Y,l as Z,t as O,h as _,_ as rt,u as at,o as dt,a as ct,b as lt,e as mt,k as ut,i as G,F as pt,x as wt,j as ft}from"./index-0d83a52f.js";import{u as D,a as H}from"./useAuth.vue_vue_type_script_lang-6fe6b92b.js";import{g as vt,r as tt,a as et}from"./index.esm2017-f1785873.js";import{P as j,_ as B,R as x,b as E,d as F,g as y,a as b,c as J}from"./index.esm2017-3589eea2.js";import{_ as gt}from"./useLoadingPage.vue_vue_type_style_index_0_lang-d974f102.js";import{a as yt}from"./axios-4a70c6fc.js";import{c as ot}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as W}from"./useUserDetails.vue_vue_type_script_lang-8130a85e.js";import{u as Pt}from"./useLikeButton-25f53cfb.js";W();function ht(m){const{app:r}=D(),U=j(r),w=H(),s=B(U,"users");async function g(){w.signedUser.id===void 0||w.signedUser.id===""?(console.log("not signed in"),K.push("/login")):C()}async function C(){try{const t=x(s,E("id","==",`${w.signedUser.id}`)),o=(await F(t)).docs[0].data(),u=x(s,E("id","==",`${m}`)),n=(await F(u)).docs[0].data(),I=[...o.following.theFollowings,m],A=I.length,R=[...n.followers.theFollowers,w.signedUser.id],p=R.length,T=y(U,"users",m),v=y(U,"users",w.signedUser.id);await b(T,{["followers.theFollowers"]:R,["followers.total"]:p,notifications:[...n.notifications,{type:`${w.signedUser.fullName} started following you`,details:{followerId:w.signedUser.id,time:new Date}}]}),await b(v,{["following.theFollowings"]:I,["following.total"]:A,activityLog:[...o.activityLog,{type:"New following",details:{followingId:m,time:new Date}}]})}catch(t){console.error(t)}}g()}function Ct(m,r){W();const{app:U}=D(),w=j(U),s=H(),g=B(w,"users");C();async function C(){try{const t=x(g,E("id","==",`${s.signedUser.id}`)),o=(await F(t)).docs[0].data(),u=x(g,E("id","==",`${m}`)),n=(await F(u)).docs[0].data(),I=o.following.theFollowings.filter(e=>e!==m),A=I.length,R=n.followers.theFollowers.filter(e=>e!==s.signedUser.id),p=R.length,T=y(w,"users",m),v=y(w,"users",s.signedUser.id);await b(T,{["followers.theFollowers"]:R,["followers.total"]:p}),await b(v,{["following.theFollowings"]:I,["following.total"]:A,activityLog:[...o.activityLog,{type:`You unfollowed ${r}`,details:{followingId:m,time:new Date}}]})}catch(t){console.error(t)}}}const st=H();W();async function Ut(m,r){const{app:U}=D(),w=j(U),s=B(w,"users");if(st.signedUser.id===void 0||st.signedUser.id==="")return console.log("not signed in"),!1;return await g();async function g(){try{const C=x(s,E("id","==",`${r}`)),t=x(s,E("id","==",`${m}`)),i=await F(C),o=await F(t),u=i.docs[0].data();return o.docs[0].data().followers.theFollowers.includes(r)&&u.following.theFollowings.includes(m)}catch{return console.log(r,m),!1}}}const It=Q({__name:"useAddComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String},setup(m){const r=m,{app:U}=D(),w=H(),s=j(U),g=M("");async function C(){const i=y(s,"posts",r.viewPostId);await J(i).then(o=>{w.viwedPost=o.data()}).catch(o=>{console.log(o)})}async function t(i,o,u,P){if(i===""||i===void 0)return K.push("/login");if(P.trim()==="")console.log("comment cannot be empty");else{document.getElementById("btnAddcomment").setAttribute("disabled","true");const n=x(B(s,"users"),E("id","==",`${i}`)),h=x(B(s,"posts"),E("postId","==",`${o}`)),I=x(B(s,"users"),E("id","==",`${u}`));try{F(n).then(A=>{const f=A.docs[0].data();F(h).then(R=>{const p=R.docs[0].data();F(I).then(T=>{const v=T.docs[0].data(),e={commentId:p.postComments.count,details:P,time:new Date};function $(l){return f.comments.out.map(d=>{if(d.postId===o)return{...d,commentArr:[...d.commentArr,l]}})}function a(l){return v.comments.in.map(d=>{if(d.postId===o)return{...d,commentArr:[...d.commentArr,l]}})}f.comments.out.some(l=>l.postId===o)?b(y(s,"users",`${i}`),{["comments.out"]:$(e),["comments.total.out"]:f.comments.total.out+1,activityLog:[...f.activityLog,{type:"You added another comment on this post",details:{commentId:p.postComments.count,postId:o,text:e.details,time:e.time}}],interactions:[...f.interactions,{type:"Commented on this post",details:{commentId:p.postComments.count,postid:o,text:e.details,time:e.time}}]}):b(y(s,"users",`${i}`),{["comments.out"]:[...f.comments.out,{postId:o,commentArr:[e]}],["comments.total.out"]:f.comments.total.out+1,activityLog:[...f.activityLog,{type:"You commented on this post",details:{commentId:p.postComments.count,postId:o,text:e.details,time:e.time}}],interactions:[...f.interactions,{type:"Commented on this post",details:{commentId:p.postComments.count,postid:o,text:e.details,time:e.time}}]}),p.postComments&&b(y(s,"posts",`${o}`),{["postComments.details"]:[...p.postComments.details,{commentId:p.postComments.count,id:i,text:e.details,time:e.time}],["postComments.total"]:p.postComments.total+1,["postComments.count"]:p.postComments.count+1}),v.comments.in.some(l=>l.postId===o)?b(y(s,"users",`${u}`),{["comments.in"]:a(e),["comments.total.in"]:v.comments.total.in+1,notifications:[...v.notifications,{type:`Your got a comment from <b>${f.fullName}</b> on a post`,details:{commentId:p.postComments.count,postid:o,text:e.details,time:e.time}}]}):b(y(s,"users",`${u}`),{["comments.in"]:[...v.comments.in,{postId:o,commentArr:[e]}],["comments.total.in"]:v.comments.total.in+1,notifications:[...v.notifications,{type:`Your got a comment from <b>${f.fullName}</b> on a post`,details:{commentId:p.postComments.count,postid:o,text:e.details,time:e.time}}]}),g.value="",document.getElementById("btnAddcomment").removeAttribute("disabled"),C()})})})}catch(A){console.log(A),document.getElementById("btnAddcomment").removeAttribute("disabled")}}}return(i,o)=>(k(),L("div",null,[c("div",null,[nt(c("textarea",{"onUpdate:modelValue":o[0]||(o[0]=u=>g.value=u)},null,512),[[it,g.value]]),c("button",{onClick:o[1]||(o[1]=Y(u=>t(r.currentUserId,r.viewPostId,r.viewPostPosterId,g.value),["prevent"])),id:"btnAddcomment"},[Z("Add the "),c("span",null,O(_(w).viwedPost.postComments.total+1),1),Z(" Comment")])])]))}}),At=Q({__name:"useDeleteComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String},setup(m){const r=m,{app:U}=D(),w=H(),s=j(U);async function g(){const t=y(s,"posts",r.viewPostId);await J(t).then(i=>{w.viwedPost=i.data()}).catch(i=>{console.log(i)})}async function C(t,i,o,u,P){if(t===""||t===void 0)return K.push("/login");{const n=x(B(s,"users"),E("id","==",`${t}`)),h=x(B(s,"posts"),E("postId","==",`${i}`)),I=x(B(s,"users"),E("id","==",`${o}`));try{F(n).then(A=>{const f=A.docs[0].data();F(h).then(R=>{const p=R.docs[0].data();F(I).then(T=>{const v=T.docs[0].data();function e(a){return a.comments.out.map(d=>{if(d.postId===i)if(d.commentArr.length>1){const z=d.commentArr.filter(N=>N.commentId!==u);return{...d,commentArr:z}}else return null;return d}).filter(d=>d!==null)}function $(a){return a.comments.in.map(d=>{if(d.postId===i)if(d.commentArr.length>1){const z=d.commentArr.filter(N=>N.commentId!==u);return{...d,commentArr:z}}else return null;return d}).filter(d=>d!==null)}f.comments.out.some(a=>a.postId===i)&&b(y(s,"users",`${t}`),{["comments.out"]:e(f),["comments.total.out"]:f.comments.total.out-1,activityLog:[...f.activityLog,{type:"You deleted a comment on this post",details:{commentId:u,postId:i,text:P,time:new Date}}],interactions:f.interactions.filter(a=>a.details.commentId!==u)}),p.postComments&&b(y(s,"posts",`${i}`),{["postComments.details"]:p.postComments.details.filter(a=>a.commentId!==u),["postComments.total"]:p.postComments.total-1}),v.comments.in.some(a=>a.postId===i)&&b(y(s,"users",`${o}`),{["comments.in"]:$(v),["comments.total.in"]:v.comments.total.in-1,notifications:v.notifications.filter(a=>a.details.commentId!==u)}),g()})})})}catch(A){console.log(A)}}}return(t,i)=>(k(),L("button",{onClick:i[0]||(i[0]=Y(o=>C(r.currentUserId,r.viewPostId,r.viewPostPosterId,m.commentId,m.commentText),["prevent"]))},"Delete"))}}),_t={key:1,id:"editContainer"},bt={id:"centerContainer"},$t=["onClick"],kt=Q({__name:"useEditComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String,divEditId:String},setup(m){const r=m,{app:U}=D(),w=H(),s=j(U),g=M(""),C=M(!1);async function t(){const P=y(s,"posts",r.viewPostId);await J(P).then(n=>{w.viwedPost=n.data()}).catch(n=>{console.log(n)})}async function i(P,n,h,I,A){if(P===""||P===void 0)return K.push("/login");if(I.trim()==="")console.log("Comment cannot be empty");else{document.getElementById("btnEditComment").setAttribute("disabled","true");const f=x(B(s,"users"),E("id","==",`${P}`)),R=x(B(s,"posts"),E("postId","==",`${n}`)),p=x(B(s,"users"),E("id","==",`${h}`));try{F(f).then(T=>{const v=T.docs[0].data();F(R).then(e=>{const $=e.docs[0].data();F(p).then(a=>{const l=a.docs[0].data();function S(){return v.comments.out.map(q=>{if(q.postId===n){const X=q.commentArr.map(V=>V.commentId===A?{...V,details:I}:V);return{...q,commentArr:X}}return q})}function d(){return l.comments.in.map(q=>{if(q.postId===n){const X=q.commentArr.map(V=>V.commentId===A?{...V,details:I}:V);return{...q,commentArr:X}}return q})}function z(){return $.postComments.details.map(q=>q.commentId===A?{...q,text:I}:q)}v.comments.out.some(N=>N.postId===n)&&b(y(s,"users",`${P}`),{["comments.out"]:S(),activityLog:[...v.activityLog,{type:"You edited your comment on this post",details:{commentId:$.postComments.count,postId:n,text:I,time:new Date}}]}),$.postComments&&b(y(s,"posts",`${n}`),{["postComments.details"]:z()}),l.comments.in.some(N=>N.postId===n)&&b(y(s,"users",`${h}`),{["comments.in"]:d()}),document.getElementById("btnEditComment").removeAttribute("disabled"),t(),C.value=!1})})})}catch(T){console.log(T),document.getElementById("btnEditComment").removeAttribute("disabled")}}}function o(P){const n=document.getElementById(`${P}`);g.value=n.innerText,C.value=!0}function u(){document.getElementById("btnEditComment").setAttribute("disabled","true"),g.value="",C.value=!1}return(P,n)=>C.value?(k(),L("div",_t,[c("div",bt,[nt(c("textarea",{"onUpdate:modelValue":n[1]||(n[1]=h=>g.value=h)},null,512),[[it,g.value]]),c("button",{id:"btnEditComment",onClick:n[2]||(n[2]=Y(h=>i(r.currentUserId,r.viewPostId,r.viewPostPosterId,g.value,m.commentId),["prevent"]))},"Update"),c("button",{onClick:Y(u,["prevent"])},"Cancel",8,$t)])])):(k(),L("button",{key:0,onClick:n[0]||(n[0]=Y(h=>o(r.divEditId),["prevent"]))},"Edit"))}});const xt=rt(kt,[["__scopeId","data-v-5b33aa43"]]),Et={key:1},Ft={key:0},Lt=["src"],Rt={key:0},Tt=["onClick"],St=["onClick"],qt=["innerHTML"],Bt={key:0},Nt={key:1},Mt=["id"],Vt={key:1},Ot=c("h1",null,"Post not found or Deleted",-1),Yt=c("button",null,"Expore Chatter",-1),Dt=c("button",null,"Home",-1),Zt=Q({__name:"PostPage",props:["postId"],setup(m){const r=m;W();const U=M(!0),w=M(""),s=M([]),{app:g}=D(),C=j(g),t=H(),i=at(),o=vt(g),u=y(C,"posts",r.postId),P=new DOMParser,n=M([]),h=M(!1);async function I(){try{await Promise.all(t.viwedPost.postMedia.map(async e=>{const $=tt(o,e.mediaFullPath),a=await et($);s.value.push(a)})).catch(()=>{console.log("error")})}catch(e){console.log(e)}}async function A(){try{const e=await J(u);e.data()!==void 0&&(t.viwedPost=e.data(),I(),f(),R(),b(u,{postViews:t.viwedPost.postViews+1}))}catch{i.push("/error")}}dt(()=>{A().then(()=>{U.value=!1})});async function f(){try{const e=tt(o,t.viwedPost.postContain),$=await et(e).catch(a=>{console.log(a)});await yt.post("/postContent",{contentUrl:$}).then(a=>{const l=P.parseFromString(a.data,"text/html");l.body.querySelectorAll("img, video").forEach((S,d)=>{S.setAttribute("src",`${s.value[d]}`)}),w.value=l.body.innerHTML}).catch(a=>{console.log(a)})}catch(e){console.log(e)}}async function R(){try{const e=y(C,"users",t.viwedPost.posterId),$=await J(e);if($.data()!==void 0){const{fullName:a,profilePicture:l}=$.data(),S={fullName:a,profilePicture:l,id:v};n.value.push(S),await Ut(t.viwedPost.posterId,t.signedUser.id).then(d=>{h.value=d})}}catch{}}async function p(){Ct(t.viwedPost.posterId,n.value[0].fullName),h.value=!h.value}async function T(){ht(t.viwedPost.posterId),h.value=!h.value}let v=setTimeout(()=>{U.value=!1},5e3);return ct(()=>{clearTimeout(v);const e=document.getElementById("warningShow");e.style.display="none"}),(e,$)=>{const a=lt("RouterLink");return U.value?(k(),mt(gt,{key:0,"action-name":"Loading Post..."})):(k(),L("main",Et,[_(t).viwedPost.posterId!==void 0?(k(),L("div",Ft,[c("h1",null,O(_(t).viwedPost.postTitle.join(" ")),1),c("div",null,[c("div",null,[c("img",{src:n.value[0].profilePicture,width:"50",height:"50"},null,8,Lt),c("h3",null,O(n.value[0].fullName),1),_(t).signedUser.id!==_(t).viwedPost.posterId?(k(),L("div",Rt,[h.value?(k(),L("button",{key:0,onClick:Y(p,["prevent"])},"UnFollow",8,Tt)):(k(),L("button",{key:1,onClick:Y(T,["prevent"])},"Follow",8,St))])):ut("",!0)])]),c("div",null,O(ot(_(t).viwedPost.postTime.seconds)),1),c("div",{innerHTML:w.value},null,8,qt),c("div",null,[G(Pt,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])]),c("div",null,[c("div",null,[_(t).viwedPost.postComments.total<1?(k(),L("p",Bt,"No comments yet")):(k(),L("div",Nt,[(k(!0),L(pt,null,wt(_(t).viwedPost.postComments.details,(l,S)=>(k(),L("div",{key:S},[c("p",null,"postId: "+O(l.id),1),c("div",{id:S.toString()+"commentDiv"},O(l.text),9,Mt),c("p",null,"Time: "+O(ot(l.time.seconds)),1),c("div",null,[G(At,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId,commentId:l.commentId,commentText:l.text},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText"]),G(xt,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId,commentId:l.commentId,commentText:l.text,divEditId:S.toString()+"commentDiv"},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText","divEditId"])])]))),128))]))]),G(It,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])])])):(k(),L("div",Vt,[Ot,c("div",null,[Yt,G(a,{to:"/"},{default:ft(()=>[Dt]),_:1})])]))]))}}});export{Zt as default};
