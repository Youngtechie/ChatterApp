import{d as U,r as m,u as H,o as z,x as T,s as A,a as V,c as p,f as g,F as Q,y as O,k as E,w as f,z as j,g as i,n as G,t as I,i as J,p as K,q as W,_ as X}from"./index-3c7daa31.js";import{u as Y,P as Z,a as ee,R as M,k as D,x as L,_ as N,d as te,g as oe,e as ne,F as se}from"./useAuth.vue_vue_type_script_lang-0a2c6dcb.js";import{g as ae,r as re,a as le}from"./index.esm2017-3ce07352.js";import{u as ie}from"./useUserDetails.vue_vue_type_script_lang-f8979881.js";import{a as ce}from"./axios-4a70c6fc.js";import{c as ue,u as de}from"./useDetailButtons-13ec496c.js";const me=h=>(K("data-v-9f5b8b92"),h=h(),W(),h),pe={class:"exploreSection"},ge=me(()=>i("h2",null,"Exploring Posts",-1)),he={key:0,class:j({resultsContainer:!0})},ve=["onClick"],fe={class:"result-item-other"},_e={class:"result-item-header"},ye=["onClick"],we=["innerHTML","onClick"],Ce=["onClick"],Se=U({__name:"ExplorePage",setup(h){ie();const c=m([]),u=m(""),C=new DOMParser,_=H(),{app:S}=Y(),R=ae(S),y=Z(S),x=ee();x.sidebar=!1;const d=m(null),v=m(),b=m(!0);z(()=>{T(()=>{const e=document.getElementById("warningShow");e&&(e.style.display="flex",e.textContent="Loading ...")}),d.value=M(N(y,"posts"),L("postTime","desc"),D(15)),k(d.value)});async function q(e){u.value="";try{const o=re(R,e.postContain),n=await le(o).catch(s=>{console.log(s)});await ce.post("/postContent",{contentUrl:n}).then(s=>{const t=C.parseFromString(s.data,"text/html");u.value=t.body.innerHTML}).catch(s=>{console.log(s)})}catch{const n=document.querySelector("#ErrorShow span");n.style.display="flex",n.textContent="Something went wrong, check your internet connection and reload page"}}async function B(e){v.value=null;try{const o=oe(y,"users",e),n=await ne(o);if(n.data()!==void 0){const{fullName:s,profilePicture:t,username:a,blogName:r}=n.data(),l={profilePicture:t,posterID:e,fullName:s,username:a,blogName:r};v.value={id:e,img:l.profilePicture,fullName:l.fullName,username:l.username,blogname:l.blogName}}}catch{}}async function k(e){const n=(await te(e)).docs.map(async t=>{var l;const a=t.data();await q(a);const r=C.parseFromString(u.value,"text/html");return r.body.querySelectorAll("img").forEach(w=>{w.remove()}),r.body.querySelectorAll("video").forEach(w=>{w.remove()}),(l=r.body.querySelector("h1"))==null||l.remove(),u.value=r.body.innerHTML,a.postContain=u.value,await B(a.posterId),a.posterDetails=v.value,a}),s=await Promise.all(n);c.value=s,v.value=null,b.value=!1}function $(){const e=d.value.docs[d.value.docs.length-1],o=M(N(y,"cities"),L("postTime","desc"),se(e),D(15));k(o).then(()=>{d.value=o})}function F(e){_.push(`/post/${e}`)}function P(e){if(e===x.signedUser.id)return _.push("/userProfile");_.push(`/chatterUser/${e}`)}return A(()=>{var e;((e=c.value)==null?void 0:e.length)>0&&T(()=>{const o=document.getElementById("warningShow");o&&(o.style.display="none")})}),V(()=>{const e=document.getElementById("warningShow");e.style.display="none"}),(e,o)=>{var n,s;return p(),g("main",pe,[ge,((n=c.value)==null?void 0:n.length)>0&&b.value===!1?(p(),g("div",he,[(p(!0),g(Q,null,O(c.value,(t,a)=>(p(),g("div",{key:a,class:"result-item"},[i("div",{class:"imgCon",onClick:f(r=>P(t.posterId),["prevent"]),style:G({backgroundImage:`url(${t==null?void 0:t.posterDetails.img})`})},null,12,ve),i("div",fe,[i("div",_e,[i("span",{onClick:f(r=>P(t.posterId),["prevent"])},I(t==null?void 0:t.posterDetails.blogname),9,ye),i("span",null,I(ue(t.postTime.seconds)),1)]),i("div",{innerHTML:t.postContain,id:"divContent",onClick:f(r=>F(t.postId),["prevent"])},null,8,we),J(de,{post:t},null,8,["post"])])]))),128))])):E("",!0),((s=c.value)==null?void 0:s.length)===15?(p(),g("button",{key:1,onClick:f($,["prevent"])},"See More ....",8,Ce)):E("",!0)])}}});const Ie=X(Se,[["__scopeId","data-v-9f5b8b92"]]);export{Ie as default};
