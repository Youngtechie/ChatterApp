import{G as Q,d as W,r as O,c as C,f as A,m as it,B as rt,g as n,w as M,_ as X,u as dt,o as at,a as ct,b as lt,e as mt,j as p,t as V,n as ut,k as et,h as H,F as pt,y as vt,i as ot,p as wt,q as ft}from"./index-9d180844.js";import{u as j,a as G}from"./useAuth.vue_vue_type_script_lang-345c5324.js";import{P as z,_ as N,R as S,b as B,d as T,g as h,a as E,c as J,I as gt}from"./index.esm2017-b1be84ac.js";import{_ as _t}from"./useLoadingPage.vue_vue_type_style_index_0_lang-aca7865e.js";import{a as ht}from"./axios-4a70c6fc.js";import{c as st}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as Z}from"./useUserDetails.vue_vue_type_script_lang-331a5968.js";import{u as yt}from"./useDetailButtons-3c685b48.js";Z();function Pt(a){const{app:c}=j(),k=z(c),d=G(),i=N(k,"users");async function I(){d.signedUser.id===void 0||d.signedUser.id===""?(console.log("not signed in"),Q.push("/login")):v()}async function v(){try{const t=S(i,B("id","==",`${d.signedUser.id}`)),y=(await T(t)).docs[0].data(),U=S(i,B("id","==",`${a}`)),o=(await T(U)).docs[0].data(),m=[...y.following.theFollowings,a],F=m.length,R=[...o.followers.theFollowers,d.signedUser.id],P=R.length,l=h(k,"users",a),b=h(k,"users",d.signedUser.id);await E(l,{["followers.theFollowers"]:R,["followers.total"]:P,notifications:[...o.notifications,{type:`${d.signedUser.fullName} started following you`,details:{followerId:d.signedUser.id,time:new Date}}]}),await E(b,{["following.theFollowings"]:m,["following.total"]:F,activityLog:[...y.activityLog,{type:"New following",details:{followingId:a,time:new Date}}]})}catch(t){console.error(t)}}I()}function Ct(a,c){Z();const{app:k}=j(),d=z(k),i=G(),I=N(d,"users");v();async function v(){try{const t=S(I,B("id","==",`${i.signedUser.id}`)),y=(await T(t)).docs[0].data(),U=S(I,B("id","==",`${a}`)),o=(await T(U)).docs[0].data(),m=y.following.theFollowings.filter(D=>D!==a),F=m.length,R=o.followers.theFollowers.filter(D=>D!==i.signedUser.id),P=R.length,l=h(d,"users",a),b=h(d,"users",i.signedUser.id);await E(l,{["followers.theFollowers"]:R,["followers.total"]:P}),await E(b,{["following.theFollowings"]:m,["following.total"]:F,activityLog:[...y.activityLog,{type:`You unfollowed ${c}`,details:{followingId:a,time:new Date}}]})}catch(t){console.error(t)}}}const nt=G();Z();async function It(a,c){const{app:k}=j(),d=z(k),i=N(d,"users");if(nt.signedUser.id===void 0||nt.signedUser.id==="")return console.log("not signed in"),!1;return await I();async function I(){try{const v=S(i,B("id","==",`${c}`)),t=S(i,B("id","==",`${a}`)),r=await T(v),y=await T(t),U=r.docs[0].data();return y.docs[0].data().followers.theFollowers.includes(c)&&U.following.theFollowings.includes(a)}catch{return console.log(c,a),!1}}}const Ut={class:"commentAdd"},bt=W({__name:"useAddComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String},setup(a){const c=a,{app:k}=j(),d=z(k),i=O("");async function I(v,t,r,y){if(v===""||v===void 0)return Q.push("/login");if(y.trim()==="")console.log("comment cannot be empty");else{document.getElementById("btnAddcomment").setAttribute("disabled","true");const U=S(N(d,"users"),B("id","==",`${v}`)),_=S(N(d,"posts"),B("postId","==",`${t}`)),o=S(N(d,"users"),B("id","==",`${r}`));try{T(U).then(x=>{const m=x.docs[0].data();T(_).then(F=>{const g=F.docs[0].data();T(o).then(R=>{const P=R.docs[0].data(),l={commentId:g.postComments.count,details:y,time:new Date};function b(e){return m.comments.out.map(f=>{if(f.postId===t)return{...f,commentArr:[...f.commentArr,e]}})}function D(e){return P.comments.in.map(f=>{if(f.postId===t)return{...f,commentArr:[...f.commentArr,e]}})}m.comments.out.some(e=>e.postId===t)?E(h(d,"users",`${v}`),{["comments.out"]:b(l),["comments.total.out"]:m.comments.total.out+1,activityLog:[...m.activityLog,{type:"You added another comment on this post",details:{commentId:g.postComments.count,postId:t,text:l.details,time:l.time}}]}):E(h(d,"users",`${v}`),{["comments.out"]:[...m.comments.out,{postId:t,commentArr:[l]}],["comments.total.out"]:m.comments.total.out+1,activityLog:[...m.activityLog,{type:"You commented on this post",details:{commentId:g.postComments.count,postId:t,text:l.details,time:l.time}}],interactions:[...m.interactions,{type:"Commented on this post",details:{commentId:g.postComments.count,postid:t,text:l.details,time:l.time}}]}),g.postComments&&E(h(d,"posts",`${t}`),{["postComments.details"]:[...g.postComments.details,{commentId:g.postComments.count,id:v,text:l.details,time:l.time}],["postComments.total"]:g.postComments.total+1,["postComments.count"]:g.postComments.count+1}),P.comments.in.some(e=>e.postId===t)?E(h(d,"users",`${r}`),{["comments.in"]:D(l),["comments.total.in"]:P.comments.total.in+1,notifications:[...P.notifications,{type:`Your got a comment from <b>${m.fullName}</b> on a post`,details:{commentId:g.postComments.count,postid:t,text:l.details,time:l.time}}]}):E(h(d,"users",`${r}`),{["comments.in"]:[...P.comments.in,{postId:t,commentArr:[l]}],["comments.total.in"]:P.comments.total.in+1,notifications:[...P.notifications,{type:`Your got a comment from <b>${m.fullName}</b> on a post`,details:{commentId:g.postComments.count,postid:t,text:l.details,time:l.time}}]}),i.value="",document.getElementById("btnAddcomment").removeAttribute("disabled")})})})}catch(x){console.log(x),document.getElementById("btnAddcomment").removeAttribute("disabled")}}}return(v,t)=>(C(),A("div",Ut,[it(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=r=>i.value=r),minlength:"1",maxlength:"1000"},null,512),[[rt,i.value]]),n("button",{onClick:t[1]||(t[1]=M(r=>I(c.currentUserId,c.viewPostId,c.viewPostPosterId,i.value),["prevent"])),id:"btnAddcomment"},"Add Comment")]))}});const At=X(bt,[["__scopeId","data-v-236be6de"]]),$t=W({__name:"useDeleteComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String},setup(a){const c=a,{app:k}=j(),d=G(),i=z(k);async function I(){const t=h(i,"posts",c.viewPostId);await J(t).then(r=>{d.viwedPost=r.data()}).catch(r=>{console.log(r)})}async function v(t,r,y,U,_){if(t===""||t===void 0)return Q.push("/login");{const o=S(N(i,"users"),B("id","==",`${t}`)),x=S(N(i,"posts"),B("postId","==",`${r}`)),m=S(N(i,"users"),B("id","==",`${y}`));try{T(o).then(F=>{const g=F.docs[0].data();T(x).then(R=>{const P=R.docs[0].data();T(m).then(l=>{const b=l.docs[0].data();function D(s){return s.comments.out.map(u=>{if(u.postId===r)if(u.commentArr.length>1){const q=u.commentArr.filter(L=>L.commentId!==U);return{...u,commentArr:q}}else return null;return u}).filter(u=>u!==null)}function e(s){return s.comments.in.map(u=>{if(u.postId===r)if(u.commentArr.length>1){const q=u.commentArr.filter(L=>L.commentId!==U);return{...u,commentArr:q}}else return null;return u}).filter(u=>u!==null)}g.comments.out.some(s=>s.postId===r)&&E(h(i,"users",`${t}`),{["comments.out"]:D(g),["comments.total.out"]:g.comments.total.out-1,activityLog:[...g.activityLog,{type:"You deleted a comment on this post",details:{commentId:U,postId:r,text:_,time:new Date}}],interactions:g.interactions.filter(s=>s.details.commentId!==U)}),P.postComments&&E(h(i,"posts",`${r}`),{["postComments.details"]:P.postComments.details.filter(s=>s.commentId!==U),["postComments.total"]:P.postComments.total-1}),b.comments.in.some(s=>s.postId===r)&&E(h(i,"users",`${y}`),{["comments.in"]:e(b),["comments.total.in"]:b.comments.total.in-1,notifications:b.notifications.filter(s=>s.details.commentId!==U)}),I()})})})}catch(F){console.log(F)}}}return(t,r)=>(C(),A("button",{class:"delBtn",onClick:r[0]||(r[0]=M(y=>v(c.currentUserId,c.viewPostId,c.viewPostPosterId,a.commentId,a.commentText),["prevent"]))},"Delete"))}});const kt=X($t,[["__scopeId","data-v-dfbcd91a"]]),xt={key:1,id:"editContainer"},Et={id:"centerContainer"},Ft=["onClick"],St=W({__name:"useEditComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String,divEditId:String},setup(a){const c=a,{app:k}=j(),d=G(),i=z(k),I=O(""),v=O(!1);async function t(){const _=h(i,"posts",c.viewPostId);await J(_).then(o=>{d.viwedPost=o.data()}).catch(o=>{console.log(o)})}async function r(_,o,x,m,F){if(_===""||_===void 0)return Q.push("/login");if(m.trim()==="")console.log("Comment cannot be empty");else{document.getElementById("btnEditComment").setAttribute("disabled","true");const g=S(N(i,"users"),B("id","==",`${_}`)),R=S(N(i,"posts"),B("postId","==",`${o}`)),P=S(N(i,"users"),B("id","==",`${x}`));try{T(g).then(l=>{const b=l.docs[0].data();T(R).then(D=>{const e=D.docs[0].data();T(P).then(s=>{const f=s.docs[0].data();function w(){return b.comments.out.map($=>{if($.postId===o){const tt=$.commentArr.map(Y=>Y.commentId===F?{...Y,details:m}:Y);return{...$,commentArr:tt}}return $})}function u(){return f.comments.in.map($=>{if($.postId===o){const tt=$.commentArr.map(Y=>Y.commentId===F?{...Y,details:m}:Y);return{...$,commentArr:tt}}return $})}function q(){return e.postComments.details.map($=>$.commentId===F?{...$,text:m}:$)}b.comments.out.some(L=>L.postId===o)&&E(h(i,"users",`${_}`),{["comments.out"]:w(),activityLog:[...b.activityLog,{type:"You edited your comment on this post",details:{commentId:e.postComments.count,postId:o,text:m,time:new Date}}]}),e.postComments&&E(h(i,"posts",`${o}`),{["postComments.details"]:q()}),f.comments.in.some(L=>L.postId===o)&&E(h(i,"users",`${x}`),{["comments.in"]:u()}),document.getElementById("btnEditComment").removeAttribute("disabled"),t(),v.value=!1})})})}catch(l){console.log(l),document.getElementById("btnEditComment").removeAttribute("disabled")}}}function y(_){const o=document.getElementById(`${_}`);I.value=o.innerText,v.value=!0}function U(){document.getElementById("btnEditComment").setAttribute("disabled","true"),I.value="",v.value=!1}return(_,o)=>v.value?(C(),A("div",xt,[n("div",Et,[it(n("textarea",{"onUpdate:modelValue":o[1]||(o[1]=x=>I.value=x)},null,512),[[rt,I.value]]),n("button",{id:"btnEditComment",onClick:o[2]||(o[2]=M(x=>r(c.currentUserId,c.viewPostId,c.viewPostPosterId,I.value,a.commentId),["prevent"]))},"Update"),n("button",{onClick:M(U,["prevent"])},"Cancel",8,Ft)])])):(C(),A("button",{key:0,onClick:o[0]||(o[0]=M(x=>y(c.divEditId),["prevent"])),class:"editBTn"},"Edit"))}});const Bt=X(St,[["__scopeId","data-v-898f2d19"]]),K=a=>(wt("data-v-3e2d9838"),a=a(),ft(),a),Tt={key:1,class:"postFullDetails"},Lt=["onClick"],Rt=["title"],qt={id:"themeImgContainer"},Nt=["src"],Dt={key:0,class:"postBody"},Mt={key:0},Vt={key:1,class:"coverImage"},Ot=["src"],Yt={class:"section1"},Ht={class:"details"},jt={key:0},zt=["onClick"],Gt=["onClick"],Jt={class:"timePosted"},Kt=["innerHTML"],Qt={class:"btnsMore"},Wt={class:"commentingSection"},Xt={key:0},Zt={key:1,class:"commentAction"},te={class:"commenter"},ee=["onClick"],oe=["id"],se={key:0,class:"commenterBtn"},ne={key:2},ie={key:1},re=K(()=>n("h1",null,"Post not found or Deleted",-1)),de=K(()=>n("button",null,"Expore Chatter",-1)),ae=K(()=>n("button",null,"Home",-1)),ce={id:"navigators"},le=K(()=>n("button",null,"Home",-1)),me=K(()=>n("button",null,"Search",-1)),ue=W({__name:"PostPage",props:["postId"],setup(a){const c=a;Z();const k=O(!0),d=O(""),i=O([]),{app:I}=j(),v=z(I),t=G(),r=dt(),y=h(v,"posts",c.postId),U=new DOMParser,_=O([]),o=O(!1);async function x(){try{await Promise.all(t.viwedPost.postMedia.map(async e=>{i.value.push(e.mediaFullPath)})).catch(()=>{console.log("error")})}catch(e){console.log(e)}}async function m(){try{await Promise.all(t.viwedPost.postComments.details.map(async(e,s)=>{const f=h(v,"users",e.id),w=await J(f);if(w.data()!==void 0){const{fullName:u,id:q,username:L}=w.data(),$={fullName:u,id:q,username:L};t.viwedPost.postComments.details[s].posterDetails=$}}))}catch(e){console.log(e)}}async function F(){try{const e=await J(y);e.data()!==void 0&&(t.viwedPost=e.data(),x(),g(),R(),m(),E(y,{postViews:t.viwedPost.postViews+1}).finally(()=>{k.value=!1}))}catch(e){console.error(e)}}at(()=>{const e=h(v,"posts",c.postId);try{gt(e,s=>{t.viwedPost=s.data(),m()})}catch{}F()});async function g(){try{const e=t.viwedPost.postContain;await ht.post("/postContent",{contentUrl:e}).then(s=>{var w;const f=U.parseFromString(s.data,"text/html");f.body.querySelectorAll("img, video").forEach((u,q)=>{u.setAttribute("src",`${i.value[q]}`)}),(w=f.body.querySelector("h1"))==null||w.remove(),d.value=f.body.innerHTML}).catch(s=>{console.log(s)})}catch(e){console.log(e)}}async function R(){try{const e=h(v,"users",t.viwedPost.posterId),s=await J(e);if(s.data()!==void 0){const{blogName:f,profilePicture:w,id:u,username:q}=s.data(),L={blogName:f,profilePicture:w,id:u,username:q};_.value.push(L),await It(t.viwedPost.posterId,t.signedUser.id).then($=>{o.value=$})}}catch{}}async function P(){Ct(t.viwedPost.posterId,_.value[0].blogName),o.value=!o.value}async function l(){Pt(t.viwedPost.posterId),o.value=!o.value}ct(()=>{const e=document.getElementById("warningShow");e.style.display="none"});function b(e){if(e===t.signedUser.id)return r.push("/userProfile");r.push(`/chatterUser/${e}`)}function D(){r.go(-1)}return(e,s)=>{const f=lt("RouterLink");return k.value?(C(),mt(_t,{key:0,"action-name":"Loading Post..."})):(C(),A("main",Tt,[n("header",null,[n("button",{onClick:M(D,["prevent"])},"Back",8,Lt),n("button",{title:p(t).themeDetails.title,id:"themeBtn",onClick:s[0]||(s[0]=(...w)=>p(t).changeTheme&&p(t).changeTheme(...w))},[n("div",qt,[n("img",{src:p(t).themeDetails.img},null,8,Nt)])],8,Rt)]),p(t).viwedPost.posterId!==void 0?(C(),A("div",Dt,[p(t).viwedPost.postCoverImage===""?(C(),A("h1",Mt,V(p(t).viwedPost.postTitle.join(" ")),1)):(C(),A("section",Vt,[n("img",{id:"img",src:p(t).viwedPost.postCoverImage},null,8,Ot),n("h1",null,V(p(t).viwedPost.postTitle.join(" ")),1)])),n("div",Yt,[n("div",Ht,[n("div",{class:"imgCon",onClick:s[1]||(s[1]=M(w=>b(p(t).viwedPost.posterId),["prevent"])),style:ut({backgroundImage:`url(${_.value[0].profilePicture})`})},null,4),n("div",null,[n("h3",{onClick:s[2]||(s[2]=M(w=>b(p(t).viwedPost.posterId),["prevent"]))},V(_.value[0].blogName),1),n("h5",null,"@"+V(_.value[0].username),1)])]),p(t).signedUser.id!==p(t).viwedPost.posterId?(C(),A("div",jt,[o.value?(C(),A("button",{key:0,onClick:M(P,["prevent"])},"UnFollow",8,zt)):(C(),A("button",{key:1,onClick:M(l,["prevent"])},"Follow",8,Gt))])):et("",!0)]),n("div",Jt,V(st(p(t).viwedPost.postTime.seconds)),1),n("div",{innerHTML:d.value,class:"showPost"},null,8,Kt),n("div",Qt,[H(yt,{post:p(t).viwedPost},null,8,["post"])]),n("div",Wt,[p(t).viwedPost.postComments.total===0&&p(t).viwedPost.postSettings.disableComments===!1?(C(),A("h4",Xt," No comments yet. ")):et("",!0),p(t).viwedPost.postSettings.disableComments===!1?(C(),A("div",Zt,[(C(!0),A(pt,null,vt(p(t).viwedPost.postComments.details,(w,u)=>(C(),A("div",{key:u,class:"Eachcomment"},[n("div",te,[n("div",null,[n("h4",{onClick:M(q=>b(w.commenterId),["prevent"])},V(w.posterDetails.fullName),9,ee),n("h5",null,"@"+V(w.posterDetails.username),1)]),n("p",null,V(st(w.time.seconds)),1)]),n("div",{id:u.toString()+"commentDiv",class:"commentShow"},V(w.text),9,oe),p(t).signedUser.id===p(t).viwedPost.posterId?(C(),A("div",se,[H(Bt,{currentUserId:p(t).signedUser.id,viewPostId:c.postId,viewPostPosterId:p(t).viwedPost.posterId,commentId:w.commentId,commentText:w.text,divEditId:u.toString()+"commentDiv"},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText","divEditId"]),H(kt,{currentUserId:p(t).signedUser.id,viewPostId:c.postId,viewPostPosterId:p(t).viwedPost.posterId,commentId:w.commentId,commentText:w.text},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText"])])):et("",!0)]))),128)),H(At,{currentUserId:p(t).signedUser.id,viewPostId:c.postId,viewPostPosterId:p(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])])):(C(),A("h4",ne,"Commenting on this post is disabled."))])])):(C(),A("div",ie,[re,n("div",null,[de,H(f,{to:"/"},{default:ot(()=>[ae]),_:1})])])),n("section",ce,[H(f,{to:"/home"},{default:ot(()=>[le]),_:1}),H(f,{to:"/search"},{default:ot(()=>[me]),_:1})])]))}}});const Pe=X(ue,[["__scopeId","data-v-3e2d9838"]]);export{Pe as default};
