import{d as ee,u as te,r as b,o as ne,y as E,a as se,b as oe,c as u,e as ie,f as m,g as e,w as v,j as a,k as ae,t as r,l as S,h as I,i as D,n as x,m as h,F as le,z as re,q as ce,s as de}from"./index-4deccaec.js";import{a as ue,u as pe}from"./useAuth.vue_vue_type_script_lang-7f3dced0.js";import{_ as me}from"./useLoadingPage.vue_vue_type_style_index_0_lang-a1ca09d8.js";import{g as he,r as ge,l as ye,d as _e}from"./index.esm2017-36f48363.js";import{P as fe,R as M,_ as H,b as O,k as we,d as V,g as T,c as ve,y as j}from"./index.esm2017-190d47df.js";import{u as Se}from"./useUserDetails.vue_vue_type_script_lang-91448774.js";import{S as z}from"./useSignOut.vue_vue_type_script_lang-e5471536.js";import{c as Ce}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as ke}from"./useDetailButtons-120b6adc.js";import{a as Ue}from"./axios-4a70c6fc.js";import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";const c=C=>(ce("data-v-34b90d44"),C=C(),de(),C),Ie={key:1},xe=["onClick"],Pe=["title"],Be={id:"themeImgContainer"},Ee=["src"],De={class:"body"},Te={class:"imageCon"},Ne={class:"sectionFoImage"},Ae={key:0},Le={class:"follow"},Re=c(()=>e("p",null,"||",-1)),Fe={class:"btns"},$e=c(()=>e("button",null,"Edit Profile",-1)),qe=["onClick"],Me={class:"readerSec"},He={class:"btnSection"},Oe={class:"personalDetails"},Ve=c(()=>e("span",null,"Full Name:",-1)),je=c(()=>e("span",null,"User Name:",-1)),ze=c(()=>e("span",null,"Blog Name:",-1)),Ge={key:0},Qe=c(()=>e("span",null,"Email:",-1)),Je=c(()=>e("span",null,"Location:",-1)),Ke=c(()=>e("span",null,"Birthday:",-1)),We=c(()=>e("span",null,"Gender:",-1)),Xe={key:1},Ye=c(()=>e("span",null,"Interests:",-1)),Ze=c(()=>e("div",{id:"warningShowint"},null,-1)),et={key:0},tt={class:"type"},nt={class:"result-item"},st=["src","alt","onClick"],ot={class:"result-item-other"},it={class:"result-item-header"},at=["onClick"],lt=["innerHTML","onClick"],rt={id:"navigators"},ct=c(()=>e("button",null,"Home",-1)),dt=c(()=>e("button",null,"Search",-1)),ut=c(()=>e("div",{id:"warningShow"},null,-1)),pt=ee({__name:"UserProfile",setup(C){const g=te(),N=b(!0),t=ue();ne(()=>{Se(),E(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="none")}),t.section="personal"});const P=b(),{app:A}=pe(),f=fe(A),G=he(A),L=new DOMParser,w=b(""),y=b([]);async function Q(n){w.value="";const s=n.postContain;await Ue.post("/postContent",{contentUrl:s}).then(o=>{const i=L.parseFromString(o.data,"text/html");w.value=i.body.innerHTML}).catch(o=>{console.log(o)})}async function J(n){P.value=null;const s=T(f,"users",n),o=await ve(s);if(o.data()!==void 0){const{fullName:i,profilePicture:d,username:p,blogName:_}=o.data(),l={profilePicture:d,posterID:n,fullName:i,username:p,blogName:_};P.value={id:n,img:l.profilePicture,fullName:l.fullName,username:l.username,blogname:l.blogName}}}async function K(n){if(n.length>0)try{const s=n.map(async i=>{const d=M(H(f,"posts"),O("postId","==",i.details.postid),we(10)),p=await V(d);return Promise.all(p.docs.map(async _=>{var k;const l=_.data();if(l!=null&&l.length!==0){await Q(l);const U=L.parseFromString(w.value,"text/html");return U.body.querySelectorAll("img").forEach(B=>{B.remove()}),U.body.querySelectorAll("video").forEach(B=>{B.remove()}),(k=U.body.querySelector("h1"))==null||k.remove(),w.value=U.body.innerHTML,l.postContain=w.value,await J(l.posterId).then(()=>{l.posterDetails=P.value}),{type:i.type,postDetails:l}}}))}),o=await Promise.all(s);if(y.value=o.flat(),y.value.length===0){const i=document.getElementById("warningShowint");i.style.display="flex",i.textContent="No interactions yet"}else if(y.value.length>0){const i=document.getElementById("warningShowint");i.style.display="none"}}catch(s){console.log(s);const o=document.getElementById("warningShowint");o.style.display="flex",o.textContent="An error occured, Check your network connection and try again"}else{const s=document.getElementById("warningShowint");s.style.display="flex",s.textContent="No interactions yet"}}function W(){g.go(-1)}function R(n){t.section=n,y.value=[],n==="interaction"&&E(()=>{const s=document.getElementById("warningShowint");s.style.display="flex",s.textContent="Loading ...",K(t.signedUser.interactions)})}function X(n){g.push(`/post/${n}`)}function F(n){if(n===t.signedUser.id)return g.push("/userProfile");g.push(`/chatterUser/${n}`)}async function Y(n){const s=T(f,"users",n);await j(s);const o=M(H(f,"posts"),O("posterId","==",n));(await V(o)).forEach(p=>{const _=p.data(),l=T(f,"posts",_.postId),k=`ChatterAppFiles/posts/${_.postId}`;$(k),j(l)});const d=`ChatterAppFiles/avatar/${n}`;$(d)}async function $(n){const s=ge(G,n),o=await ye(s);if(o.items.length===0)return;const i=o.items.map(d=>_e(d));await Promise.all(i)}async function Z(){if(confirm("Are you sure you want to delete your account?")!==!1)try{const s=document.getElementById("warningShow");s.style.display="flex",s.textContent="Deleting account ...",await Y(t.signedUser.id).then(()=>{s.textContent="Account deleted successfully",z(),setTimeout(()=>{t.authenticated=!1,t.signedUser={},s.style.display="none",g.push("/home")},2e3)}).catch(()=>{const o=document.getElementById("warningShow");o.style.display="flex",o.textContent="An error occured, Check your network connection and try again",setTimeout(()=>{o.style.display="none"},2e3)})}catch{const o=document.getElementById("warningShow");o.style.display="flex",o.textContent="An error occurred, Check your network connection and try again",setTimeout(()=>{o.style.display="none"},2e3)}}let q=setTimeout(()=>{if(t.signedUser.id===void 0&&t.authenticated===!1)g.push("/home");else if(t.authenticated===!0)if(t.signedUser.id!==void 0&&t.signedUser.username===""){const n=document.getElementById("warningShow");n.style.display="flex",n.textContent="Registration not complete... Logging you out",z(),q=setTimeout(()=>{n.style.display="none",t.authenticated=!1,g.push("/login")},2e3)}else t.signedUser.username===void 0&&t.signedUser.id===void 0?E(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="flex",n.textContent="Check your network connection and try again")}):N.value=!1},5e3);return se(()=>{clearTimeout(q);const n=document.getElementById("warningShow");n&&(n.style.display="none");const s=document.getElementById("warningShowint");s&&(s.style.display="none")}),(n,s)=>{const o=oe("RouterLink");return N.value?(u(),ie(me,{key:0,"action-name":"Loading profile..."})):(u(),m("main",Ie,[e("header",null,[e("button",{onClick:v(W,["prevent"])},"Back",8,xe),e("button",{title:a(t).themeDetails.title,id:"themeBtn",onClick:s[0]||(s[0]=(...i)=>a(t).changeTheme&&a(t).changeTheme(...i))},[e("div",Be,[e("img",{src:a(t).themeDetails.img},null,8,Ee)])],8,Pe)]),e("div",De,[e("div",Te,[e("div",{class:"imgCon",style:ae({backgroundImage:`url(${a(t).signedUser.profilePicture})`})},null,4)]),e("section",Ne,[e("h3",null,r(a(t).signedUser.fullName),1),a(t).signedUser.bio.length>0?(u(),m("p",Ae,r(a(t).signedUser.bio),1)):S("",!0),e("div",Le,[e("p",null,r(a(t).signedUser.followers.total)+" Followers",1),Re,e("p",null,r(a(t).signedUser.following.total)+" Following",1)])]),e("div",Fe,[I(o,{to:{name:"EditProfile"}},{default:D(()=>[$e]),_:1}),e("button",{onClick:v(Z,["prevent"])},"Delete Account",8,qe)]),e("div",Me,[e("div",He,[e("button",{onClick:s[1]||(s[1]=i=>R("personal")),class:x({active:a(t).section==="personal"})},"Personal",2),e("button",{onClick:s[2]||(s[2]=i=>R("interaction")),class:x({active:a(t).section==="interaction"})},"Interactions",2)]),e("div",{class:x({show:a(t).section==="personal",none:a(t).section!=="personal",personal:!0})},[e("div",Oe,[e("p",null,[Ve,h(" "+r(a(t).signedUser.fullName),1)]),e("p",null,[je,h(" "+r(a(t).signedUser.username),1)]),e("p",null,[ze,h(" "+r(a(t).signedUser.blogName),1)]),a(t).signedUser.settings.privacySettings.showEmail?(u(),m("p",Ge,[Qe,h(" "+r(a(t).signedUser.email),1)])):S("",!0),e("p",null,[Je,h(" "+r(a(t).signedUser.location),1)]),e("p",null,[Ke,h(" "+r(a(t).signedUser.dateOfBirth),1)]),e("p",null,[We,h(" "+r(a(t).signedUser.gender),1)]),a(t).signedUser.interests.length>0?(u(),m("p",Xe,[Ye,h(" "+r(a(t).signedUser.interests.join(",")),1)])):S("",!0)])],2),a(t).section==="interaction"?(u(),m("div",{key:0,class:x({show:a(t).section==="interaction",none:a(t).section!=="interaction",interaction:!0})},[Ze,y.value.length>0?(u(),m("div",et,[(u(!0),m(le,null,re(y.value,(i,d)=>(u(),m("div",{key:d,class:"resultContainer"},[e("div",tt,r(i.type),1),e("div",nt,[e("img",{src:i.postDetails.posterDetails.img,alt:i.postDetails.posterDetails.username+"profile picture",class:"result-item-image",onClick:v(p=>F(i.postDetails.posterId),["prevent"])},null,8,st),e("div",ot,[e("div",it,[e("span",{onClick:v(p=>F(i.postDetails.posterId),["prevent"])},r(a(t).signedUser.blogName),9,at),e("span",null,r(Ce(i.postDetails.postTime.seconds)),1)]),e("div",{innerHTML:i.postDetails.postContain,id:"divContent",onClick:v(p=>X(i.postDetails.postId),["prevent"])},null,8,lt),I(ke,{post:i.postDetails},null,8,["post"])])])]))),128))])):S("",!0)],2)):S("",!0)]),e("section",rt,[I(o,{to:"/home"},{default:D(()=>[ct]),_:1}),I(o,{to:"/search"},{default:D(()=>[dt]),_:1})])]),ut]))}}});const bt=be(pt,[["__scopeId","data-v-34b90d44"]]);export{bt as default};
