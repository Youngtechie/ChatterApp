import{d as Z,r as O,c as _,f as g,p as nt,C as it,g as e,w as U,A as rt,u as at,o as dt,a as ct,b as mt,e as lt,j as r,t as V,k as et,l as z,m as ot,h as H,F as ut,z as pt,i as X,B as vt,q as _t,s as ft}from"./index-d9c4c67e.js";import{u as J,a as tt}from"./useAuth.vue_vue_type_script_lang-77171506.js";import{P as K,R as L,b as N,_ as R,d as M,a as $,g as P,c as G,I as wt}from"./index.esm2017-7370a789.js";import{_ as gt}from"./useLoadingPage.vue_vue_type_style_index_0_lang-1cc37a5c.js";import{a as ht}from"./index-72692797.js";import{c as st}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as Ct,a as yt,b as Pt}from"./useCheckFollow.vue_vue_type_script_lang-c4afa756.js";import{u as It}from"./useUserDetails.vue_vue_type_script_lang-4fb6f021.js";import{u as bt}from"./useDetailButtons-0e25b9a8.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";const At={class:"commentAdd"},kt=Z({__name:"useAddComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String},setup(I){const p=I,{app:q}=J(),C=K(q),u=O("");async function A(t,n,a,S){if(t===""||t===void 0)confirm("You must be logged in to comment, will you love to sign up?")&&rt.push("/join");else if(S.trim()==="")alert("You cannot post an empty comment");else{document.getElementById("btnAddcomment").setAttribute("disabled","true");const f=L(R(C,"users"),N("id","==",`${t}`)),v=L(R(C,"posts"),N("postId","==",`${n}`)),d=L(R(C,"users"),N("id","==",`${a}`));try{M(f).then(k=>{const m=k.docs[0].data();M(v).then(E=>{const c=E.docs[0].data();M(d).then(B=>{const h=B.docs[0].data(),o={commentId:c.postComments.count,details:S,time:new Date};function i(s){return m.comments.out.map(y=>{if(y.postId===n)return{...y,commentArr:[...y.commentArr,s]}})}function b(s){return h.comments.in.map(y=>{if(y.postId===n)return{...y,commentArr:[...y.commentArr,s]}})}m.comments.out.some(s=>s.postId===n)?$(P(C,"users",`${t}`),{["comments.out"]:i(o),["comments.total.out"]:m.comments.total.out+1,activityLog:[...m.activityLog,{type:"You added another comment on this post",details:{commentId:c.postComments.count,postId:n,text:o.details,time:o.time}}]}):$(P(C,"users",`${t}`),{["comments.out"]:[...m.comments.out,{postId:n,commentArr:[o]}],["comments.total.out"]:m.comments.total.out+1,activityLog:[...m.activityLog,{type:"You commented on this post",details:{commentId:c.postComments.count,postId:n,text:o.details,time:o.time}}],interactions:[...m.interactions,{type:"Commented on this post",details:{commentId:c.postComments.count,postid:n,text:o.details,time:o.time}}]}),c.postComments&&$(P(C,"posts",`${n}`),{["postComments.details"]:[...c.postComments.details,{commentId:c.postComments.count,id:t,text:o.details,time:o.time,fullName:m.fullName,username:m.username,avatar:m.profilePicture}],["postComments.total"]:c.postComments.total+1,["postComments.count"]:c.postComments.count+1}),h.comments.in.some(s=>s.postId===n)?$(P(C,"users",`${a}`),{["comments.in"]:b(o),["comments.total.in"]:h.comments.total.in+1,notifications:[...h.notifications,{type:`Your got a comment from <b>${m.fullName}</b> on a post`,details:{commentId:c.postComments.count,postid:n,text:o.details,time:o.time}}]}):$(P(C,"users",`${a}`),{["comments.in"]:[...h.comments.in,{postId:n,commentArr:[o]}],["comments.total.in"]:h.comments.total.in+1,notifications:[...h.notifications,{type:`Your got a comment from <b>${m.fullName}</b> on a post`,details:{commentId:c.postComments.count,postid:n,text:o.details,time:o.time}}]}),u.value="",document.getElementById("btnAddcomment").removeAttribute("disabled")})})})}catch{alert("Something went wrong"),document.getElementById("btnAddcomment").removeAttribute("disabled")}}}return(t,n)=>(_(),g("div",At,[nt(e("textarea",{"onUpdate:modelValue":n[0]||(n[0]=a=>u.value=a),minlength:"1",maxlength:"1000"},null,512),[[it,u.value]]),e("button",{onClick:n[1]||(n[1]=U(a=>A(p.currentUserId,p.viewPostId,p.viewPostPosterId,u.value),["prevent"])),id:"btnAddcomment"},"Add Comment")]))}});const xt=Q(kt,[["__scopeId","data-v-c495cef7"]]),Ut=Z({__name:"useDeleteComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String},setup(I){const p=I,{app:q}=J(),C=tt(),u=K(q);async function A(){const n=P(u,"posts",p.viewPostId);await G(n).then(a=>{C.viwedPost=a.data()}).catch(a=>{console.log(a)})}async function t(n,a,S,f,v){if(!(n===""||n===void 0)){const d=L(R(u,"users"),N("id","==",`${n}`)),k=L(R(u,"posts"),N("postId","==",`${a}`)),m=L(R(u,"users"),N("id","==",`${S}`));try{M(d).then(E=>{const c=E.docs[0].data();M(k).then(B=>{const h=B.docs[0].data();M(m).then(o=>{const i=o.docs[0].data();function b(l){return l.comments.out.map(w=>{if(w.postId===a)if(w.commentArr.length>1){const j=w.commentArr.filter(T=>T.commentId!==f);return{...w,commentArr:j}}else return null;return w}).filter(w=>w!==null)}function s(l){return l.comments.in.map(w=>{if(w.postId===a)if(w.commentArr.length>1){const j=w.commentArr.filter(T=>T.commentId!==f);return{...w,commentArr:j}}else return null;return w}).filter(w=>w!==null)}c!=null&&c.length!==0&&h!==void 0&&h!==null&&h.length!==0&&i!==void 0&&i!==null&&i.length!==0&&(c.comments.out.some(l=>l.postId===a)&&$(P(u,"users",`${n}`),{["comments.out"]:b(c),["comments.total.out"]:c.comments.total.out-1,activityLog:[...c.activityLog,{type:"You deleted a comment on this post",details:{commentId:f,postId:a,text:v,time:new Date}}],interactions:c.interactions.filter(l=>l.details.commentId!==f)}),h.postComments&&$(P(u,"posts",`${a}`),{["postComments.details"]:h.postComments.details.filter(l=>l.commentId!==f),["postComments.total"]:h.postComments.total-1}),i.comments.in.some(l=>l.postId===a)&&$(P(u,"users",`${S}`),{["comments.in"]:s(i),["comments.total.in"]:i.comments.total.in-1,notifications:i.notifications.filter(l=>l.details.commentId!==f)}),A())})})})}catch{throw new Error("Error deleting comment")}}}return(n,a)=>(_(),g("button",{class:"delBtn",onClick:a[0]||(a[0]=U(S=>t(p.currentUserId,p.viewPostId,p.viewPostPosterId,I.commentId,I.commentText),["prevent"]))},"Delete"))}});const $t=Q(Ut,[["__scopeId","data-v-8be74edc"]]),St={key:1,id:"editContainer"},Et={id:"centerContainer"},Bt=["onClick"],Tt=Z({__name:"useEditComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String,divEditId:String},setup(I){const p=I,{app:q}=J(),C=tt(),u=K(q),A=O(""),t=O(!1);async function n(){const v=P(u,"posts",p.viewPostId);await G(v).then(d=>{C.viwedPost=d.data()}).catch(d=>{console.log(d)})}async function a(v,d,k,m,E){if(!(v===""||v===void 0))if(m.trim()==="")alert("Comment cannot be empty");else{document.getElementById("btnEditComment").setAttribute("disabled","true");const c=L(R(u,"users"),N("id","==",`${v}`)),B=L(R(u,"posts"),N("postId","==",`${d}`)),h=L(R(u,"users"),N("id","==",`${k}`));try{M(c).then(o=>{const i=o.docs[0].data();M(B).then(b=>{const s=b.docs[0].data();M(h).then(l=>{const y=l.docs[0].data();function D(){return i.comments.out.map(x=>{if(x.postId===d){const W=x.commentArr.map(F=>F.commentId===E?{...F,details:m}:F);return{...x,commentArr:W}}return x})}function w(){return y.comments.in.map(x=>{if(x.postId===d){const W=x.commentArr.map(F=>F.commentId===E?{...F,details:m}:F);return{...x,commentArr:W}}return x})}function j(){return s.postComments.details.map(x=>x.commentId===E?{...x,text:m}:x)}i.comments.out.some(T=>T.postId===d)&&$(P(u,"users",`${v}`),{["comments.out"]:D(),activityLog:[...i.activityLog,{type:"You edited your comment on this post",details:{commentId:s.postComments.count,postId:d,text:m,time:new Date}}]}),s.postComments&&$(P(u,"posts",`${d}`),{["postComments.details"]:j()}),y.comments.in.some(T=>T.postId===d)&&$(P(u,"users",`${k}`),{["comments.in"]:w()}),document.getElementById("btnEditComment").removeAttribute("disabled"),n(),t.value=!1})})})}catch{alert("An error occurred, try again"),document.getElementById("btnEditComment").removeAttribute("disabled")}}}function S(v){const d=document.getElementById(`${v}`);A.value=d.innerText,t.value=!0}function f(){document.getElementById("btnEditComment").setAttribute("disabled","true"),A.value="",t.value=!1}return(v,d)=>t.value?(_(),g("div",St,[e("div",Et,[nt(e("textarea",{"onUpdate:modelValue":d[1]||(d[1]=k=>A.value=k),minlength:"1",maxlength:"1000"},null,512),[[it,A.value]]),e("button",{id:"btnEditComment",onClick:d[2]||(d[2]=U(k=>a(p.currentUserId,p.viewPostId,p.viewPostPosterId,A.value,I.commentId),["prevent"]))},"Update"),e("button",{onClick:U(f,["prevent"])},"Cancel",8,Bt)])])):(_(),g("button",{key:0,onClick:d[0]||(d[0]=U(k=>S(p.divEditId),["prevent"])),class:"editBTn"},"Edit"))}});const Vt=Q(Tt,[["__scopeId","data-v-222a4917"]]),Y=I=>(_t("data-v-52e02837"),I=I(),ft(),I),Lt={key:1,class:"postFullDetails"},Nt=["onClick"],Rt=["title"],Mt={id:"themeImgContainer"},qt=["src"],Ft={key:0,class:"postBody"},Ht={key:0},Ot={key:1,class:"coverImage"},Yt=["src"],Dt={class:"postContainer"},jt={class:"section1"},zt={class:"details"},Gt={key:0,class:"followBtns"},Zt=["onClick"],Jt=vt('<svg width="24px" height="24px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="#000000" data-v-52e02837><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-52e02837></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-52e02837></g><g id="SVGRepo_iconCarrier" data-v-52e02837><path d="M216,16A112.127,112.127,0,0,0,104,128v79.68a80.239,80.239,0,0,0,9.768,38.308l27.455,50.334L68.4,343.656A79.727,79.727,0,0,0,32,410.732V496H312V464H64V410.732a47.838,47.838,0,0,1,21.84-40.246L183.5,307.007l-41.64-76.341A48.149,48.149,0,0,1,136,207.68V128a80,80,0,0,1,160,0v79.68a48.143,48.143,0,0,1-5.861,22.985L248.5,307.007,312,348.283V310.117l-21.223-13.8,27.454-50.334A80.226,80.226,0,0,0,328,207.68V128A112.127,112.127,0,0,0,216,16Z" class="ci-primary" data-v-52e02837></path><polygon points="483.314 355.314 460.686 332.686 412 381.372 363.314 332.686 340.686 355.314 389.372 404 340.686 452.686 363.314 475.314 412 426.628 460.686 475.314 483.314 452.686 434.628 404 483.314 355.314" class="ci-primary" data-v-52e02837></polygon></g></svg>',1),Kt=["onClick"],Qt=Y(()=>e("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",height:"24px",viewBox:"0 0 1000 1000","enable-background":"new 0 0 1000 1000","xml:space":"preserve"},[e("metadata",null," Svg Vector Icons : http://www.onlinewebfonts.com/icon "),e("g",null,[e("path",{d:"M667.5,650c4.7,3.4,10.4,5.5,16.7,5.5c15.7,0,28.4-12.7,28.4-28.4c0-9.9-5-18.5-12.7-23.6l0,0c-33.9-23-71.2-41.3-111-54c91.6-47.6,154.3-143.3,154.3-253.7C743.2,138,615.3,10,457.4,10c-157.9,0-285.8,128-285.8,285.8c0,110.4,62.6,206.1,154.2,253.7c-174,55.5-300.2,217.9-301.3,410c0,0.2,0.1,2.5,0.1,2.5c1,14.8,13.2,26.6,28.2,26.6c15.1,0,27.5-11.8,28.5-26.6c0-207.6,168.3-376,376-376c77.8,0,150.1,23.6,210,64.1L667.5,650z M228.7,295.8c0-126.3,102.4-228.7,228.7-228.7c126.3,0,228.7,102.4,228.7,228.7c0,126.3-102.4,228.7-228.7,228.7C331.1,524.5,228.7,422.1,228.7,295.8z"}),e("path",{d:"M947.9,786.1H827.4V666.6c0-15.2-12.3-27.6-27.6-27.6s-27.6,12.3-27.6,27.6v119.5H652c-15.2,0-27.6,12.3-27.6,27.6c0,15.2,12.3,27.6,27.6,27.6h120.3v121.2c0,15.2,12.3,27.6,27.6,27.6s27.6-12.3,27.6-27.6V841.2h120.5c15.2,0,27.6-12.3,27.6-27.6C975.4,798.4,963.1,786.1,947.9,786.1z"})])],-1)),Wt={class:"timePosted"},Xt=["innerHTML"],te={class:"btnsMore"},ee={class:"commentingSection"},oe={key:0},se={key:1,class:"commentAction"},ne={class:"commenter"},ie=["onClick"],re=["onClick"],ae=["id"],de={key:0,class:"commenterBtn"},ce={key:2},me={key:1},le=Y(()=>e("h1",null,"Post not found or Deleted",-1)),ue=Y(()=>e("button",null,"Expore Chatter",-1)),pe=Y(()=>e("button",null,"Home",-1)),ve={id:"navigators"},_e=Y(()=>e("button",null,"Home",-1)),fe=Y(()=>e("button",null,"Search",-1)),we=Z({__name:"PostPage",props:["postId"],setup(I){const p=I;It();const q=O(!0),C=O(""),{app:u}=J(),A=K(u),t=tt(),n=at(),a=P(A,"posts",p.postId),S=new DOMParser,f=O([]),v=O(!1);async function d(){try{const o=await G(a);o.data()!==void 0&&(t.viwedPost=o.data(),k(),m(),$(a,{postViews:t.viwedPost.postViews+1}).finally(()=>{q.value=!1}))}catch(o){console.error(o)}}dt(()=>{const o=P(A,"posts",p.postId);try{wt(o,i=>{t.viwedPost.postComments=i.data().postComments})}catch{}d()});async function k(){const o=t.viwedPost.postContain;await ht.post("/.netlify/functions/postContent",{contentUrl:o}).then(i=>{var s;const b=S.parseFromString(i.data.content,"text/html");(s=b.body.querySelector("h1"))==null||s.remove(),C.value=b.body.innerHTML}).catch(i=>{console.log(i)})}async function m(){f.value=[];const o=P(A,"users",t.viwedPost.posterId),i=await G(o);if(i.data()!==void 0){const{blogName:b,profilePicture:s,id:l,username:y}=i.data(),D={blogName:b,profilePicture:s,id:l,username:y};f.value.push(D),await Ct(t.viwedPost.posterId,t.signedUser.id).then(w=>{v.value=w})}}async function E(){yt(t.viwedPost.posterId,f.value[0].blogName),t.signedUser.username!==void 0&&t.signedUser.username!==""&&(v.value=!v.value)}async function c(){Pt(t.viwedPost.posterId),t.signedUser.username!==void 0&&t.signedUser.username!==""&&(v.value=!v.value)}ct(()=>{const o=document.getElementById("warningShow");o&&(o.style.display="none")});function B(o){if(o===t.signedUser.id)return n.push("/userProfile");n.push(`/chatterUser/${o}`)}function h(){n.go(-1)}return(o,i)=>{const b=mt("RouterLink");return q.value&&C.value===""?(_(),lt(gt,{key:0,"action-name":"Loading Post..."})):(_(),g("main",Lt,[e("header",null,[e("button",{onClick:U(h,["prevent"])},"Back",8,Nt),e("button",{title:r(t).themeDetails.title,id:"themeBtn",onClick:i[0]||(i[0]=(...s)=>r(t).changeTheme&&r(t).changeTheme(...s))},[e("div",Mt,[e("img",{src:r(t).themeDetails.img},null,8,qt)])],8,Rt)]),r(t).viwedPost.posterId!==void 0?(_(),g("div",Ft,[r(t).viwedPost.postCoverImage===""||r(t).viwedPost.postCoverImage===void 0?(_(),g("h1",Ht,V(r(t).viwedPost.postTitle.join(" ")),1)):(_(),g("section",Ot,[e("img",{id:"img",src:r(t).viwedPost.postCoverImage},null,8,Yt),e("h1",null,V(r(t).viwedPost.postTitle.join(" ")),1)])),e("div",Dt,[e("div",jt,[e("div",zt,[f.value[0].profilePicture?(_(),g("div",{key:0,class:"imgCon",onClick:i[1]||(i[1]=U(s=>B(r(t).viwedPost.posterId),["prevent"])),style:et({backgroundImage:`url(${f.value[0].profilePicture})`})},null,4)):z("",!0),e("div",null,[e("h3",{onClick:i[2]||(i[2]=U(s=>B(r(t).viwedPost.posterId),["prevent"]))},V(f.value[0].blogName),1),e("h5",null,"@"+V(f.value[0].username),1)])]),r(t).signedUser.id!==r(t).viwedPost.posterId?(_(),g("div",Gt,[v.value?(_(),g("button",{key:0,onClick:U(E,["prevent"])},[Jt,ot(" Unfollow")],8,Zt)):(_(),g("button",{key:1,onClick:U(c,["prevent"])},[Qt,ot("Follow")],8,Kt))])):z("",!0)]),e("div",Wt,V(st(r(t).viwedPost.postTime.seconds)),1),e("div",{innerHTML:C.value,class:"showPost"},null,8,Xt)]),e("div",te,[H(bt,{post:r(t).viwedPost},null,8,["post"])]),e("div",ee,[r(t).viwedPost.postComments.total===0&&r(t).viwedPost.postSettings.disableComments===!1?(_(),g("h4",oe," No comments yet. ")):z("",!0),r(t).viwedPost.postSettings.disableComments===!1?(_(),g("div",se,[(_(!0),g(ut,null,pt(r(t).viwedPost.postComments.details,(s,l)=>(_(),g("div",{key:l,class:"Eachcomment"},[e("div",ne,[e("div",{class:"imgCon2",onClick:U(y=>B(s.id),["prevent"]),style:et({backgroundImage:`url(${s.avatar})`})},null,12,ie),e("div",null,[e("h4",{onClick:U(y=>B(s.id),["prevent"])},V(s.fullName),9,re),e("h5",null,"@"+V(s.username),1)]),e("p",null,V(st(s.time.seconds)),1)]),e("div",{id:l.toString()+"commentDiv",class:"commentShow"},V(s.text),9,ae),r(t).signedUser.id===r(t).viwedPost.posterId?(_(),g("div",de,[H(Vt,{currentUserId:r(t).signedUser.id,viewPostId:p.postId,viewPostPosterId:r(t).viwedPost.posterId,commentId:s.commentId,commentText:s.text,divEditId:l.toString()+"commentDiv"},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText","divEditId"]),H($t,{currentUserId:r(t).signedUser.id,viewPostId:p.postId,viewPostPosterId:r(t).viwedPost.posterId,commentId:s.commentId,commentText:s.text},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText"])])):z("",!0)]))),128)),H(xt,{currentUserId:r(t).signedUser.id,viewPostId:p.postId,viewPostPosterId:r(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])])):(_(),g("h4",ce,"Commenting on this post is disabled."))])])):(_(),g("div",me,[le,e("div",null,[ue,H(b,{to:"/"},{default:X(()=>[pe]),_:1})])])),e("section",ve,[H(b,{to:"/home"},{default:X(()=>[_e]),_:1}),H(b,{to:"/search"},{default:X(()=>[fe]),_:1})])]))}}});const Ue=Q(we,[["__scopeId","data-v-52e02837"]]);export{Ue as default};
