import{d as J,r as u,u as K,o as W,y as R,D as X,a as Y,x as Z,c as d,f as m,g as r,F as U,z as $,l as q,w as k,n as F,t as I,k as ee,h as te,q as ne,s as oe,_ as se}from"./index-36d15da9.js";import{u as ae,a as ie}from"./useAuth.vue_vue_type_script_lang-0f4a9525.js";import{P as re,R as S,_ as T,x as B,k as x,b as E,d as A,g as le,c as ce,F as ue}from"./index.esm2017-8a8714eb.js";import{u as de}from"./useUserDetails.vue_vue_type_script_lang-3df38338.js";import{a as me}from"./axios-4a70c6fc.js";import{c as ge}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as pe}from"./useDetailButtons-29f69ecb.js";import{S as ve}from"./useSignOut.vue_vue_type_script_lang-72a5ef5c.js";const he=y=>(ne("data-v-5e12ed75"),y=y(),oe(),y),fe={class:"trendingsSection"},ye={class:"trendingsBtn"},_e=["onClick"],we={key:0,class:F({resultsContainer:!0})},Ce=["onClick"],ke={class:"result-item-other"},Se={class:"result-item-header"},Te=["onClick"],xe=["innerHTML","onClick"],be=["onClick"],Pe=he(()=>r("div",{id:"warningShow"},null,-1)),Ie=J({__name:"TrendingsPage",setup(y){de();const g=u([]),h=u(""),M=new DOMParser,_=K(),{app:H}=ae(),f=re(H),p=ie();p.sidebar=!1;const l=u(null),w=u(),C=u([]),v=u(""),D=u(!0);W(()=>{R(()=>{const e=document.getElementById("warningShow");e&&(e.style.display="flex",e.textContent="Loading ...");try{V().then(()=>{C.value.length>0&&(v.value=C.value[0],l.value=S(T(f,"posts"),B("postTime","desc"),x(10),E("postTag","==",v.value)),b(l.value).then(()=>{e&&(e.style.display="none")}).catch(()=>{e&&(e.style.display="flex",e.textContent="An error occurred, check you network connection and try reloading page.")}))}).catch(()=>{e&&(e.style.display="flex",e.textContent="An error occurred, check you network connection and try reloading page.")})}catch{e&&(e.style.display="flex",e.textContent="An error occurred, check you network connection and try reloading page.")}})}),X(v,(e,n)=>{e!==n&&(l.value=S(T(f,"posts"),B("postTime","desc"),x(10),E("postTag","==",v.value)),b(l.value))});async function z(e){h.value="";const n=e.postContain;await me.post("/postContent",{contentUrl:n}).then(a=>{const i=M.parseFromString(a.data,"text/html");h.value=i.body.innerHTML})}async function Q(e){w.value=null;const n=le(f,"users",e),a=await ce(n);if(a.data()!==void 0){const{fullName:i,profilePicture:t,username:o,blogName:s}=a.data(),c={profilePicture:t,posterID:e,fullName:i,username:o,blogName:s};w.value={id:e,img:c.profilePicture,fullName:c.fullName,username:c.username,blogname:c.blogName}}}async function b(e){const a=(await A(e)).docs.map(async t=>{var c;const o=t.data();await z(o);const s=M.parseFromString(h.value,"text/html");return s.body.querySelectorAll("img").forEach(P=>{P.remove()}),s.body.querySelectorAll("video").forEach(P=>{P.remove()}),(c=s.body.querySelector("h1"))==null||c.remove(),h.value=s.body.innerHTML,o.postContain=h.value,await Q(o.posterId),o.posterDetails=w.value,o}),i=await Promise.all(a);g.value=i,w.value=null,D.value=!1}async function V(){const e=S(T(f,"tags"),x(5),E("counts",">",0));(await A(e)).docs.forEach(n=>{C.value.push(n.id)})}function O(){const e=l.value.docs[l.value.docs.length-1],n=S(T(f,"cities"),B("postTime","desc"),ue(e),x(15));b(n).then(()=>{l.value=n})}function j(e){_.push(`/post/${e}`)}function L(e){if(e===p.signedUser.id)return _.push("/userProfile");_.push(`/chatterUser/${e}`)}function G(e){g.value=[],v.value=e}let N;if(p.authenticated===!0&&p.signedUser.id!==void 0&&p.signedUser.username===""){const e=document.getElementById("warningShow");e.style.display="flex",e.textContent="Registration not complete... Logging you out",ve(),N=setTimeout(()=>{e.style.display="none",p.authenticated=!1,_.push("/login")},2e3)}return Y(()=>{clearTimeout(N);const e=document.getElementById("warningShow");e&&(e.style.display="none")}),Z(()=>{var e;((e=g.value)==null?void 0:e.length)>0&&R(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="none")})}),(e,n)=>{var a,i;return d(),m("main",fe,[r("div",ye,[(d(!0),m(U,null,$(C.value,(t,o)=>(d(),m("button",{key:o,onClick:s=>G(t),class:F({activeTrend:v.value===t})},I(t),11,_e))),128))]),((a=g.value)==null?void 0:a.length)>0&&D.value===!1?(d(),m("div",we,[(d(!0),m(U,null,$(g.value,(t,o)=>(d(),m("div",{key:o,class:"result-item"},[r("div",{class:"imgCon",onClick:k(s=>L(t.posterId),["prevent"]),style:ee({backgroundImage:`url(${t==null?void 0:t.posterDetails.img})`})},null,12,Ce),r("div",ke,[r("div",Se,[r("span",{onClick:k(s=>L(t.posterId),["prevent"])},I(t==null?void 0:t.posterDetails.blogname),9,Te),r("span",null,I(ge(t.postTime.seconds)),1)]),r("div",{innerHTML:t.postContain,id:"divContent",onClick:k(s=>j(t.postId),["prevent"])},null,8,xe),te(pe,{post:t},null,8,["post"])])]))),128))])):q("",!0),((i=g.value)==null?void 0:i.length)===10?(d(),m("button",{key:1,onClick:k(O,["prevent"])},"See More ....",8,be)):q("",!0),Pe])}}});const $e=se(Ie,[["__scopeId","data-v-5e12ed75"]]);export{$e as default};
