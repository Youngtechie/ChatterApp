import{d as U,r as m,u as $,o as H,s as P,q as A,a as V,c as p,f as g,F as Q,x as z,k as T,w as h,y as O,g as i,t as E,i as j,_ as G}from"./index-0d83a52f.js";import{u as J,a as K}from"./useAuth.vue_vue_type_script_lang-6fe6b92b.js";import{g as W,r as X,a as Y}from"./index.esm2017-f1785873.js";import{P as Z,R as D,k as M,x as B,_ as L,d as ee,g as te,c as oe,F as ne}from"./index.esm2017-3589eea2.js";import{u as se}from"./useUserDetails.vue_vue_type_script_lang-8130a85e.js";import{a as ae}from"./axios-4a70c6fc.js";import{c as re}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as le}from"./useDetailButtons-f28c8ea1.js";import"./useLikeButton-25f53cfb.js";const ie={class:"exploreSection"},ce={key:0,class:O({resultsContainer:!0})},ue=["src","alt","onClick"],de={class:"result-item-other"},me={class:"result-item-header"},pe=["onClick"],ge=["innerHTML","onClick"],fe=["onClick"],he=U({__name:"ExplorePage",setup(ve){se();const c=m([]),u=m(""),w=new DOMParser,v=$(),{app:C}=J(),N=W(C),_=Z(C),x=K();x.sidebar=!1;const d=m(null),f=m(),S=m(!0);H(()=>{P(()=>{const e=document.getElementById("warningShow");e&&(e.style.display="flex",e.textContent="Loading ...")}),d.value=D(L(_,"posts"),B("postTime","desc"),M(15)),k(d.value)});async function R(e){u.value="";try{const o=X(N,e.postContain),n=await Y(o).catch(s=>{console.log(s)});await ae.post("/postContent",{contentUrl:n}).then(s=>{const t=w.parseFromString(s.data,"text/html");u.value=t.body.innerHTML}).catch(s=>{console.log(s)})}catch{const n=document.getElementById("ErrorShow");n.style.display="flex",n.textContent="Something went wrong, check your internet connection and reload page"}}async function I(e){f.value=null;try{const o=te(_,"users",e),n=await oe(o);if(n.data()!==void 0){const{fullName:s,profilePicture:t,username:a,blogName:r}=n.data(),l={profilePicture:t,posterID:e,fullName:s,username:a,blogName:r};f.value={id:e,img:l.profilePicture,fullName:l.fullName,username:l.username,blogname:l.blogName}}}catch{}}async function k(e){const n=(await ee(e)).docs.map(async t=>{var l;const a=t.data();await R(a);const r=w.parseFromString(u.value,"text/html");return r.body.querySelectorAll("img").forEach(y=>{y.remove()}),r.body.querySelectorAll("video").forEach(y=>{y.remove()}),(l=r.body.querySelector("h1"))==null||l.remove(),u.value=r.body.innerHTML,a.postContain=u.value,await I(a.posterId),a.posterDetails=f.value,a}),s=await Promise.all(n);c.value=s,f.value=null,S.value=!1}function q(){const e=d.value.docs[d.value.docs.length-1],o=D(L(_,"cities"),B("postTime","desc"),ne(e),M(15));k(o).then(()=>{d.value=o})}function F(e){v.push(`/post/${e}`)}function b(e){if(e===x.signedUser.id)return v.push("/userProfile");v.push(`/chatterUser/${e}`)}return A(()=>{var e;((e=c.value)==null?void 0:e.length)>0&&P(()=>{const o=document.getElementById("warningShow");o&&(o.style.display="none")})}),V(()=>{const e=document.getElementById("warningShow");e.style.display="none"}),(e,o)=>{var n,s;return p(),g("main",ie,[((n=c.value)==null?void 0:n.length)>0&&S.value===!1?(p(),g("div",ce,[(p(!0),g(Q,null,z(c.value,(t,a)=>(p(),g("div",{key:a,class:"result-item"},[i("img",{src:t==null?void 0:t.posterDetails.img,alt:(t==null?void 0:t.posterDetails.username)+"profile picture",class:"result-item-image",onClick:h(r=>b(t.posterId),["prevent"])},null,8,ue),i("div",de,[i("div",me,[i("span",{onClick:h(r=>b(t.posterId),["prevent"])},E(t==null?void 0:t.posterDetails.blogname),9,pe),i("span",null,E(re(t.postTime.seconds)),1)]),i("div",{innerHTML:t.postContain,id:"divContent",onClick:h(r=>F(t.postId),["prevent"])},null,8,ge),j(le,{post:t},null,8,["post"])])]))),128))])):T("",!0),((s=c.value)==null?void 0:s.length)===15?(p(),g("button",{key:1,onClick:h(q,["prevent"])},"See More ....",8,fe)):T("",!0)])}}});const Te=G(he,[["__scopeId","data-v-9b5f58eb"]]);export{Te as default};
