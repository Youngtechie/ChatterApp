import{d as ee,u as te,r as b,o as ne,y as B,a as se,b as oe,c as u,e as ie,f as m,g as e,w as S,j as a,k as ae,t as l,l as C,h as I,i as E,n as U,m as h,F as le,z as re,q as ce,s as de,_ as ue}from"./index-36d15da9.js";import{a as pe,u as me}from"./useAuth.vue_vue_type_script_lang-0f4a9525.js";import{_ as he}from"./useLoadingPage.vue_vue_type_style_index_0_lang-de7c068c.js";import{g as ge,r as ye,l as _e,d as fe}from"./index.esm2017-6b538d32.js";import{P as we,R as M,_ as H,b as O,k as ve,d as V,g as D,c as Se,y as j}from"./index.esm2017-8a8714eb.js";import{u as Ce}from"./useUserDetails.vue_vue_type_script_lang-3df38338.js";import{S as z}from"./useSignOut.vue_vue_type_script_lang-72a5ef5c.js";import{c as ke}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as be}from"./useDetailButtons-29f69ecb.js";import{a as Ie}from"./axios-4a70c6fc.js";const r=k=>(ce("data-v-b5a0f1d7"),k=k(),de(),k),Ue={key:1},xe=["onClick"],Pe=["title"],Be={id:"themeImgContainer"},Ee=["src"],De={class:"body"},Te={class:"imageCon"},Ne={class:"sectionFoImage"},Ae={key:0},Le={class:"follow"},Re=r(()=>e("p",null,"||",-1)),Fe={class:"btns"},$e=r(()=>e("button",null,"Edit Profile",-1)),qe=["onClick"],Me={class:"readerSec"},He={class:"btnSection"},Oe={class:"personalDetails"},Ve=r(()=>e("span",null,"Full Name:",-1)),je=r(()=>e("span",null,"User Name:",-1)),ze=r(()=>e("span",null,"Blog Name:",-1)),Ge={key:0},Qe=r(()=>e("span",null,"Email:",-1)),Je=r(()=>e("span",null,"Location:",-1)),Ke=r(()=>e("span",null,"Birthday:",-1)),We=r(()=>e("span",null,"Gender:",-1)),Xe={key:1},Ye=r(()=>e("span",null,"Interests:",-1)),Ze=r(()=>e("div",{id:"warningShowint"},null,-1)),et={key:0},tt={class:"type"},nt={class:"result-item"},st=["src","alt","onClick"],ot={class:"result-item-other"},it={class:"result-item-header"},at=["onClick"],lt=["innerHTML","onClick"],rt={id:"navigators"},ct=r(()=>e("button",null,"Home",-1)),dt=r(()=>e("button",null,"Search",-1)),ut=r(()=>e("div",{id:"warningShow"},null,-1)),pt=ee({__name:"UserProfile",setup(k){const g=te(),T=b(!0),t=pe();ne(()=>{Ce(),B(()=>{const n=document.getElementById("warningShow");n.style.display="none"}),t.section="personal"});const x=b(),{app:N}=me(),w=we(N),G=ge(N),A=new DOMParser,v=b(""),y=b([]);async function Q(n){v.value="";const s=n.postContain;await Ie.post("/postContent",{contentUrl:s}).then(o=>{const i=A.parseFromString(o.data,"text/html");v.value=i.body.innerHTML}).catch(o=>{console.log(o)})}async function J(n){x.value=null;const s=D(w,"users",n),o=await Se(s);if(o.data()!==void 0){const{fullName:i,profilePicture:d,username:p,blogName:_}=o.data(),c={profilePicture:d,posterID:n,fullName:i,username:p,blogName:_};x.value={id:n,img:c.profilePicture,fullName:c.fullName,username:c.username,blogname:c.blogName}}}async function K(n){if(n.length>0)try{const s=n.map(async i=>{const d=M(H(w,"posts"),O("postId","==",i.details.postid),ve(10)),p=await V(d);return Promise.all(p.docs.map(async _=>{var q;const c=_.data();await Q(c);const f=A.parseFromString(v.value,"text/html");return f.body.querySelectorAll("img").forEach(P=>{P.remove()}),f.body.querySelectorAll("video").forEach(P=>{P.remove()}),(q=f.body.querySelector("h1"))==null||q.remove(),v.value=f.body.innerHTML,c.postContain=v.value,await J(c.posterId).then(()=>{c.posterDetails=x.value}),{type:i.type,postDetails:c}}))}),o=await Promise.all(s);if(y.value=o.flat(),y.value.length===0){const i=document.getElementById("warningShowint");i.style.display="flex",i.textContent="No interactions yet"}else if(y.value.length>0){const i=document.getElementById("warningShowint");i.style.display="none"}}catch(s){console.log(s);const o=document.getElementById("warningShowint");o.style.display="flex",o.textContent="An error occured, Check your network connection and try again"}else{const s=document.getElementById("warningShowint");s.style.display="flex",s.textContent="No interactions yet"}}function W(){g.go(-1)}function L(n){t.section=n,y.value=[],n==="interaction"&&B(()=>{const s=document.getElementById("warningShowint");s.style.display="flex",s.textContent="Loading ...",K(t.signedUser.interactions)})}function X(n){g.push(`/post/${n}`)}function R(n){if(n===t.signedUser.id)return g.push("/userProfile");g.push(`/chatterUser/${n}`)}async function Y(n){const s=D(w,"users",n);await j(s);const o=M(H(w,"posts"),O("posterId","==",n));(await V(o)).forEach(p=>{const _=p.data(),c=D(w,"posts",_.postId),f=`ChatterAppFiles/posts/${_.postId}`;F(f),j(c)});const d=`ChatterAppFiles/avatar/${n}`;F(d)}async function F(n){const s=ye(G,n),o=await _e(s);if(o.items.length===0)return;const i=o.items.map(d=>fe(d));await Promise.all(i)}async function Z(){if(confirm("Are you sure you want to delete your account?")!==!1)try{const s=document.getElementById("warningShow");s.style.display="flex",s.textContent="Deleting account ...",await Y(t.signedUser.id).then(()=>{s.textContent="Account deleted successfully",z(),setTimeout(()=>{s.style.display="none",g.push("/home")},2e3)}).catch(()=>{const o=document.getElementById("warningShow");o.style.display="flex",o.textContent="An error occured, Check your network connection and try again",setTimeout(()=>{o.style.display="none"},2e3)})}catch{const o=document.getElementById("warningShow");o.style.display="flex",o.textContent="An error occurred, Check your network connection and try again",setTimeout(()=>{o.style.display="none"},2e3)}}let $=setTimeout(()=>{if(t.signedUser.id===void 0&&t.authenticated===!1)g.push("/home");else if(t.authenticated===!0)if(t.signedUser.id!==void 0&&t.signedUser.username===""){const n=document.getElementById("warningShow");n.style.display="flex",n.textContent="Registration not complete... Logging you out",z(),$=setTimeout(()=>{n.style.display="none",t.authenticated=!1,g.push("/login")},2e3)}else t.signedUser.username===void 0&&t.signedUser.id===void 0?B(()=>{const n=document.getElementById("warningShow");n&&(n.style.display="flex",n.textContent="Check your network connection and try again")}):T.value=!1},5e3);return se(()=>{clearTimeout($);const n=document.getElementById("warningShow");n&&(n.style.display="none");const s=document.getElementById("warningShowint");s&&(s.style.display="none")}),(n,s)=>{const o=oe("RouterLink");return T.value?(u(),ie(he,{key:0,"action-name":"Loading profile..."})):(u(),m("main",Ue,[e("header",null,[e("button",{onClick:S(W,["prevent"])},"Back",8,xe),e("button",{title:a(t).themeDetails.title,id:"themeBtn",onClick:s[0]||(s[0]=(...i)=>a(t).changeTheme&&a(t).changeTheme(...i))},[e("div",Be,[e("img",{src:a(t).themeDetails.img},null,8,Ee)])],8,Pe)]),e("div",De,[e("div",Te,[e("div",{class:"imgCon",style:ae({backgroundImage:`url(${a(t).signedUser.profilePicture})`})},null,4)]),e("section",Ne,[e("h3",null,l(a(t).signedUser.fullName),1),a(t).signedUser.bio.length>0?(u(),m("p",Ae,l(a(t).signedUser.bio),1)):C("",!0),e("div",Le,[e("p",null,l(a(t).signedUser.followers.total)+" Followers",1),Re,e("p",null,l(a(t).signedUser.following.total)+" Following",1)])]),e("div",Fe,[I(o,{to:{name:"EditProfile"}},{default:E(()=>[$e]),_:1}),e("button",{onClick:S(Z,["prevent"])},"Delete Account",8,qe)]),e("div",Me,[e("div",He,[e("button",{onClick:s[1]||(s[1]=i=>L("personal")),class:U({active:a(t).section==="personal"})},"Personal",2),e("button",{onClick:s[2]||(s[2]=i=>L("interaction")),class:U({active:a(t).section==="interaction"})},"Interactions",2)]),e("div",{class:U({show:a(t).section==="personal",none:a(t).section!=="personal",personal:!0})},[e("div",Oe,[e("p",null,[Ve,h(" "+l(a(t).signedUser.fullName),1)]),e("p",null,[je,h(" "+l(a(t).signedUser.username),1)]),e("p",null,[ze,h(" "+l(a(t).signedUser.blogName),1)]),a(t).signedUser.settings.privacySettings.showEmail?(u(),m("p",Ge,[Qe,h(" "+l(a(t).signedUser.email),1)])):C("",!0),e("p",null,[Je,h(" "+l(a(t).signedUser.location),1)]),e("p",null,[Ke,h(" "+l(a(t).signedUser.dateOfBirth),1)]),e("p",null,[We,h(" "+l(a(t).signedUser.gender),1)]),a(t).signedUser.interests.length>0?(u(),m("p",Xe,[Ye,h(" "+l(a(t).signedUser.interests.join(",")),1)])):C("",!0)])],2),a(t).section==="interaction"?(u(),m("div",{key:0,class:U({show:a(t).section==="interaction",none:a(t).section!=="interaction",interaction:!0})},[Ze,y.value.length>0?(u(),m("div",et,[(u(!0),m(le,null,re(y.value,(i,d)=>(u(),m("div",{key:d,class:"resultContainer"},[e("div",tt,l(i.type),1),e("div",nt,[e("img",{src:i.postDetails.posterDetails.img,alt:i.postDetails.posterDetails.username+"profile picture",class:"result-item-image",onClick:S(p=>R(i.postDetails.posterId),["prevent"])},null,8,st),e("div",ot,[e("div",it,[e("span",{onClick:S(p=>R(i.postDetails.posterId),["prevent"])},l(a(t).signedUser.blogName),9,at),e("span",null,l(ke(i.postDetails.postTime.seconds)),1)]),e("div",{innerHTML:i.postDetails.postContain,id:"divContent",onClick:S(p=>X(i.postDetails.postId),["prevent"])},null,8,lt),I(be,{post:i.postDetails},null,8,["post"])])])]))),128))])):C("",!0)],2)):C("",!0)]),e("section",rt,[I(o,{to:"/home"},{default:E(()=>[ct]),_:1}),I(o,{to:"/search"},{default:E(()=>[dt]),_:1})])]),ut]))}}});const bt=ue(pt,[["__scopeId","data-v-b5a0f1d7"]]);export{bt as default};
