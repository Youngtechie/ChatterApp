import{E as K,d as Q,r as O,c as x,f as S,g as m,m as it,B as rt,w as V,l as tt,t as D,h as _,_ as at,u as dt,o as ct,a as lt,b as mt,e as ut,n as pt,k as wt,i as G,F as vt,y as ft,j as gt,p as yt,q as Pt}from"./index-18dd88e0.js";import{u as H,a as j}from"./useAuth.vue_vue_type_script_lang-555f5ace.js";import{g as Ct,r as et,a as ot}from"./index.esm2017-df89f729.js";import{P as z,_ as B,R as E,b as F,d as L,g as C,a as k,c as J}from"./index.esm2017-50856384.js";import{_ as ht}from"./useLoadingPage.vue_vue_type_style_index_0_lang-bd0c1464.js";import{a as Ut}from"./axios-4a70c6fc.js";import{c as st}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as W}from"./useUserDetails.vue_vue_type_script_lang-86cea6c9.js";import{u as It}from"./useLikeButton-379588bc.js";W();function _t(c){const{app:r}=H(),b=z(r),v=j(),o=B(b,"users");async function y(){v.signedUser.id===void 0||v.signedUser.id===""?(console.log("not signed in"),K.push("/login")):I()}async function I(){try{const t=E(o,F("id","==",`${v.signedUser.id}`)),e=(await L(t)).docs[0].data(),u=E(o,F("id","==",`${c}`)),n=(await L(u)).docs[0].data(),A=[...e.following.theFollowings,c],$=A.length,T=[...n.followers.theFollowers,v.signedUser.id],p=T.length,R=C(b,"users",c),g=C(b,"users",v.signedUser.id);await k(R,{["followers.theFollowers"]:T,["followers.total"]:p,notifications:[...n.notifications,{type:`${v.signedUser.fullName} started following you`,details:{followerId:v.signedUser.id,time:new Date}}]}),await k(g,{["following.theFollowings"]:A,["following.total"]:$,activityLog:[...e.activityLog,{type:"New following",details:{followingId:c,time:new Date}}]})}catch(t){console.error(t)}}y()}function bt(c,r){W();const{app:b}=H(),v=z(b),o=j(),y=B(v,"users");I();async function I(){try{const t=E(y,F("id","==",`${o.signedUser.id}`)),e=(await L(t)).docs[0].data(),u=E(y,F("id","==",`${c}`)),n=(await L(u)).docs[0].data(),A=e.following.theFollowings.filter(a=>a!==c),$=A.length,T=n.followers.theFollowers.filter(a=>a!==o.signedUser.id),p=T.length,R=C(v,"users",c),g=C(v,"users",o.signedUser.id);await k(R,{["followers.theFollowers"]:T,["followers.total"]:p}),await k(g,{["following.theFollowings"]:A,["following.total"]:$,activityLog:[...e.activityLog,{type:`You unfollowed ${r}`,details:{followingId:c,time:new Date}}]})}catch(t){console.error(t)}}}const nt=j();W();async function At(c,r){const{app:b}=H(),v=z(b),o=B(v,"users");if(nt.signedUser.id===void 0||nt.signedUser.id==="")return console.log("not signed in"),!1;return await y();async function y(){try{const I=E(o,F("id","==",`${r}`)),t=E(o,F("id","==",`${c}`)),s=await L(I),e=await L(t),u=s.docs[0].data();return e.docs[0].data().followers.theFollowers.includes(r)&&u.following.theFollowings.includes(c)}catch{return console.log(r,c),!1}}}const $t=Q({__name:"useAddComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String},setup(c){const r=c,{app:b}=H(),v=j(),o=z(b),y=O("");async function I(){const s=C(o,"posts",r.viewPostId);await J(s).then(e=>{v.viwedPost=e.data()}).catch(e=>{console.log(e)})}async function t(s,e,u,h){if(s===""||s===void 0)return K.push("/login");if(h.trim()==="")console.log("comment cannot be empty");else{document.getElementById("btnAddcomment").setAttribute("disabled","true");const n=E(B(o,"users"),F("id","==",`${s}`)),U=E(B(o,"posts"),F("postId","==",`${e}`)),A=E(B(o,"users"),F("id","==",`${u}`));try{L(n).then($=>{const f=$.docs[0].data();L(U).then(T=>{const p=T.docs[0].data();L(A).then(R=>{const g=R.docs[0].data(),a={commentId:p.postComments.count,details:h,time:new Date};function l(w){return f.comments.out.map(i=>{if(i.postId===e)return{...i,commentArr:[...i.commentArr,w]}})}function d(w){return g.comments.in.map(i=>{if(i.postId===e)return{...i,commentArr:[...i.commentArr,w]}})}f.comments.out.some(w=>w.postId===e)?k(C(o,"users",`${s}`),{["comments.out"]:l(a),["comments.total.out"]:f.comments.total.out+1,activityLog:[...f.activityLog,{type:"You added another comment on this post",details:{commentId:p.postComments.count,postId:e,text:a.details,time:a.time}}],interactions:[...f.interactions,{type:"Commented on this post",details:{commentId:p.postComments.count,postid:e,text:a.details,time:a.time}}]}):k(C(o,"users",`${s}`),{["comments.out"]:[...f.comments.out,{postId:e,commentArr:[a]}],["comments.total.out"]:f.comments.total.out+1,activityLog:[...f.activityLog,{type:"You commented on this post",details:{commentId:p.postComments.count,postId:e,text:a.details,time:a.time}}],interactions:[...f.interactions,{type:"Commented on this post",details:{commentId:p.postComments.count,postid:e,text:a.details,time:a.time}}]}),p.postComments&&k(C(o,"posts",`${e}`),{["postComments.details"]:[...p.postComments.details,{commentId:p.postComments.count,id:s,text:a.details,time:a.time}],["postComments.total"]:p.postComments.total+1,["postComments.count"]:p.postComments.count+1}),g.comments.in.some(w=>w.postId===e)?k(C(o,"users",`${u}`),{["comments.in"]:d(a),["comments.total.in"]:g.comments.total.in+1,notifications:[...g.notifications,{type:`Your got a comment from <b>${f.fullName}</b> on a post`,details:{commentId:p.postComments.count,postid:e,text:a.details,time:a.time}}]}):k(C(o,"users",`${u}`),{["comments.in"]:[...g.comments.in,{postId:e,commentArr:[a]}],["comments.total.in"]:g.comments.total.in+1,notifications:[...g.notifications,{type:`Your got a comment from <b>${f.fullName}</b> on a post`,details:{commentId:p.postComments.count,postid:e,text:a.details,time:a.time}}]}),y.value="",document.getElementById("btnAddcomment").removeAttribute("disabled"),I()})})})}catch($){console.log($),document.getElementById("btnAddcomment").removeAttribute("disabled")}}}return(s,e)=>(x(),S("div",null,[m("div",null,[it(m("textarea",{"onUpdate:modelValue":e[0]||(e[0]=u=>y.value=u)},null,512),[[rt,y.value]]),m("button",{onClick:e[1]||(e[1]=V(u=>t(r.currentUserId,r.viewPostId,r.viewPostPosterId,y.value),["prevent"])),id:"btnAddcomment"},[tt("Add the "),m("span",null,D(_(v).viwedPost.postComments.total+1),1),tt(" Comment")])])]))}}),kt=Q({__name:"useDeleteComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String},setup(c){const r=c,{app:b}=H(),v=j(),o=z(b);async function y(){const t=C(o,"posts",r.viewPostId);await J(t).then(s=>{v.viwedPost=s.data()}).catch(s=>{console.log(s)})}async function I(t,s,e,u,h){if(t===""||t===void 0)return K.push("/login");{const n=E(B(o,"users"),F("id","==",`${t}`)),U=E(B(o,"posts"),F("postId","==",`${s}`)),A=E(B(o,"users"),F("id","==",`${e}`));try{L(n).then($=>{const f=$.docs[0].data();L(U).then(T=>{const p=T.docs[0].data();L(A).then(R=>{const g=R.docs[0].data();function a(d){return d.comments.out.map(i=>{if(i.postId===s)if(i.commentArr.length>1){const M=i.commentArr.filter(N=>N.commentId!==u);return{...i,commentArr:M}}else return null;return i}).filter(i=>i!==null)}function l(d){return d.comments.in.map(i=>{if(i.postId===s)if(i.commentArr.length>1){const M=i.commentArr.filter(N=>N.commentId!==u);return{...i,commentArr:M}}else return null;return i}).filter(i=>i!==null)}f.comments.out.some(d=>d.postId===s)&&k(C(o,"users",`${t}`),{["comments.out"]:a(f),["comments.total.out"]:f.comments.total.out-1,activityLog:[...f.activityLog,{type:"You deleted a comment on this post",details:{commentId:u,postId:s,text:h,time:new Date}}],interactions:f.interactions.filter(d=>d.details.commentId!==u)}),p.postComments&&k(C(o,"posts",`${s}`),{["postComments.details"]:p.postComments.details.filter(d=>d.commentId!==u),["postComments.total"]:p.postComments.total-1}),g.comments.in.some(d=>d.postId===s)&&k(C(o,"users",`${e}`),{["comments.in"]:l(g),["comments.total.in"]:g.comments.total.in-1,notifications:g.notifications.filter(d=>d.details.commentId!==u)}),y()})})})}catch($){console.log($)}}}return(t,s)=>(x(),S("button",{onClick:s[0]||(s[0]=V(e=>I(r.currentUserId,r.viewPostId,r.viewPostPosterId,c.commentId,c.commentText),["prevent"]))},"Delete"))}}),xt={key:1,id:"editContainer"},Et={id:"centerContainer"},Ft=["onClick"],Lt=Q({__name:"useEditComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String,divEditId:String},setup(c){const r=c,{app:b}=H(),v=j(),o=z(b),y=O(""),I=O(!1);async function t(){const h=C(o,"posts",r.viewPostId);await J(h).then(n=>{v.viwedPost=n.data()}).catch(n=>{console.log(n)})}async function s(h,n,U,A,$){if(h===""||h===void 0)return K.push("/login");if(A.trim()==="")console.log("Comment cannot be empty");else{document.getElementById("btnEditComment").setAttribute("disabled","true");const f=E(B(o,"users"),F("id","==",`${h}`)),T=E(B(o,"posts"),F("postId","==",`${n}`)),p=E(B(o,"users"),F("id","==",`${U}`));try{L(f).then(R=>{const g=R.docs[0].data();L(T).then(a=>{const l=a.docs[0].data();L(p).then(d=>{const w=d.docs[0].data();function P(){return g.comments.out.map(q=>{if(q.postId===n){const X=q.commentArr.map(Y=>Y.commentId===$?{...Y,details:A}:Y);return{...q,commentArr:X}}return q})}function i(){return w.comments.in.map(q=>{if(q.postId===n){const X=q.commentArr.map(Y=>Y.commentId===$?{...Y,details:A}:Y);return{...q,commentArr:X}}return q})}function M(){return l.postComments.details.map(q=>q.commentId===$?{...q,text:A}:q)}g.comments.out.some(N=>N.postId===n)&&k(C(o,"users",`${h}`),{["comments.out"]:P(),activityLog:[...g.activityLog,{type:"You edited your comment on this post",details:{commentId:l.postComments.count,postId:n,text:A,time:new Date}}]}),l.postComments&&k(C(o,"posts",`${n}`),{["postComments.details"]:M()}),w.comments.in.some(N=>N.postId===n)&&k(C(o,"users",`${U}`),{["comments.in"]:i()}),document.getElementById("btnEditComment").removeAttribute("disabled"),t(),I.value=!1})})})}catch(R){console.log(R),document.getElementById("btnEditComment").removeAttribute("disabled")}}}function e(h){const n=document.getElementById(`${h}`);y.value=n.innerText,I.value=!0}function u(){document.getElementById("btnEditComment").setAttribute("disabled","true"),y.value="",I.value=!1}return(h,n)=>I.value?(x(),S("div",xt,[m("div",Et,[it(m("textarea",{"onUpdate:modelValue":n[1]||(n[1]=U=>y.value=U)},null,512),[[rt,y.value]]),m("button",{id:"btnEditComment",onClick:n[2]||(n[2]=V(U=>s(r.currentUserId,r.viewPostId,r.viewPostPosterId,y.value,c.commentId),["prevent"]))},"Update"),m("button",{onClick:V(u,["prevent"])},"Cancel",8,Ft)])])):(x(),S("button",{key:0,onClick:n[0]||(n[0]=V(U=>e(r.divEditId),["prevent"]))},"Edit"))}});const St=at(Lt,[["__scopeId","data-v-5b33aa43"]]),Z=c=>(yt("data-v-ba9cb9a8"),c=c(),Pt(),c),Tt={key:1},Rt={key:0},qt={key:0},Bt=["onClick"],Nt=["onClick"],Mt=["innerHTML"],Vt={key:0},Ot={key:1},Yt=["id"],Dt={key:1},Ht=Z(()=>m("h1",null,"Post not found or Deleted",-1)),jt=Z(()=>m("button",null,"Expore Chatter",-1)),zt=Z(()=>m("button",null,"Home",-1)),Gt=Q({__name:"PostPage",props:["postId"],setup(c){const r=c;W();const b=O(!0),v=O(""),o=O([]),{app:y}=H(),I=z(y),t=j(),s=dt(),e=Ct(y),u=C(I,"posts",r.postId),h=new DOMParser,n=O([]),U=O(!1);async function A(){try{await Promise.all(t.viwedPost.postMedia.map(async l=>{const d=et(e,l.mediaFullPath),w=await ot(d);o.value.push(w)})).catch(()=>{console.log("error")})}catch(l){console.log(l)}}async function $(){try{const l=await J(u);l.data()!==void 0&&(t.viwedPost=l.data(),A(),f(),T(),k(u,{postViews:t.viwedPost.postViews+1}))}catch{s.push("/error")}}ct(()=>{$().then(()=>{b.value=!1})});async function f(){try{const l=et(e,t.viwedPost.postContain),d=await ot(l).catch(w=>{console.log(w)});await Ut.post("/postContent",{contentUrl:d}).then(w=>{const P=h.parseFromString(w.data,"text/html");P.body.querySelectorAll("img, video").forEach((i,M)=>{i.setAttribute("src",`${o.value[M]}`)}),v.value=P.body.innerHTML}).catch(w=>{console.log(w)})}catch(l){console.log(l)}}async function T(){try{const l=C(I,"users",t.viwedPost.posterId),d=await J(l);if(d.data()!==void 0){const{fullName:w,profilePicture:P}=d.data(),i={fullName:w,profilePicture:P,id:g};n.value.push(i),await At(t.viwedPost.posterId,t.signedUser.id).then(M=>{U.value=M})}}catch{}}async function p(){bt(t.viwedPost.posterId,n.value[0].fullName),U.value=!U.value}async function R(){_t(t.viwedPost.posterId),U.value=!U.value}let g=setTimeout(()=>{b.value=!1},5e3);lt(()=>{clearTimeout(g);const l=document.getElementById("warningShow");l.style.display="none"});function a(l){if(l===t.signedUser.id)return s.push("/userProfile");s.push(`/chatterUser/${l}`)}return(l,d)=>{const w=mt("RouterLink");return b.value?(x(),ut(ht,{key:0,"action-name":"Loading Post..."})):(x(),S("main",Tt,[_(t).viwedPost.posterId!==void 0?(x(),S("div",Rt,[m("h1",null,D(_(t).viwedPost.postTitle.join(" ")),1),m("div",null,[m("div",null,[m("div",{class:"imgCon",onClick:d[0]||(d[0]=V(P=>a(_(t).viwedPost.posterId),["prevent"])),style:pt({backgroundImage:`url(${n.value[0].profilePicture})`})},null,4),m("h3",{onClick:d[1]||(d[1]=V(P=>a(_(t).viwedPost.posterId),["prevent"]))},D(n.value[0].fullName),1),_(t).signedUser.id!==_(t).viwedPost.posterId?(x(),S("div",qt,[U.value?(x(),S("button",{key:0,onClick:V(p,["prevent"])},"UnFollow",8,Bt)):(x(),S("button",{key:1,onClick:V(R,["prevent"])},"Follow",8,Nt))])):wt("",!0)])]),m("div",null,D(st(_(t).viwedPost.postTime.seconds)),1),m("div",{innerHTML:v.value},null,8,Mt),m("div",null,[G(It,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])]),m("div",null,[m("div",null,[_(t).viwedPost.postComments.total<1?(x(),S("p",Vt,"No comments yet")):(x(),S("div",Ot,[(x(!0),S(vt,null,ft(_(t).viwedPost.postComments.details,(P,i)=>(x(),S("div",{key:i},[m("p",null,"postId: "+D(P.id),1),m("div",{id:i.toString()+"commentDiv"},D(P.text),9,Yt),m("p",null,"Time: "+D(st(P.time.seconds)),1),m("div",null,[G(kt,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId,commentId:P.commentId,commentText:P.text},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText"]),G(St,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId,commentId:P.commentId,commentText:P.text,divEditId:i.toString()+"commentDiv"},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText","divEditId"])])]))),128))]))]),G($t,{currentUserId:_(t).signedUser.id,viewPostId:r.postId,viewPostPosterId:_(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])])])):(x(),S("div",Dt,[Ht,m("div",null,[jt,G(w,{to:"/"},{default:gt(()=>[zt]),_:1})])]))]))}}});const se=at(Gt,[["__scopeId","data-v-ba9cb9a8"]]);export{se as default};
