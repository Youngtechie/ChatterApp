import{u as R,a as $}from"./useAuth.vue_vue_type_script_lang-77171506.js";import{A as N}from"./index-d9c4c67e.js";import{P as b,_ as q,R as d,b as w,d as f,g as h,a as U}from"./index.esm2017-7370a789.js";function S(e){const{app:i}=R(),l=b(i),o=$(),n=q(l,"users");async function a(){o.signedUser.id===void 0||o.signedUser.id===""?confirm("You need to be signed in to follow someone. Do you want to sign in?")===!0&&N.push("/login"):c()}async function c(){try{const r=d(n,w("id","==",`${o.signedUser.id}`)),t=(await f(r)).docs[0].data(),g=d(n,w("id","==",`${e}`)),s=(await f(g)).docs[0].data();if(t!=null&&t.length!==0&&s!==void 0&&s!==null&&s.length!==0){const u=[...t.following.theFollowings,e],A=u.length,y=[...s.followers.theFollowers,o.signedUser.id],F=y.length,P=h(l,"users",e),m=h(l,"users",o.signedUser.id);await U(P,{["followers.theFollowers"]:y,["followers.total"]:F,notifications:[...s.notifications,{type:`${o.signedUser.fullName} started following you`,details:{followerId:o.signedUser.id,time:new Date}}]}),await U(m,{["following.theFollowings"]:u,["following.total"]:A,activityLog:[...t.activityLog,{type:"New following",details:{followingId:e,time:new Date}}]})}}catch{alert("An occured while trying to follow this user. Please try again later")}}a()}function j(e,i){const{app:l}=R(),o=b(l),n=$(),a=q(o,"users");c();async function c(){try{const r=d(a,w("id","==",`${n.signedUser.id}`)),t=(await f(r)).docs[0].data(),g=d(a,w("id","==",`${e}`)),s=(await f(g)).docs[0].data();if(t!=null&&t.length!==0&&s!==void 0&&s!==null&&s.length!==0){const u=t.following.theFollowings.filter(v=>v!==e),A=u.length,y=s.followers.theFollowers.filter(v=>v!==n.signedUser.id),F=y.length,P=h(o,"users",e),m=h(o,"users",n.signedUser.id);await U(P,{["followers.theFollowers"]:y,["followers.total"]:F}),await U(m,{["following.theFollowings"]:u,["following.total"]:A,activityLog:[...t.activityLog,{type:`You unfollowed ${i}`,details:{followingId:e,time:new Date}}]})}}catch{alert("An error occured, Check your network connection and try again")}}}const D=$();async function z(e,i){const{app:l}=R(),o=b(l),n=q(o,"users");if(D.signedUser.id===void 0||D.signedUser.id==="")return!1;return await a();async function a(){try{const c=d(n,w("id","==",`${i}`)),r=d(n,w("id","==",`${e}`)),p=await f(c),t=await f(r),g=p.docs[0].data();return t.docs[0].data().followers.theFollowers.includes(i)&&g.following.theFollowings.includes(e)}catch{return!1}}}export{j as a,S as b,z as u};
