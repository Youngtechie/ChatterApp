import{d as G,r as M,c as w,f as h,p as ot,B as st,g as s,w as T,G as nt,u as it,o as rt,a as at,b as dt,e as mt,j as a,t as L,k as ct,l as X,h as H,F as lt,z as ut,i as Z,q as pt,s as vt}from"./index-4deccaec.js";import{u as J,a as tt}from"./useAuth.vue_vue_type_script_lang-7f3dced0.js";import{P as K,R as N,b as q,_ as F,d as R,a as x,g,c as j,I as _t}from"./index.esm2017-190d47df.js";import{_ as ft}from"./useLoadingPage.vue_vue_type_style_index_0_lang-a1ca09d8.js";import{a as wt}from"./axios-4a70c6fc.js";import{c as et}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{u as ht,a as Ct,b as gt}from"./useCheckFollow.vue_vue_type_script_lang-f828e3e6.js";import{u as yt}from"./useUserDetails.vue_vue_type_script_lang-91448774.js";import{u as Pt}from"./useDetailButtons-120b6adc.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";const It={class:"commentAdd"},bt=G({__name:"useAddComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String},setup(I){const v=I,{app:D}=J(),y=K(D),c=M("");async function E(_,t,i,S){if(_===""||_===void 0)confirm("You must be logged in to comment, will you love to sign up?")&&nt.push("/join");else if(S.trim()==="")alert("You cannot post an empty comment");else{document.getElementById("btnAddcomment").setAttribute("disabled","true");const U=N(F(y,"users"),q("id","==",`${_}`)),f=N(F(y,"posts"),q("postId","==",`${t}`)),n=N(F(y,"users"),q("id","==",`${i}`));try{R(U).then(k=>{const u=k.docs[0].data();R(f).then(B=>{const p=B.docs[0].data();R(n).then(V=>{const P=V.docs[0].data(),l={commentId:p.postComments.count,details:S,time:new Date};function b(e){return u.comments.out.map(m=>{if(m.postId===t)return{...m,commentArr:[...m.commentArr,e]}})}function O(e){return P.comments.in.map(m=>{if(m.postId===t)return{...m,commentArr:[...m.commentArr,e]}})}u.comments.out.some(e=>e.postId===t)?x(g(y,"users",`${_}`),{["comments.out"]:b(l),["comments.total.out"]:u.comments.total.out+1,activityLog:[...u.activityLog,{type:"You added another comment on this post",details:{commentId:p.postComments.count,postId:t,text:l.details,time:l.time}}]}):x(g(y,"users",`${_}`),{["comments.out"]:[...u.comments.out,{postId:t,commentArr:[l]}],["comments.total.out"]:u.comments.total.out+1,activityLog:[...u.activityLog,{type:"You commented on this post",details:{commentId:p.postComments.count,postId:t,text:l.details,time:l.time}}],interactions:[...u.interactions,{type:"Commented on this post",details:{commentId:p.postComments.count,postid:t,text:l.details,time:l.time}}]}),p.postComments&&x(g(y,"posts",`${t}`),{["postComments.details"]:[...p.postComments.details,{commentId:p.postComments.count,id:_,text:l.details,time:l.time}],["postComments.total"]:p.postComments.total+1,["postComments.count"]:p.postComments.count+1}),P.comments.in.some(e=>e.postId===t)?x(g(y,"users",`${i}`),{["comments.in"]:O(l),["comments.total.in"]:P.comments.total.in+1,notifications:[...P.notifications,{type:`Your got a comment from <b>${u.fullName}</b> on a post`,details:{commentId:p.postComments.count,postid:t,text:l.details,time:l.time}}]}):x(g(y,"users",`${i}`),{["comments.in"]:[...P.comments.in,{postId:t,commentArr:[l]}],["comments.total.in"]:P.comments.total.in+1,notifications:[...P.notifications,{type:`Your got a comment from <b>${u.fullName}</b> on a post`,details:{commentId:p.postComments.count,postid:t,text:l.details,time:l.time}}]}),c.value="",document.getElementById("btnAddcomment").removeAttribute("disabled")})})})}catch{alert("Something went wrong"),document.getElementById("btnAddcomment").removeAttribute("disabled")}}}return(_,t)=>(w(),h("div",It,[ot(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=i=>c.value=i),minlength:"1",maxlength:"1000"},null,512),[[st,c.value]]),s("button",{onClick:t[1]||(t[1]=T(i=>E(v.currentUserId,v.viewPostId,v.viewPostPosterId,c.value),["prevent"])),id:"btnAddcomment"},"Add Comment")]))}});const At=Q(bt,[["__scopeId","data-v-47105c14"]]),Ut=G({__name:"useDeleteComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String},setup(I){const v=I,{app:D}=J(),y=tt(),c=K(D);async function E(){const t=g(c,"posts",v.viewPostId);await j(t).then(i=>{y.viwedPost=i.data()}).catch(i=>{console.log(i)})}async function _(t,i,S,U,f){if(!(t===""||t===void 0)){const n=N(F(c,"users"),q("id","==",`${t}`)),k=N(F(c,"posts"),q("postId","==",`${i}`)),u=N(F(c,"users"),q("id","==",`${S}`));try{R(n).then(B=>{const p=B.docs[0].data();R(k).then(V=>{const P=V.docs[0].data();R(u).then(l=>{const b=l.docs[0].data();function O(o){return o.comments.out.map(r=>{if(r.postId===i)if(r.commentArr.length>1){const $=r.commentArr.filter(A=>A.commentId!==U);return{...r,commentArr:$}}else return null;return r}).filter(r=>r!==null)}function e(o){return o.comments.in.map(r=>{if(r.postId===i)if(r.commentArr.length>1){const $=r.commentArr.filter(A=>A.commentId!==U);return{...r,commentArr:$}}else return null;return r}).filter(r=>r!==null)}p.comments.out.some(o=>o.postId===i)&&x(g(c,"users",`${t}`),{["comments.out"]:O(p),["comments.total.out"]:p.comments.total.out-1,activityLog:[...p.activityLog,{type:"You deleted a comment on this post",details:{commentId:U,postId:i,text:f,time:new Date}}],interactions:p.interactions.filter(o=>o.details.commentId!==U)}),P.postComments&&x(g(c,"posts",`${i}`),{["postComments.details"]:P.postComments.details.filter(o=>o.commentId!==U),["postComments.total"]:P.postComments.total-1}),b.comments.in.some(o=>o.postId===i)&&x(g(c,"users",`${S}`),{["comments.in"]:e(b),["comments.total.in"]:b.comments.total.in-1,notifications:b.notifications.filter(o=>o.details.commentId!==U)}),E()})})})}catch(B){console.log(B)}}}return(t,i)=>(w(),h("button",{class:"delBtn",onClick:i[0]||(i[0]=T(S=>_(v.currentUserId,v.viewPostId,v.viewPostPosterId,I.commentId,I.commentText),["prevent"]))},"Delete"))}});const kt=Q(Ut,[["__scopeId","data-v-c1602308"]]),$t={key:1,id:"editContainer"},xt={id:"centerContainer"},Et=["onClick"],St=G({__name:"useEditComment",props:{currentUserId:String,viewPostId:String,viewPostPosterId:String,commentId:Number,commentText:String,divEditId:String},setup(I){const v=I,{app:D}=J(),y=tt(),c=K(D),E=M(""),_=M(!1);async function t(){const f=g(c,"posts",v.viewPostId);await j(f).then(n=>{y.viwedPost=n.data()}).catch(n=>{console.log(n)})}async function i(f,n,k,u,B){if(!(f===""||f===void 0))if(u.trim()==="")alert("Comment cannot be empty");else{document.getElementById("btnEditComment").setAttribute("disabled","true");const p=N(F(c,"users"),q("id","==",`${f}`)),V=N(F(c,"posts"),q("postId","==",`${n}`)),P=N(F(c,"users"),q("id","==",`${k}`));try{R(p).then(l=>{const b=l.docs[0].data();R(V).then(O=>{const e=O.docs[0].data();R(P).then(o=>{const m=o.docs[0].data();function d(){return b.comments.out.map(C=>{if(C.postId===n){const W=C.commentArr.map(Y=>Y.commentId===B?{...Y,details:u}:Y);return{...C,commentArr:W}}return C})}function r(){return m.comments.in.map(C=>{if(C.postId===n){const W=C.commentArr.map(Y=>Y.commentId===B?{...Y,details:u}:Y);return{...C,commentArr:W}}return C})}function $(){return e.postComments.details.map(C=>C.commentId===B?{...C,text:u}:C)}b.comments.out.some(A=>A.postId===n)&&x(g(c,"users",`${f}`),{["comments.out"]:d(),activityLog:[...b.activityLog,{type:"You edited your comment on this post",details:{commentId:e.postComments.count,postId:n,text:u,time:new Date}}]}),e.postComments&&x(g(c,"posts",`${n}`),{["postComments.details"]:$()}),m.comments.in.some(A=>A.postId===n)&&x(g(c,"users",`${k}`),{["comments.in"]:r()}),document.getElementById("btnEditComment").removeAttribute("disabled"),t(),_.value=!1})})})}catch{alert("An error occurred, try again"),document.getElementById("btnEditComment").removeAttribute("disabled")}}}function S(f){const n=document.getElementById(`${f}`);E.value=n.innerText,_.value=!0}function U(){document.getElementById("btnEditComment").setAttribute("disabled","true"),E.value="",_.value=!1}return(f,n)=>_.value?(w(),h("div",$t,[s("div",xt,[ot(s("textarea",{"onUpdate:modelValue":n[1]||(n[1]=k=>E.value=k)},null,512),[[st,E.value]]),s("button",{id:"btnEditComment",onClick:n[2]||(n[2]=T(k=>i(v.currentUserId,v.viewPostId,v.viewPostPosterId,E.value,I.commentId),["prevent"]))},"Update"),s("button",{onClick:T(U,["prevent"])},"Cancel",8,Et)])])):(w(),h("button",{key:0,onClick:n[0]||(n[0]=T(k=>S(v.divEditId),["prevent"])),class:"editBTn"},"Edit"))}});const Bt=Q(St,[["__scopeId","data-v-41bb88f5"]]),z=I=>(pt("data-v-67e8dbe3"),I=I(),vt(),I),Tt={key:1,class:"postFullDetails"},Lt=["onClick"],Nt=["title"],qt={id:"themeImgContainer"},Ft=["src"],Rt={key:0,class:"postBody"},Dt={key:0},Mt={key:1,class:"coverImage"},Vt=["src"],Ot={class:"section1"},Yt={class:"details"},Ht={key:0},jt=["onClick"],zt=["onClick"],Gt={class:"timePosted"},Jt=["innerHTML"],Kt={class:"btnsMore"},Qt={class:"commentingSection"},Wt={key:0},Xt={key:1,class:"commentAction"},Zt={class:"commenter"},te=["onClick"],ee=["id"],oe={key:0,class:"commenterBtn"},se={key:2},ne={key:1},ie=z(()=>s("h1",null,"Post not found or Deleted",-1)),re=z(()=>s("button",null,"Expore Chatter",-1)),ae=z(()=>s("button",null,"Home",-1)),de={id:"navigators"},me=z(()=>s("button",null,"Home",-1)),ce=z(()=>s("button",null,"Search",-1)),le=G({__name:"PostPage",props:["postId"],setup(I){const v=I;yt();const D=M(!0),y=M(""),c=M([]),{app:E}=J(),_=K(E),t=tt(),i=it(),S=g(_,"posts",v.postId),U=new DOMParser,f=M([]),n=M(!1);async function k(){try{await Promise.all(t.viwedPost.postMedia.map(async e=>{c.value.push(e.mediaFullPath)})).catch(()=>{console.log("error")})}catch(e){console.log(e)}}async function u(){try{await Promise.all(t.viwedPost.postComments.details.map(async(e,o)=>{const m=g(_,"users",e.id),d=await j(m);if(d.data()!==void 0){const{fullName:r,id:$,username:A}=d.data(),C={fullName:r,id:$,username:A};t.viwedPost.postComments.details[o].posterDetails=C}}))}catch(e){console.log(e)}}async function B(){try{const e=await j(S);e.data()!==void 0&&(t.viwedPost=e.data(),k(),p(),V(),u(),x(S,{postViews:t.viwedPost.postViews+1}).finally(()=>{D.value=!1}))}catch(e){console.error(e)}}rt(()=>{const e=g(_,"posts",v.postId);try{_t(e,o=>{t.viwedPost=o.data(),u()})}catch{}B()});async function p(){try{const e=t.viwedPost.postContain;await wt.post("/postContent",{contentUrl:e}).then(o=>{var d;const m=U.parseFromString(o.data,"text/html");m.body.querySelectorAll("img, video").forEach((r,$)=>{r.setAttribute("src",`${c.value[$]}`)}),(d=m.body.querySelector("h1"))==null||d.remove(),y.value=m.body.innerHTML}).catch(o=>{console.log(o)})}catch(e){console.log(e)}}async function V(){try{const e=g(_,"users",t.viwedPost.posterId),o=await j(e);if(o.data()!==void 0){const{blogName:m,profilePicture:d,id:r,username:$}=o.data(),A={blogName:m,profilePicture:d,id:r,username:$};f.value.push(A),await ht(t.viwedPost.posterId,t.signedUser.id).then(C=>{n.value=C})}}catch{}}async function P(){Ct(t.viwedPost.posterId,f.value[0].blogName),n.value=!n.value}async function l(){gt(t.viwedPost.posterId),n.value=!n.value}at(()=>{const e=document.getElementById("warningShow");e&&(e.style.display="none")});function b(e){if(e===t.signedUser.id)return i.push("/userProfile");i.push(`/chatterUser/${e}`)}function O(){i.go(-1)}return(e,o)=>{const m=dt("RouterLink");return D.value?(w(),mt(ft,{key:0,"action-name":"Loading Post..."})):(w(),h("main",Tt,[s("header",null,[s("button",{onClick:T(O,["prevent"])},"Back",8,Lt),s("button",{title:a(t).themeDetails.title,id:"themeBtn",onClick:o[0]||(o[0]=(...d)=>a(t).changeTheme&&a(t).changeTheme(...d))},[s("div",qt,[s("img",{src:a(t).themeDetails.img},null,8,Ft)])],8,Nt)]),a(t).viwedPost.posterId!==void 0?(w(),h("div",Rt,[a(t).viwedPost.postCoverImage===""?(w(),h("h1",Dt,L(a(t).viwedPost.postTitle.join(" ")),1)):(w(),h("section",Mt,[s("img",{id:"img",src:a(t).viwedPost.postCoverImage},null,8,Vt),s("h1",null,L(a(t).viwedPost.postTitle.join(" ")),1)])),s("div",Ot,[s("div",Yt,[s("div",{class:"imgCon",onClick:o[1]||(o[1]=T(d=>b(a(t).viwedPost.posterId),["prevent"])),style:ct({backgroundImage:`url(${f.value[0].profilePicture})`})},null,4),s("div",null,[s("h3",{onClick:o[2]||(o[2]=T(d=>b(a(t).viwedPost.posterId),["prevent"]))},L(f.value[0].blogName),1),s("h5",null,"@"+L(f.value[0].username),1)])]),a(t).signedUser.id!==a(t).viwedPost.posterId?(w(),h("div",Ht,[n.value?(w(),h("button",{key:0,onClick:T(P,["prevent"])},"UnFollow",8,jt)):(w(),h("button",{key:1,onClick:T(l,["prevent"])},"Follow",8,zt))])):X("",!0)]),s("div",Gt,L(et(a(t).viwedPost.postTime.seconds)),1),s("div",{innerHTML:y.value,class:"showPost"},null,8,Jt),s("div",Kt,[H(Pt,{post:a(t).viwedPost},null,8,["post"])]),s("div",Qt,[a(t).viwedPost.postComments.total===0&&a(t).viwedPost.postSettings.disableComments===!1?(w(),h("h4",Wt," No comments yet. ")):X("",!0),a(t).viwedPost.postSettings.disableComments===!1?(w(),h("div",Xt,[(w(!0),h(lt,null,ut(a(t).viwedPost.postComments.details,(d,r)=>(w(),h("div",{key:r,class:"Eachcomment"},[s("div",Zt,[s("div",null,[s("h4",{onClick:T($=>b(d.commenterId),["prevent"])},L(d.posterDetails.fullName),9,te),s("h5",null,"@"+L(d.posterDetails.username),1)]),s("p",null,L(et(d.time.seconds)),1)]),s("div",{id:r.toString()+"commentDiv",class:"commentShow"},L(d.text),9,ee),a(t).signedUser.id===a(t).viwedPost.posterId?(w(),h("div",oe,[H(Bt,{currentUserId:a(t).signedUser.id,viewPostId:v.postId,viewPostPosterId:a(t).viwedPost.posterId,commentId:d.commentId,commentText:d.text,divEditId:r.toString()+"commentDiv"},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText","divEditId"]),H(kt,{currentUserId:a(t).signedUser.id,viewPostId:v.postId,viewPostPosterId:a(t).viwedPost.posterId,commentId:d.commentId,commentText:d.text},null,8,["currentUserId","viewPostId","viewPostPosterId","commentId","commentText"])])):X("",!0)]))),128)),H(At,{currentUserId:a(t).signedUser.id,viewPostId:v.postId,viewPostPosterId:a(t).viwedPost.posterId},null,8,["currentUserId","viewPostId","viewPostPosterId"])])):(w(),h("h4",se,"Commenting on this post is disabled."))])])):(w(),h("div",ne,[ie,s("div",null,[re,H(m,{to:"/"},{default:Z(()=>[ae]),_:1})])])),s("section",de,[H(m,{to:"/home"},{default:Z(()=>[me]),_:1}),H(m,{to:"/search"},{default:Z(()=>[ce]),_:1})])]))}}});const Pe=Q(le,[["__scopeId","data-v-67e8dbe3"]]);export{Pe as default};
