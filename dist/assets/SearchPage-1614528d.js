import{d as G,u as J,r as g,a as K,x as ie,c as h,f as p,g as o,p as H,B as le,C as ce,w as E,F as L,z as F,l as O,k as de,t as P,h as X,q as Y,s as Z}from"./index-9022b2ad.js";import{u as ue,a as ee}from"./useAuth.vue_vue_type_script_lang-505c08bf.js";import{S as me}from"./useSignOut.vue_vue_type_script_lang-b5ec1132.js";import{P as he,R as z,b as Q,_ as W,d as j,g as pe,c as ve}from"./index.esm2017-27f00cac.js";import{u as ge}from"./useDetailButtons-70788aa0.js";import{a as _e}from"./axios-4a70c6fc.js";import{c as fe}from"./useCalculateTime.vue_vue_type_script_lang-ca052a8e.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const k=r=>(Y("data-v-0a89b1ab"),r=r(),Z(),r),ye={id:"mainSearchContainer"},be={class:"search-container"},Se=["placeholder"],Ce={class:"firstSection"},we=k(()=>o("option",{value:"",disabled:""},"Select category you want to search in",-1)),Be=k(()=>o("option",{value:"Posts"},"Posts",-1)),Ie=k(()=>o("option",{value:"Users"},"Users",-1)),xe=[we,Be,Ie],Ee={key:0,class:"results-container"},Pe=["onClick"],ke={class:"result-item-other"},Ae={class:"result-item-header"},Te=["onClick"],Ue=["innerHTML","onClick"],$e={key:1,class:"results-container"},Ne=["onClick"],Le=k(()=>o("div",{id:"warningShow"},null,-1)),Me=G({__name:"useSearch",setup(r){const{app:A}=ue(),i=he(A),_=J(),l=ee(),f=g(""),C=g("Posts"),T=g("");let M;const B=g(""),D=new DOMParser,U=g();K(()=>{clearTimeout(M)});const y=g([]),b=g([]);ie(()=>{C.value==="Posts"?(f.value="",T.value="Search for posts by post tag",b.value=[],y.value=[]):C.value==="Users"&&(f.value="",T.value="Search for Users by username",y.value=[],b.value=[])});async function ne(s){const n=s.postContain;await _e.post("/postContent",{contentUrl:n}).then(t=>{const e=D.parseFromString(t.data,"text/html");B.value=e.body.innerHTML})}async function oe(s){U.value=null;const n=pe(i,"users",s),t=await ve(n);if(t.data()!==void 0){const{fullName:e,profilePicture:c,username:d,blogName:I}=t.data(),v={profilePicture:c,posterID:s,fullName:e,username:d,blogName:I};U.value={id:s,img:v.profilePicture,fullName:v.fullName,username:v.username,blogname:v.blogName}}}async function se(s,n){var e,c,d,I,v,V;document.querySelector("#mainSearchContainer #loading")&&document.querySelector("#mainSearchContainer #loading").remove();const t=document.createElement("div");if(t.setAttribute("id","loading"),t.textContent="Loading...",b.value=[],y.value=[],n===""){const u=document.getElementById("warningShow");u&&(u.style.display="flex",u.textContent="No Input",M=setTimeout(()=>{var a;u.style.display="none",(a=document.getElementById("searchBtn"))==null||a.removeAttribute("disabled")},1e3))}else if(s==="Posts"){(e=document.getElementById("mainSearchContainer"))==null||e.appendChild(t),(c=document.getElementById("searchBtn"))==null||c.setAttribute("disabled","true");const u=z(W(i,"posts"),Q("postTag","==",`${n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}`));try{await j(u).then(a=>{var w;a.docs.length===0?t.textContent="No Post found with this tag":a.docs.forEach(N=>{const m=N.data();m!=null&&m.length!==0&&ne(m).then(()=>{var q,R;(q=document.getElementById("searchBtn"))==null||q.removeAttribute("disabled");const x=D.parseFromString(B.value,"text/html");x.body.querySelectorAll("img").forEach(S=>{S.remove()}),x.body.querySelectorAll("video").forEach(S=>{S.remove()}),(R=x.body.querySelector("h1"))==null||R.remove(),B.value=x.body.innerHTML,m.postContain=B.value,oe(m.posterId).then(()=>{var S;m.posterDetails=U.value,t.remove(),(S=y.value)==null||S.push(m)})})}),(w=document.getElementById("searchBtn"))==null||w.removeAttribute("disabled")}).catch(()=>{var a;t.textContent="Something went wrong, try again later",(a=document.getElementById("searchBtn"))==null||a.removeAttribute("disabled")})}catch{t.textContent="Something went wrong, try again later",(d=document.getElementById("searchBtn"))==null||d.removeAttribute("disabled")}}else if(s==="Users"){(I=document.getElementById("mainSearchContainer"))==null||I.appendChild(t),(v=document.getElementById("searchBtn"))==null||v.setAttribute("disabled","true");const u=z(W(i,"users"),Q("username","==",`${n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}`));try{await j(u).then(a=>{var w;a.docs.length===0?t.textContent="No user with this username found":(t.remove(),(w=document.getElementById("searchBtn"))==null||w.removeAttribute("disabled"),a.docs.forEach(N=>{b.value.push(N.data())}))}).catch(()=>{var a;t.textContent="Something went wrong, try again later",(a=document.getElementById("searchBtn"))==null||a.removeAttribute("disabled")})}catch{t.textContent="Something went wrong, try again later",(V=document.getElementById("searchBtn"))==null||V.removeAttribute("disabled")}}}function ae(s){const n=s.target,t=n.value;t.includes(" ")&&(n.value=t.replace(/\s/g,""))}function re(s){_.push(`/post/${s}`)}function $(s){if(s===l.signedUser.id)return _.push("/userProfile");_.push(`/chatterUser/${s}`)}return(s,n)=>{var t;return h(),p(L,null,[o("div",ye,[o("div",be,[H(o("input",{type:"text",name:"searchValue","onUpdate:modelValue":n[0]||(n[0]=e=>f.value=e),placeholder:T.value,onInput:ae},null,40,Se),[[le,f.value]]),o("div",Ce,[H(o("select",{id:"tags","onUpdate:modelValue":n[1]||(n[1]=e=>C.value=e),required:""},xe,512),[[ce,C.value]]),o("button",{onClick:n[2]||(n[2]=E(e=>se(C.value,f.value),["prevent"])),id:"searchBtn"},"Search")])]),((t=y.value)==null?void 0:t.length)>0?(h(),p("div",Ee,[(h(!0),p(L,null,F(y.value,(e,c)=>(h(),p("div",{key:c,class:"result-item-post"},[o("div",{class:"imgCon",onClick:E(d=>$(e.posterId),["prevent"]),style:de({backgroundImage:`url(${e==null?void 0:e.posterDetails.img})`})},null,12,Pe),o("div",ke,[o("div",Ae,[o("span",{onClick:E(d=>$(e.posterId),["prevent"])},P(e==null?void 0:e.posterDetails.blogname),9,Te),o("span",null,P(fe(e.postTime.seconds)),1)]),o("div",{innerHTML:e.postContain,id:"divContent",onClick:E(d=>re(e.postId),["prevent"])},null,8,Ue),X(ge,{post:e},null,8,["post"])])]))),128))])):O("",!0),b.value.length>0?(h(),p("div",$e,[(h(!0),p(L,null,F(b.value,(e,c)=>(h(),p("button",{key:c,class:"result-item",onClick:d=>$(e.id)},[o("h3",null,P(e.fullName),1),o("p",null,"@"+P(e.username),1)],8,Ne))),128))])):O("",!0)]),Le],64)}}});const De=te(Me,[["__scopeId","data-v-0a89b1ab"]]),Ve=r=>(Y("data-v-d22bb3f1"),r=r(),Z(),r),qe={id:"searchContainer"},Re=Ve(()=>o("div",{id:"warningShow"},null,-1)),He=G({__name:"SearchPage",setup(r){const A=J(),i=ee();i.sidebar=!1;let _;if(i.authenticated===!0&&i.signedUser.id!==void 0&&i.signedUser.username===""){const l=document.getElementById("warningShow");l.style.display="flex",l.textContent="Registration not complete... Logging you out",me(),_=setTimeout(()=>{l.style.display="none",i.authenticated=!1,A.push("/login")},2e3)}return K(()=>{clearTimeout(_);const l=document.getElementById("warningShow");l&&(l.style.display="none")}),(l,f)=>(h(),p("div",qe,[X(De),Re]))}});const Ke=te(He,[["__scopeId","data-v-d22bb3f1"]]);export{Ke as default};
